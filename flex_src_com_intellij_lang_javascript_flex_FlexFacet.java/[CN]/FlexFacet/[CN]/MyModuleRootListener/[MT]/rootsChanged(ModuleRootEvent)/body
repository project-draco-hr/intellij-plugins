{
  final ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(myModule);
  final Sdk newSdk=moduleRootManager.getSdk();
  try {
    if (myConfiguringMyself) {
      return;
    }
    if (newSdk != null && newSdk.getSdkType() instanceof IFlexSdkType && !newSdk.equals(myPreviousSdk)) {
      final Collection<FlexFacet> flexFacets=FacetManager.getInstance(myModule).getFacetsByType(ID);
      if (flexFacets.size() == 0) {
        return;
      }
      boolean allFacetsAlreadyHaveThisSdk=allFacetsHaveThisSdk(flexFacets,newSdk);
      if (allFacetsAlreadyHaveThisSdk) {
        showWarning(newSdk);
      }
 else {
        if (ApplicationManager.getApplication().isDispatchThread()) {
          suggestToSetSdkForFacets(flexFacets,newSdk);
        }
      }
    }
  }
  finally {
    myPreviousSdk=newSdk;
  }
}
