{
  final DartUrlResolver urlResolver=DartUrlResolver.getInstance(project,dir);
  final VirtualFile dartTestLib=urlResolver.findFileByDartUrl("package:test/test.dart");
  if (dartTestLib == null)   return false;
  final VirtualFile pubspec=urlResolver.getPubspecYamlFile();
  if (pubspec == null)   return false;
  final VirtualFile rootDir=pubspec.getParent();
  final VirtualFile testDir=rootDir.findChild("test");
  if (testDir == null || !testDir.isDirectory())   return false;
  if (!rootDir.equals(dir) && !VfsUtilCore.isAncestor(testDir,dir,false))   return false;
  return setupRunnerParametersForFolder(params,dir);
}
