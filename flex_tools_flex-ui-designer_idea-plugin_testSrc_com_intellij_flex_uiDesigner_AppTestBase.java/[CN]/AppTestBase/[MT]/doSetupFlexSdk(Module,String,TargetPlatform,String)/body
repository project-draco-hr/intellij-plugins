{
  final String sdkName=generateSdkName(sdkVersion);
  Sdk sdk=ProjectJdkTable.getInstance().findJdk(sdkName);
  final Sdk finalSdk;
  if (sdk == null) {
    final AccessToken token=WriteAction.start();
    try {
      FlexSdkType2 sdkType=FlexSdkType2.getInstance();
      sdk=PeerFactory.getInstance().createProjectJdk(sdkType.suggestSdkName(null,flexSdkRootPath),"",flexSdkRootPath,sdkType);
      ProjectJdkTable.getInstance().addJdk(sdk);
      finalSdk=sdk;
      Disposer.register(getSdkParentDisposable(),new Disposable(){
        @Override public void dispose(){
          final AccessToken t=WriteAction.start();
          try {
            ProjectJdkTable.getInstance().removeJdk(finalSdk);
          }
  finally {
            t.finish();
          }
        }
      }
);
      final SdkModificator modificator=sdk.getSdkModificator();
      modificator.setName(sdkName);
      modificator.setVersionString(FlexSdkUtils.readFlexSdkVersion(sdk.getHomeDirectory()));
      modifySdk(sdk,modificator);
      modificator.commitChanges();
    }
  finally {
      token.finish();
    }
  }
 else {
    finalSdk=sdk;
  }
  JSTestUtils.modifyBuildConfiguration(module,new Consumer<ModifiableFlexIdeBuildConfiguration>(){
    public void consume(    final ModifiableFlexIdeBuildConfiguration bc){
      bc.setNature(new BuildConfigurationNature(targetPlatform,false,getOutputType()));
      bc.getDependencies().setSdkEntry(Factory.createSdkEntry(finalSdk.getName()));
    }
  }
);
}
