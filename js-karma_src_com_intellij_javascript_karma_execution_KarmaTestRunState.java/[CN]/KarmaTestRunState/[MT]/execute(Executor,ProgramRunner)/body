{
  File configurationFile=new File(myRunSettings.getConfigPath());
  KarmaServer server=KarmaServerRegistry.getServerByConfigurationFile(configurationFile);
  if (server == null) {
    try {
      server=new KarmaServer(new File(myNodeInterpreterPath),new File(myKarmaPackageDir),configurationFile);
      KarmaServerRegistry.registerServer(server);
    }
 catch (    IOException e) {
      throw new ExecutionException(e);
    }
  }
  KarmaRunSession runSession=new KarmaRunSession(myProject,myExecutionEnvironment,executor,server,myNodeInterpreterPath,myRunSettings);
  SMTRunnerConsoleView smtRunnerConsoleView=runSession.getSmtConsoleView();
  Disposer.register(myProject,smtRunnerConsoleView);
  ProcessHandler processHandler=runSession.getProcessHandler();
  DefaultExecutionResult executionResult=new DefaultExecutionResult(smtRunnerConsoleView,processHandler);
  executionResult.setRestartActions(new ToggleAutoTestAction());
  return executionResult;
}
