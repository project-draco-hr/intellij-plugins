{
  final Module module=context.getModule();
  if (!(location instanceof PsiLocation) || module == null)   return null;
  mySourceElement=location.getPsiElement();
  final JSClass jsClass=FlexRuntimeConfigurationProducer.getJSClass(mySourceElement);
  if (jsClass != null && FlexRuntimeConfigurationProducer.isAcceptedMainClass(jsClass,module,true)) {
    final RunnerAndConfigurationSettings settings=RunManagerEx.getInstanceEx(location.getProject()).createConfiguration("",FlexIdeRunConfigurationType.getFactory());
    final FlexIdeRunConfiguration runConfig=(FlexIdeRunConfiguration)settings.getConfiguration();
    final FlexIdeRunnerParameters params=runConfig.getRunnerParameters();
    params.setModuleName(module.getName());
    final FlexIdeBuildConfiguration bc=getBCToBaseOn(module,jsClass.getQualifiedName());
    params.setBCName(bc.getName());
    if (bc.getOutputType() == OutputType.Application && jsClass.getQualifiedName().equals(bc.getMainClass())) {
      params.setOverrideMainClass(false);
    }
 else {
      params.setOverrideMainClass(true);
      params.setOverriddenMainClass(jsClass.getQualifiedName());
      params.setOverriddenOutputFileName(jsClass.getName() + ".swf");
    }
    runConfig.setName(FlexIdeRunConfiguration.suggestName(params));
    return settings;
  }
  return null;
}
