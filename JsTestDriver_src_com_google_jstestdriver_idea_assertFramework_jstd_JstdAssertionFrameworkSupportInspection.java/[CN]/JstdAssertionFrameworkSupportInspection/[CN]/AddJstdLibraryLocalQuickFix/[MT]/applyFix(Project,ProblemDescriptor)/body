{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      List<VirtualFile> sources=getLibrarySourceFiles();
      final VirtualFile fileRequestor=findVirtualFile(descriptor.getPsiElement());
      DialogWrapper dialog=new ChooseScopeAndCreateLibraryDialog(project,JstdLibraryUtil.LIBRARY_NAME,sources,fileRequestor,false);
      AsyncResult<Boolean> result=dialog.showAndGetOk();
      result.doWhenDone(new AsyncResult.Handler<Boolean>(){
        @Override public void run(        Boolean done){
          if (done) {
            FileContentUtil.reparseFiles(project,Collections.singletonList(fileRequestor),true);
          }
        }
      }
);
    }
  }
);
}
