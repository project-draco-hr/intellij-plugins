{
  final String testName=getTestName(false);
  final String fileRelPath="pack/" + testName + ".mxml";
  final VirtualFile swcFile=LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + getBasePath() + "/"+ testName+ "/"+ testName+ ".swc");
  final SdkModificator modificator=FlexTestUtils.getFlexSdkModificator(getModule());
  modificator.addRoot(JarFileSystem.getInstance().getJarRootForLocalFile(swcFile),OrderRootType.CLASSES);
  modificator.commitChanges();
  final Module dependentModule=doCreateRealModule("dependent");
  final VirtualFile contentRoot=LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + getBasePath() + "/"+ testName+ "_dependent_module");
  PsiTestUtil.addSourceRoot(dependentModule,contentRoot);
  final String absPath=LocalFileSystem.getInstance().findFileByPath("").getPath();
  myAfterCommitRunnable=new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          replaceText(fileRelPath,"${SOME_ABSOLUTE_PATH}",absPath);
          ModuleRootModificationUtil.addDependency(myModule,dependentModule);
        }
      }
);
    }
  }
;
  doTestFor(true,getDefaultProjectRoot(testName),(Runnable)null,testName + "/" + fileRelPath);
}
