{
  final AngularUiRouterDiagramBuilder builder=new AngularUiRouterDiagramBuilder(getProject());
  builder.build();
  final Map<VirtualFile,RootTemplate> rootTemplates=builder.getRootTemplates();
  final RootTemplate template=rootTemplates.get(myRootFile);
  if (template != null) {
    Map<String,UiRouterState> map=builder.getDefiningFiles2States().get(myRootFile);
    final AngularUiRouterGraphBuilder graphBuilder;
    if (map == null) {
      map=builder.getRootTemplates2States().get(myRootFile);
      if (map == null)       return;
      graphBuilder=new AngularUiRouterGraphBuilder(getProject(),map,builder.getTemplatesMap(),rootTemplates.get(myRootFile),myRootFile);
    }
 else {
      graphBuilder=new AngularUiRouterGraphBuilder(getProject(),map,builder.getTemplatesMap(),null,myRootFile);
    }
    final AngularUiRouterDiagramProvider diagramProvider=(AngularUiRouterDiagramProvider)getProvider();
    final AngularUiRouterGraphBuilder.GraphNodesBuilder model=graphBuilder.createDataModel(diagramProvider);
    myNodes.clear();
    myEdges.clear();
    diagramProvider.reset();
    diagramProvider.registerNodesBuilder(model);
    myNodes.addAll(model.getAllNodes());
    myEdges.addAll(model.getEdges());
  }
}
