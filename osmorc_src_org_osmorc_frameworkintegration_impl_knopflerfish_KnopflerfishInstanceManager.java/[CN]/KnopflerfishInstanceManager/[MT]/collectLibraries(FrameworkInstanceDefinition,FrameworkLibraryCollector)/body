{
  VirtualFile installFolder=LocalFileSystem.getInstance().findFileByPath(frameworkInstanceDefinition.getBaseFolder());
  if (installFolder == null || !installFolder.isDirectory()) {
    LOG.warn(frameworkInstanceDefinition.getBaseFolder() + " is not a folder");
    return;
  }
  VirtualFile kf2Folder=installFolder.findChild("knopflerfish.org");
  final VirtualFile osgiFolder=kf2Folder != null ? kf2Folder.findChild("osgi") : installFolder.findChild("osgi");
  if (osgiFolder == null) {
    LOG.warn(installFolder.getPath() + " does not contain neither 'osgi' nor 'knopflerfish.org/osgi'");
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      osgiFolder.refresh(false,true);
      List<VirtualFile> directoriesToAdd=new ArrayList<VirtualFile>();
      VirtualFile jarsFolder=osgiFolder.findChild("jars");
      if (jarsFolder != null) {
        if (!jarsFolder.isDirectory()) {
          LOG.warn(jarsFolder.getPath() + " is not a folder");
          return;
        }
        VirtualFile[] files=jarsFolder.getChildren();
        for (        VirtualFile file : files) {
          if (file.isDirectory()) {
            directoriesToAdd.add(file);
          }
        }
      }
      collector.collectFrameworkLibraries(new KnopflerfishSourceFinder(osgiFolder),directoriesToAdd);
    }
  }
);
}
