{
  DocumentInfo info=virtualFile.getUserData(INFO);
  if (info == null || info.sessionId != sessionId) {
    if (info == null) {
      info=new DocumentInfo();
    }
    info.id=freeIndices.isEmpty() ? counter++ : freeIndices.remove(freeIndices.size() - 1);
    info.sessionId=sessionId;
    virtualFile.putUserData(INFO,info);
    if (unregisteredDocumentFactories != null) {
      unregisteredDocumentFactories.add(psiFile);
    }
  }
  return info.id;
}
