{
  if (file instanceof LightVirtualFile) {
    final CharSequence content=((LightVirtualFile)file).getContent();
    return returnReader ? new CharSequenceReader(content) : content;
  }
  final InputStreamReader reader=new InputStreamReader(file.getInputStream(),file.getCharset());
  try {
    char[] chars=new char[(int)file.getLength()];
    int count=0;
    while (count < chars.length) {
      int n=reader.read(chars,count,chars.length - count);
      if (n <= 0) {
        break;
      }
      count+=n;
    }
    return returnReader ? new CharArrayReader(chars,0,count) : new CharArrayCharSequence(chars,0,count);
  }
  finally {
    reader.close();
  }
}
