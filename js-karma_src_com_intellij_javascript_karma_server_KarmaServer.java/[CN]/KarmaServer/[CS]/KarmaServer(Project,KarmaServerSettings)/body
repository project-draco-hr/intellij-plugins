{
  myServerSettings=serverSettings;
  myKarmaJsSourcesLocator=new KarmaJsSourcesLocator(serverSettings.getKarmaPackageDir());
  myCoveragePeer=serverSettings.isWithCoverage() ? new KarmaCoveragePeer() : null;
  KillableColoredProcessHandler processHandler=startServer(serverSettings);
  myProcessHashCode=System.identityHashCode(processHandler.getProcess());
  File configurationFile=myServerSettings.getConfigurationFile();
  myState=new KarmaServerState(this,configurationFile);
  myProcessOutputArchive=new ProcessOutputArchive(processHandler,new Consumer<String>(){
    @Override public void consume(    String line){
      myState.onStandardOutputLineAvailable(line);
    }
  }
);
  myWatcher=new KarmaWatcher(this);
  registerStreamEventHandlers();
  myProcessOutputArchive.startNotify();
  myDisposable=new MyDisposable();
  Disposer.register(project,myDisposable);
  myRestarter=new KarmaServerRestarter(configurationFile,myDisposable);
}
