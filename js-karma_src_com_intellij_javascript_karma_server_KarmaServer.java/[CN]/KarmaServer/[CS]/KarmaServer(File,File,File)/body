{
  myCoverageTempDir=FileUtil.createTempDirectory("karma-intellij-coverage-",null);
  myKarmaJsSourcesLocator=new KarmaJsSourcesLocator(karmaPackageDir);
  myState=new KarmaServerState(this);
  final ProcessHandler processHandler=startServer(nodeInterpreter,configurationFile);
  myProcessOutputArchive=new ProcessOutputArchive(processHandler);
  registerStreamEventHandlers();
  myProcessOutputArchive.startNotify();
  Disposer.register(ApplicationManager.getApplication(),new Disposable(){
    @Override public void dispose(){
      if (!processHandler.isProcessTerminated()) {
        ScriptRunnerUtil.terminateProcessHandler(processHandler,500,null);
      }
    }
  }
);
}
