{
  myConfigurationFile=configurationFile;
  myKarmaIntellijPackageDir=findKarmaIntellijPackageDir(karmaPackageDir);
  try {
    long start=System.nanoTime();
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
    }
    myProcessHandler=startServer(nodeInterpreter,configurationFile);
    System.out.printf("Starting server takes: %.2f ms\n",(System.nanoTime() - start) / 1000000.0);
  }
 catch (  ExecutionException e) {
    throw new IOException("Can not create karma server process",e);
  }
  myProcessEventStore=new ProcessEventStore(myProcessHandler);
  myProcessEventStore.addStreamEventListener(new StreamEventListener(){
    @Override public void on(    @NotNull String eventText){
      System.out.println("Got " + eventText);
    }
  }
);
  myProcessEventStore.startNotify();
  Disposer.register(ApplicationManager.getApplication(),new Disposable(){
    @Override public void dispose(){
      ScriptRunnerUtil.terminateProcess(myProcessHandler,500,null);
    }
  }
);
}
