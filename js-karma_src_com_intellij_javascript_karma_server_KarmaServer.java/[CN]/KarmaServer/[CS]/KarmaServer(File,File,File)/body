{
  myKarmaJsSourcesLocator=new KarmaJsSourcesLocator(karmaPackageDir);
  final ProcessHandler processHandler=startServer(nodeInterpreter,configurationFile);
  myState=new KarmaServerState(this,processHandler);
  myProcessOutputArchive=new ProcessOutputArchive(processHandler);
  myWatcher=new KarmaWatcher(this);
  registerStreamEventHandlers();
  myProcessOutputArchive.startNotify();
  Disposer.register(ApplicationManager.getApplication(),new Disposable(){
    @Override public void dispose(){
      if (!processHandler.isProcessTerminated()) {
        ScriptRunnerUtil.terminateProcessHandler(processHandler,500,null);
      }
    }
  }
);
}
