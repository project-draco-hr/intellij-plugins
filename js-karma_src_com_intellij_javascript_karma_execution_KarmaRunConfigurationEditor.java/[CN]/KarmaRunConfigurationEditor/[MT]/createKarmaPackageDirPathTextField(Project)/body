{
  TextFieldWithHistoryWithBrowseButton karmaPackageDirPathComponent=new TextFieldWithHistoryWithBrowseButton();
  final TextFieldWithHistory textFieldWithHistory=karmaPackageDirPathComponent.getChildComponent();
  SwingHelper.addHistoryOnExpansion(textFieldWithHistory,new Producer<List<String>>(){
    @Nullable @Override public List<String> produce(){
      NodeModuleManager manager=NodeModuleManager.getInstance(project);
      Collection<CompletionModuleInfo> modules=manager.findModulesWithName(project.getBaseDir(),KarmaGlobalSettingsUtil.NODE_PACKAGE_NAME);
      List<String> moduleDirs=ContainerUtil.newArrayListWithExpectedSize(modules.size());
      for (      CompletionModuleInfo module : modules) {
        VirtualFile dir=module.getVirtualFile();
        if (dir != null && dir.isDirectory()) {
          moduleDirs.add(FileUtil.toSystemDependentName(dir.getPath()));
        }
      }
      Collections.sort(moduleDirs);
      return moduleDirs;
    }
  }
);
  SwingHelper.installFileCompletionAndBrowseDialog(project,karmaPackageDirPathComponent,KarmaBundle.message("runConfiguration.karma_package_dir.browse_dialog.title"));
  return karmaPackageDirPathComponent;
}
