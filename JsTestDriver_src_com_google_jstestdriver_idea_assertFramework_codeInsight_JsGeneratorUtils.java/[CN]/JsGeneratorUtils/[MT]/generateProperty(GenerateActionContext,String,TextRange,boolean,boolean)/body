{
  final int caretOffset=context.getDocumentCaretOffset();
  final boolean insideWhitespaceArea=whitespaceTextRange.contains(caretOffset);
  int moveCaretToOffset=insideWhitespaceArea ? caretOffset : whitespaceTextRange.getStartOffset();
  if (commaBeforeRequired) {
    generateCommaAt(context,whitespaceTextRange.getStartOffset());
    moveCaretToOffset++;
  }
  context.getCaretModel().moveToOffset(moveCaretToOffset);
  LineRange whitespaceLineRange=createLineRangeByTextRange(context,whitespaceTextRange);
  int caretLineNumber=getLineNumberAtOffset(context,moveCaretToOffset);
  String leadingNewLine="";
  if (caretLineNumber == whitespaceLineRange.getStartLine()) {
    leadingNewLine="\n";
  }
  Template template=createDefaultTemplate(leadingNewLine + markedPropertyStr);
  if (commaAfterRequired) {
    template.addTextSegment(",");
  }
  if (whitespaceLineRange.getStartLine() == whitespaceLineRange.getEndLine()) {
    template.addTextSegment("\n");
  }
  context.startTemplate(template);
}
