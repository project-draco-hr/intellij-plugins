{
  PropertiesComponent propertiesComponent=PropertiesComponent.getInstance();
  String karmaNodePackageDir=propertiesComponent.getValue(KARMA_NODE_PACKAGE_DIR);
  if (StringUtil.isEmpty(karmaNodePackageDir)) {
    List<CompletionModuleInfo> modules=ContainerUtil.newArrayList();
    VirtualFile requester=getRequester(project,configFilePath);
    NodeModuleSearchUtil.findModulesWithName(modules,NODE_PACKAGE_NAME,requester,getNodeSettings(),true);
    for (    CompletionModuleInfo module : modules) {
      VirtualFile moduleRoot=module.getVirtualFile();
      if (moduleRoot != null && moduleRoot.isValid() && moduleRoot.isDirectory()) {
        karmaNodePackageDir=FileUtil.toSystemDependentName(moduleRoot.getPath());
        break;
      }
    }
  }
  return karmaNodePackageDir;
}
