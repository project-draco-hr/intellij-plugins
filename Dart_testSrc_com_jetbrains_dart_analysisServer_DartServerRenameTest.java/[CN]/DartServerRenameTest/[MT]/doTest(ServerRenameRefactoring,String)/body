{
  final RefactoringStatus initialConditions=refactoring.checkInitialConditions();
  assertNotNull(initialConditions);
  assertTrue(initialConditions.isOK());
  refactoring.setNewName(newName);
  final RefactoringStatus finalConditions=refactoring.checkFinalConditions();
  assertNotNull(finalConditions);
  assertTrue(finalConditions.isOK());
  final SourceChange change=refactoring.getChange();
  assertNotNull(change);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final Set<String> excludedIds=refactoring.getPotentialEdits();
      try {
        AssistUtils.applySourceChange(myFixture.getProject(),change,false,excludedIds);
      }
 catch (      DartSourceEditException e) {
        fail(e.getMessage());
      }
    }
  }
);
  myFixture.checkResultByFile(getTestName(false) + ".after.dart");
}
