{
  final GeneralCommandLine command=new GeneralCommandLine().withWorkDirectory(myWorkingDirectory);
  DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null) {
    throw new StagehandException(DartBundle.message("dart.pub.stagehand.exception.no.sdk"));
  }
  final File pubFile=new File(DartSdkUtil.getPubPath(sdk));
  command.setExePath(pubFile.getPath());
  command.addParameters(pubParameters);
  final OSProcessHandler processHandler;
  try {
    processHandler=new OSProcessHandler(command);
  }
 catch (  ExecutionException e) {
    throw new StagehandException(e);
  }
  final OutputListener outputListener=new OutputListener();
  processHandler.addProcessListener(outputListener);
  processHandler.addProcessListener(new ProcessAdapter(){
    @Override public void processTerminated(    final ProcessEvent event){
      myLatch.countDown();
    }
  }
);
  processHandler.startNotify();
  try {
    myLatch.await();
  }
 catch (  InterruptedException e) {
  }
  return outputListener.getOutput();
}
