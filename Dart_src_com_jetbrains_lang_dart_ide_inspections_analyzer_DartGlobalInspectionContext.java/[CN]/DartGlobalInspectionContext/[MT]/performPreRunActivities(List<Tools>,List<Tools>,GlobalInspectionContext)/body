{
  final Project project=context.getProject();
  AnalysisScope scope=context.getRefManager().getScope();
  SearchScope searchScope=scope == null ? GlobalSearchScope.EMPTY_SCOPE : scope.toSearchScope();
  final GlobalSearchScope globalSearchScope=(GlobalSearchScope)searchScope.union(GlobalSearchScope.EMPTY_SCOPE);
  final Set<String> allLibraryNames=ApplicationManager.getApplication().runReadAction(new Computable<Set<String>>(){
    @Override public Set<String> compute(){
      return DartLibraryIndex.getAllLibraryNames(project);
    }
  }
);
  List<VirtualFile> libraryRoots=new ArrayList<VirtualFile>();
  setIndicatorText("Finding Dart libraries");
  for (  String libraryName : allLibraryNames) {
    libraryRoots.addAll(DartLibraryIndex.findSingleLibraryClass(libraryName,globalSearchScope));
  }
  setIndicatorText("Running Dart Analyzer");
  for (  VirtualFile libraryRoot : libraryRoots) {
    analyzeLibrary(libraryRoot,project);
  }
}
