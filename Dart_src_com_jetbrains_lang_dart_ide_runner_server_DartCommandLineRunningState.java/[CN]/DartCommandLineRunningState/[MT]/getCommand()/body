{
  DartSettings dartSettings=DartSettings.getSettingsForModule(module);
  String dartExecutablePath=DartSdkUtil.getCompilerPathByFolderPath(dartSettings != null ? dartSettings.getSdkPath() : null);
  if (dartSettings == null || dartExecutablePath == null) {
    throw new ExecutionException(DartBundle.message("bad.home.for.sdk",module.getName()));
  }
  final VirtualFile libraryFile=VirtualFileManager.getInstance().findFileByUrl(VfsUtilCore.pathToUrl(filePath));
  if (libraryFile == null) {
    throw new ExecutionException(DartBundle.message("bad.script.path",filePath));
  }
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  commandLine.setExePath(dartExecutablePath);
  commandLine.setWorkDirectory(PathUtil.getParentPath(filePath));
  commandLine.setPassParentEnvironment(true);
  setupUserProperties(libraryFile,commandLine,dartSettings);
  addConsoleFilters(new DartStackTraceMessageFilter(module.getProject(),filePath));
  return commandLine;
}
