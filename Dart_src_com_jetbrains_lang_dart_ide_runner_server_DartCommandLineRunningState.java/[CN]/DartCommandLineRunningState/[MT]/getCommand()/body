{
  final DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null) {
    throw new ExecutionException("Dart SDK is not configured");
  }
  final String dartExePath=DartSdkUtil.getDartExePath(sdk);
  final VirtualFile libraryFile=LocalFileSystem.getInstance().findFileByPath(myFilePath);
  if (libraryFile == null) {
    throw new ExecutionException(DartBundle.message("bad.script.path",myFilePath));
  }
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  commandLine.setExePath(dartExePath);
  commandLine.setWorkDirectory(myWorkingDirectory);
  commandLine.setPassParentEnvironment(true);
  commandLine.getEnvironment().putAll(myEnvs);
  setupUserProperties(commandLine,libraryFile);
  return commandLine;
}
