{
  final DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null) {
    throw new ExecutionException("Dart SDK is not configured");
  }
  final String dartExePath=DartSdkUtil.getDartExePath(sdk);
  final VirtualFile libraryFile=LocalFileSystem.getInstance().findFileByPath(filePath);
  if (libraryFile == null) {
    throw new ExecutionException(DartBundle.message("bad.script.path",filePath));
  }
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  commandLine.setExePath(dartExePath);
  commandLine.setWorkDirectory(PathUtil.getParentPath(filePath));
  commandLine.setPassParentEnvironment(true);
  setupUserProperties(commandLine,libraryFile);
  return commandLine;
}
