{
  final DartSdk sdk=DartSdk.getDartSdk(getEnvironment().getProject());
  if (sdk == null) {
    throw new ExecutionException(DartBundle.message("dart.sdk.is.not.configured"));
  }
  final String dartExePath=DartSdkUtil.getDartExePath(sdk);
  final VirtualFile dartFile;
  try {
    dartFile=myRunnerParameters.getDartFile();
  }
 catch (  RuntimeConfigurationError e) {
    throw new ExecutionException(e);
  }
  final String workingDir=StringUtil.isEmptyOrSpaces(myRunnerParameters.getWorkingDirectory()) ? dartFile.getParent().getPath() : myRunnerParameters.getWorkingDirectory();
  final GeneralCommandLine commandLine=new GeneralCommandLine().withWorkDirectory(workingDir);
  commandLine.setExePath(FileUtil.toSystemDependentName(dartExePath));
  commandLine.getEnvironment().putAll(myRunnerParameters.getEnvs());
  commandLine.setPassParentEnvironment(myRunnerParameters.isIncludeParentEnvs());
  setupParameters(getEnvironment().getProject(),commandLine,myRunnerParameters,overriddenMainFilePath);
  return commandLine;
}
