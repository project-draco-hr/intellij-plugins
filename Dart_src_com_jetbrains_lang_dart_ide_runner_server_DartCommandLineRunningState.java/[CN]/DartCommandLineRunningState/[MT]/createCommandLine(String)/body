{
  final DartSdk sdk=DartSdk.getDartSdk(getEnvironment().getProject());
  if (sdk == null) {
    throw new ExecutionException(DartBundle.message("dart.sdk.is.not.configured"));
  }
  final String dartExePath=DartSdkUtil.getDartExePath(sdk);
  final String workingDir;
  try {
    workingDir=myRunnerParameters.computeProcessWorkingDirectory();
  }
 catch (  RuntimeConfigurationError e) {
    throw new ExecutionException(e);
  }
  final GeneralCommandLine commandLine=new GeneralCommandLine().withWorkDirectory(workingDir);
  commandLine.setCharset(CharsetToolkit.UTF8_CHARSET);
  commandLine.setExePath(FileUtil.toSystemDependentName(dartExePath));
  commandLine.getEnvironment().putAll(myRunnerParameters.getEnvs());
  commandLine.withParentEnvironmentType(myRunnerParameters.isIncludeParentEnvs() ? ParentEnvironmentType.CONSOLE : ParentEnvironmentType.NONE);
  setupParameters(getEnvironment().getProject(),sdk,commandLine,myRunnerParameters,overriddenMainFilePath);
  return commandLine;
}
