{
  final DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null) {
    throw new ExecutionException(DartBundle.message("dart.sdk.is.not.configured"));
  }
  final String dartExePath=DartSdkUtil.getDartExePath(sdk);
  final String filePath=myRunnerParameters.getFilePath();
  if (StringUtil.isEmptyOrSpaces(filePath)) {
    throw new ExecutionException(DartBundle.message("path.to.dart.file.not.set"));
  }
  final VirtualFile mainDartFile=LocalFileSystem.getInstance().findFileByPath(filePath);
  if (mainDartFile == null) {
    throw new ExecutionException(DartBundle.message("dart.file.not.found",filePath));
  }
  final String workingDir=StringUtil.notNullize(myRunnerParameters.getWorkingDirectory(),PathUtil.getParentPath(filePath));
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  commandLine.setExePath(dartExePath);
  commandLine.setWorkDirectory(workingDir);
  commandLine.getEnvironment().putAll(myRunnerParameters.getEnvs());
  commandLine.setPassParentEnvironment(myRunnerParameters.isIncludeParentEnvs());
  setupParameters(commandLine,mainDartFile);
  return commandLine;
}
