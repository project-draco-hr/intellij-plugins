{
  try {
    checkCanAddContentRoot(myModule,myContentRoot);
  }
 catch (  Exception e) {
    showErrorDialog(myModule,e);
    return;
  }
  final ModifiableRootModel modifiableModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
  try {
    modifiableModel.addContentEntry(myContentRoot);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        modifiableModel.commit();
      }
    }
);
    final VirtualFile otherPubspec=myContentRoot.findChild(PubspecYamlUtil.PUBSPEC_YAML);
    if (otherPubspec != null) {
      DartProjectComponent.excludeBuildAndPackagesFolders(myModule,otherPubspec);
      final AnAction pubGetAction=ActionManager.getInstance().getAction("Dart.pub.get");
      if (pubGetAction instanceof DartPubGetAction) {
        ((DartPubGetAction)pubGetAction).performPubAction(myModule,otherPubspec,false);
      }
    }
    showSuccessNotification(myModule,myContentRoot);
  }
 catch (  Exception e) {
    showErrorDialog(myModule,e);
  }
 finally {
    if (!modifiableModel.isDisposed()) {
      modifiableModel.dispose();
    }
  }
  final VirtualFile yamlFile=DartResolveUtil.getRealVirtualFile(psiFile);
  if (yamlFile != null && PubspecYamlUtil.PUBSPEC_YAML.equals(yamlFile.getName())) {
    DartProjectComponent.excludeBuildAndPackagesFolders(myModule,yamlFile);
  }
}
