{
  final TreeMap<Integer,ByteArray> sortedMap=new TreeMap<Integer,ByteArray>();
  map.forEachEntry(new TObjectIntProcedure<ByteArray>(){
    @Override public boolean execute(    ByteArray a,    int b){
      sortedMap.put(b,a);
      return true;
    }
  }
);
  writeU32(b,(sortedMap.size() == 0) ? 0 : sortedMap.size() + f);
  for (  ByteArray a : sortedMap.values()) {
    a.data.writeTo(b,a.start,a.end);
  }
}
