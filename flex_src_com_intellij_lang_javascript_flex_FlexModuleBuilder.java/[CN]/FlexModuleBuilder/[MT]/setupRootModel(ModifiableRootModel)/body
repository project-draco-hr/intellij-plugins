{
  final Module module=modifiableRootModel.getModule();
  setupResourceFilePatterns(module.getProject());
  if (TargetPlayerUtils.needToChangeSdk(mySdk,myTargetPlayerVersion)) {
    final Sdk sdk=TargetPlayerUtils.findOrCreateProperSdk(module.getProject(),mySdk,myTargetPlayerVersion);
    if (sdk != null) {
      mySdk=sdk;
    }
  }
  modifiableRootModel.setSdk(mySdk);
  final ContentEntry contentEntry=doAddContentEntry(modifiableRootModel);
  if (contentEntry == null)   return;
  if (mySourcePaths == null)   return;
  final FlexBuildConfiguration config=setupFlexBuildConfiguration(module);
  final VirtualFile sourceRootForFlexSetup=setupSourceRoots(contentEntry);
  if (sourceRootForFlexSetup != null) {
    try {
      FlexUtils.setupFlexConfigFileAndSampleCode(module,config,mySdk,myCreateCustomCompilerConfig ? myCustomCompilerConfigFileName : null,contentEntry.getFile(),myCreateSampleApp ? mySampleAppFileName : null,sourceRootForFlexSetup);
    }
 catch (    IOException ex) {
      throw new ConfigurationException(ex.getMessage());
    }
    if (myCreateHtmlWrapper) {
      scheduleHtmlWrapperCreation(module,sourceRootForFlexSetup,myCreateRunConfiguration);
    }
 else     if (myCreateRunConfiguration) {
      createRunConfiguration(module,sourceRootForFlexSetup);
    }
    if (myCreateAirDescriptor) {
      createAirDescriptor(sourceRootForFlexSetup.getPath(),config);
    }
  }
}
