{
  final GlobalSearchScope scope=GlobalSearchScope.allScope(project);
  final Ref<JSImplicitElement> result=new Ref<JSImplicitElement>(null);
  StubIndex.getInstance().processElements(index,lookupKey,project,scope,JSImplicitElementProvider.class,new Processor<JSImplicitElementProvider>(){
    @Override public boolean process(    JSImplicitElementProvider provider){
      final JSElementIndexingData indexingData=provider.getIndexingData();
      if (indexingData != null) {
        final Collection<JSImplicitElement> elements=indexingData.getImplicitElements();
        if (elements != null) {
          for (          JSImplicitElement element : elements) {
            if (element.getName().equals(lookupKey) && (index == AngularInjectionDelimiterIndex.KEY || AngularJSIndexingHandler.isAngularRestrictions(element.getTypeString()))) {
              result.set(element);
              final PsiFile file=element.getContainingFile();
              if ("ts".equals(file.getVirtualFile().getExtension())) {
                return false;
              }
            }
          }
        }
      }
      return true;
    }
  }
);
  return result.get();
}
