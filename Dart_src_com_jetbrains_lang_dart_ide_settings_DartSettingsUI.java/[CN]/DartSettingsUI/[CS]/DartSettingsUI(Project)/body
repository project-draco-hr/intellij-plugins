{
  myProject=project;
  myPathChooser.getButton().addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final FileChooserDescriptor descriptor=new FileChooserDescriptor(false,true,false,false,false,false);
      final VirtualFile file=FileChooser.chooseFile(descriptor,myMainPanel,null,null);
      if (file != null && getExecutablePathByFolderPath(file.getPath(),"dart") == null) {
        Messages.showOkCancelDialog(myProject,DartBundle.message("dart.sdk.bad.home.path.to.dartvm"),DartBundle.message("dart.sdk.name"),DartIcons.Dart_16);
      }
 else       if (file != null && getExecutablePathByFolderPath(file.getPath(),"dart") != null) {
        myPathChooser.setText(FileUtil.toSystemDependentName(file.getPath()));
        updateUI();
        if (!SystemInfo.isWindows && getSettings().getAnalyzer() == null) {
          Messages.showErrorDialog(myProject,DartBundle.message("dart.sdk.bad.analyzer.path",getSettings().getAnalyzerUrl()),DartBundle.message("dart.warning"));
        }
      }
    }
  }
);
  mySetupScopeLabel.addHyperlinkListener(new HyperlinkListener(){
    @Override public void hyperlinkUpdate(    HyperlinkEvent e){
      if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED && isDartSDKConfigured()) {
        JSLibraryManager libraryManager=ServiceManager.getService(myProject,JSLibraryManager.class);
        final JSLibraryMappings mappings=ServiceManager.getService(project,JSLibraryMappings.class);
        ShowSettingsUtil.getInstance().editConfigurable(project,new ScriptingContextsConfigurable(project,mappings));
        AccessToken writeToken=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
        libraryManager.commitChanges();
        writeToken.finish();
      }
 else       if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED && !isDartSDKConfigured() && isDartSDKPathValid()) {
        updateOrCreateDartLibrary();
        updateUI();
      }
 else       if (!isDartSDKPathValid()) {
        Messages.showOkCancelDialog(myProject,DartBundle.message("invalid.dart.sdk.path"),DartBundle.message("dart.sdk.name"),DartIcons.Dart_16);
      }
    }
  }
);
  myDartSdkEnabled.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final JSLibraryManager libraryManager=JSLibraryManager.getInstance(myProject);
      final ScriptingLibraryMappings libraryMappings=libraryManager.getLibraryMappings();
      final String libName=DartBundle.message("dart.sdk.name");
      if (libraryMappings.isAssociatedWithProject(libName)) {
        libraryMappings.disassociateWithProject(libName);
      }
 else       if (libraryManager.getLibraryByName(libName) != null) {
        libraryMappings.associate(null,libName,false);
      }
      AccessToken writeToken=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
      libraryManager.commitChanges();
      writeToken.finish();
      updateUI();
    }
  }
);
}
