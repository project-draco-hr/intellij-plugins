{
  myProject=project;
  myPathChooser.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      FileChooser.chooseFile(FileChooserDescriptorFactory.createSingleFolderDescriptor(),null,myMainPanel,null,new Consumer<VirtualFile>(){
        @Override public void consume(        @NotNull VirtualFile sdkFolder){
          if (getExecutablePathByFolderPath(sdkFolder.getPath(),"dart") == null) {
            final VirtualFile child=sdkFolder.findChild("dart-sdk");
            if (child != null && child.isDirectory()) {
              sdkFolder=child;
            }
          }
          if (getExecutablePathByFolderPath(sdkFolder.getPath(),"dart") == null) {
            Messages.showOkCancelDialog(myProject,DartBundle.message("dart.sdk.bad.path",FileUtil.toSystemDependentName(sdkFolder.getPath())),DartBundle.message("dart.sdk.name"),DartIcons.Dart_16);
          }
 else {
            myPathChooser.setText(FileUtil.toSystemDependentName(sdkFolder.getPath()));
            updateUI();
          }
        }
      }
);
    }
  }
);
  mySetupScopeLabel.addHyperlinkListener(new HyperlinkListener(){
    @Override public void hyperlinkUpdate(    HyperlinkEvent e){
      if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED && DartSettingsUtil.isDartSDKConfigured(myProject)) {
        JSLibraryManager libraryManager=ServiceManager.getService(myProject,JSLibraryManager.class);
        final JSLibraryMappings mappings=ServiceManager.getService(project,JSLibraryMappings.class);
        ShowSettingsUtil.getInstance().editConfigurable(project,new ScriptingContextsConfigurable(project,mappings));
        AccessToken writeToken=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
        libraryManager.commitChanges();
        writeToken.finish();
      }
 else       if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED && !DartSettingsUtil.isDartSDKConfigured(myProject) && isDartSDKPathValid()) {
        updateOrCreateDartLibrary();
        updateUI();
      }
 else       if (!isDartSDKPathValid()) {
        Messages.showOkCancelDialog(myProject,DartBundle.message("invalid.dart.sdk.path"),DartBundle.message("dart.sdk.name"),DartIcons.Dart_16);
      }
    }
  }
);
  myDartSdkEnabledCheckBox.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final JSLibraryManager libraryManager=JSLibraryManager.getInstance(myProject);
      final ScriptingLibraryMappings libraryMappings=libraryManager.getLibraryMappings();
      final String libName=DartBundle.message("dart.sdk.name");
      if (libraryMappings.isAssociatedWithProject(libName)) {
        libraryMappings.disassociateWithProject(libName);
      }
 else       if (libraryManager.getLibraryByName(libName) != null) {
        libraryMappings.associate(null,libName,false);
      }
      AccessToken writeToken=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
      libraryManager.commitChanges();
      writeToken.finish();
      updateUI();
    }
  }
);
}
