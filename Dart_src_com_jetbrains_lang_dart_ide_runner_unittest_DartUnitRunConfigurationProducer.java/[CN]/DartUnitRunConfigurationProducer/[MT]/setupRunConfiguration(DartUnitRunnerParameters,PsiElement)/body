{
  if (psiElement instanceof DartCallExpression) {
    final String testName=findTestName((DartCallExpression)psiElement);
    final List<VirtualFile> virtualFiles=DartResolveUtil.findLibrary(psiElement.getContainingFile());
    if (testName == null || virtualFiles.isEmpty()) {
      return false;
    }
    runnerParams.setTestName(testName);
    runnerParams.setScope(isTest((DartCallExpression)psiElement) ? Scope.METHOD : Scope.GROUP);
    final String dartFilePath=virtualFiles.iterator().next().getPath();
    runnerParams.setFilePath(dartFilePath);
    runnerParams.setWorkingDirectory(PathUtil.getParentPath(dartFilePath));
    return true;
  }
 else {
    final PsiFile psiFile=psiElement.getContainingFile();
    if (psiFile instanceof DartFile) {
      final VirtualFile virtualFile=DartResolveUtil.getRealVirtualFile((DartFile)psiElement);
      if (virtualFile == null || !DartResolveUtil.isLibraryRoot((DartFile)psiElement)) {
        return false;
      }
      runnerParams.setTestName(DartResolveUtil.getLibraryName((DartFile)psiElement));
      runnerParams.setScope(Scope.ALL);
      final String dartFilePath=FileUtil.toSystemIndependentName(virtualFile.getPath());
      runnerParams.setFilePath(dartFilePath);
      runnerParams.setWorkingDirectory(PathUtil.getParentPath(dartFilePath));
      return true;
    }
  }
  return false;
}
