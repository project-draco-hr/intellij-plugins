{
  final Message message=((Message)packet);
  if (message.getType() == Message.Type.ERROR) {
    UIUtil.invokeLater(new Runnable(){
      @Override public void run(){
        String from=(message.getFrom() != null) ? getMsg("from.0.lf",message.getFrom()) : "";
        LOG.warn(getMsg("jabber.error.text",from,(message.getError() == null ? "N/A" : message.getError().toString())));
      }
    }
);
    return;
  }
  if (myIgnoreList.isIgnored(packet.getFrom())) {
    return;
  }
  Element element=null;
  for (  PacketExtension o : message.getExtensions()) {
    if (o instanceof JDOMExtension) {
      element=((JDOMExtension)o).getElement();
    }
  }
  if (element != null && !RESPONSE.equals(element.getName())) {
    processAndSendResponse(element,message);
  }
 else   if (element == null && message.getBody() != null) {
    MessageEvent event=EventFactory.createMessageEvent(JabberTransport.this,getFrom(message),message.getBody());
    if (message.getThread() != null) {
      myUser2Thread.put(getFrom(message),message.getThread());
    }
    getBroadcaster().fireEvent(event);
  }
}
