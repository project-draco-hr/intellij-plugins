{
  if (ex != null) {
    Runnable runnable=new Runnable(){
      public void run(){
        if (myEOFReached)         return;
        boolean agentVersionMismatch=ex instanceof AgentVersionMismatchProblem;
        if (myStopCpuButton.isEnabled() && !agentVersionMismatch) {
          resetDependents(true);
          dumpCurrentData(data);
        }
        switchToState(State.SIMPLE_WORKING);
        if (ex instanceof EOFException) {
          myEOFReached=true;
          myStatus.setText("Profiler agent disconnected" + (agentVersionMismatch ? " , agent version is different" : ""));
          return;
        }
        if (ex instanceof SocketException) {
          myEOFReached=true;
          myStatus.setText("Unexpected loss of connection");
          final String message="Unexpected loss of connection with Profiler Agent:<br/>" + ex.getLocalizedMessage();
          NOTIFICATION_GROUP.createNotification(message,NotificationType.WARNING).notify(getProject());
          return;
        }
        NOTIFICATION_GROUP.createNotification("Connection error:<br/>" + ex.getLocalizedMessage(),NotificationType.ERROR).notify(getProject());
      }
    }
;
    invokeOnEdt(runnable);
  }
}
