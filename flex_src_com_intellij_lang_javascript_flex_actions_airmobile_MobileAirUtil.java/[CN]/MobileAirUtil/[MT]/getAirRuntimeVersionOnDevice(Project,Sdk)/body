{
  final Ref<String> versionRef=new Ref<String>();
  final boolean ok=ExternalTask.runWithProgress(new AdtTask(project,sdk){
    protected void appendAdtOptions(    final List<String> command){
      command.add("-runtimeVersion");
      command.add("-platform");
      command.add("android");
    }
    protected boolean checkMessages(    final List<String> messages){
      if (messages.size() == 1) {
        final String output=messages.get(0);
        if (output.startsWith("Failed to find package com.adobe.air")) {
          versionRef.set("");
          return true;
        }
 else         if (AIR_VERSION_PATTERN.matcher(output).matches()) {
          versionRef.set(output);
          return true;
        }
      }
      return false;
    }
  }
,FlexBundle.message("checking.air.version"),FlexBundle.message("check.air.version.title"));
  if (!ok) {
    throw new AdtException();
  }
  return versionRef.get();
}
