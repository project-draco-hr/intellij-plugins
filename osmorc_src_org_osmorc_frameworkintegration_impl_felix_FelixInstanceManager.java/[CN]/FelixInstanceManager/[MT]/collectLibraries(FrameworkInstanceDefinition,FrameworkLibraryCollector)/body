{
  final VirtualFile installFolder=LocalFileSystem.getInstance().findFileByPath(frameworkInstanceDefinition.getBaseFolder());
  if (installFolder == null || !installFolder.isDirectory()) {
    LOG.warn(frameworkInstanceDefinition.getBaseFolder() + " is not a folder");
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      installFolder.refresh(false,true);
      List<VirtualFile> directoriesToAdd=new ArrayList<VirtualFile>();
      directoriesToAdd.add(installFolder);
      VirtualFile binFolder=installFolder.findChild("bin");
      if (binFolder != null) {
        if (!binFolder.isDirectory()) {
          LOG.warn("The Felix bin-Folder is not a directory.");
        }
 else {
          directoriesToAdd.add(binFolder);
        }
      }
      VirtualFile bundleFolder=installFolder.findChild("bundle");
      if (bundleFolder != null) {
        if (!bundleFolder.isDirectory()) {
          LOG.warn("The Felix bundle-folder is not a directory");
        }
 else {
          directoriesToAdd.add(bundleFolder);
        }
      }
      collector.collectFrameworkLibraries(new FelixSourceFinder(),directoriesToAdd);
    }
  }
);
}
