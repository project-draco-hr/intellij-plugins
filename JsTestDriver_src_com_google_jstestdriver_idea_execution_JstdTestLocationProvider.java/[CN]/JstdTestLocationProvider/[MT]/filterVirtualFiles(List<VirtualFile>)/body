{
  boolean ok=true;
  for (  VirtualFile file : files) {
    if (!file.isValid()) {
      ok=false;
      break;
    }
  }
  if (ok) {
    return files;
  }
  return ContainerUtil.filter(files,new Condition<VirtualFile>(){
    @Override public boolean value(    VirtualFile file){
      return file.isValid();
    }
  }
);
}
