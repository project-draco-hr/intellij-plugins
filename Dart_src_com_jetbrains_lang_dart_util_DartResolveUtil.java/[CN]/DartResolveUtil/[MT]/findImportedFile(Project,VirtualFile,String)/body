{
  if (importText.startsWith(PACKAGE_PREFIX)) {
    final VirtualFile pubspecYamlFile=PubspecYamlUtil.getPubspecYamlFile(project,contextFile);
    final String pubspecName=pubspecYamlFile == null ? null : PubspecYamlUtil.getPubspecName(pubspecYamlFile);
    final String prefix=pubspecName == null ? null : PACKAGE_PREFIX + pubspecName + "/";
    if (prefix != null && importText.startsWith(prefix)) {
      final String relativePath=importText.substring(prefix.length());
      final VirtualFile libFolder=pubspecYamlFile.getParent().findChild("lib");
      return libFolder == null ? null : VfsUtilCore.findRelativeFile(relativePath,libFolder);
    }
    final VirtualFile packagesFolder=PubspecYamlUtil.getDartPackagesFolder(project,contextFile);
    final String relativePath=importText.substring(PACKAGE_PREFIX.length());
    return packagesFolder == null ? null : VfsUtilCore.findRelativeFile(relativePath,packagesFolder);
  }
  VirtualFile sourceFile=findRelativeFile(contextFile,importText);
  sourceFile=sourceFile != null ? sourceFile : VirtualFileManager.getInstance().findFileByUrl(importText);
  if (sourceFile == null && importText.startsWith(PACKAGE_PREFIX)) {
    final VirtualFile packagesFolder=PubspecYamlUtil.getDartPackagesFolder(project,contextFile);
    final String pathInPackages=FileUtil.toSystemIndependentName(importText.substring(PACKAGE_PREFIX.length()));
    sourceFile=packagesFolder == null ? null : VfsUtilCore.findRelativeFile(pathInPackages,packagesFolder);
  }
  return sourceFile;
}
