{
  final Element element=suggestion.getElement();
  final Location location=element == null ? null : element.getLocation();
  final DartLookupObject lookupObject=new DartLookupObject(project,location,suggestion.getRelevance());
  LookupElementBuilder lookup=LookupElementBuilder.create(lookupObject,suggestion.getCompletion());
  if (element != null) {
    if (element.isDeprecated()) {
      lookup=lookup.withStrikeoutness(true);
    }
    final String typeParameters=element.getTypeParameters();
    if (typeParameters != null) {
      lookup=lookup.appendTailText(typeParameters,false);
    }
    final String parameters=element.getParameters();
    if (parameters != null) {
      lookup=lookup.appendTailText(parameters,false);
    }
    final String returnType=element.getReturnType();
    if (!StringUtils.isEmpty(returnType)) {
      lookup=lookup.withTypeText(returnType,true);
    }
    Icon icon=getBaseImage(element);
    if (icon != null) {
      icon=applyVisibility(icon,element.isPrivate());
      icon=applyOverlay(icon,element.isFinal(),AllIcons.Nodes.FinalMark);
      icon=applyOverlay(icon,element.isConst(),AllIcons.Nodes.FinalMark);
      lookup=lookup.withIcon(icon);
    }
    final List<String> parameterNames=suggestion.getParameterNames();
    if (parameterNames != null) {
      lookup=lookup.withInsertHandler(new InsertHandler<LookupElement>(){
        @Override public void handleInsert(        InsertionContext context,        LookupElement item){
          final Editor editor=context.getEditor();
          final int offset=context.getTailOffset();
          context.getDocument().insertString(offset,"()");
          if (parameterNames.isEmpty()) {
            editor.getCaretModel().moveToOffset(offset + 2);
          }
 else {
            editor.getCaretModel().moveToOffset(offset + 1);
            final PsiElement psiElement=lookupObject.getElement();
            AutoPopupController.getInstance(project).autoPopupParameterInfo(editor,psiElement);
          }
        }
      }
);
    }
  }
  return lookup;
}
