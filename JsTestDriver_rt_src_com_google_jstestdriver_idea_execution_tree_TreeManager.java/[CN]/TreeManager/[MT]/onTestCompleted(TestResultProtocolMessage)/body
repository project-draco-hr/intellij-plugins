{
  TestNode testNode=getOrCreateTestNode(message);
  if (message.log != null && !message.log.isEmpty()) {
    TCMessage stdOutMessage=TC.newTestStdOutMessage(testNode);
    stdOutMessage.addAttribute(TCAttribute.STDOUT,message.log + "\n");
    printTCMessage(stdOutMessage);
  }
  TestResult.Result result=TestResult.Result.valueOf(message.result);
  if (result == TestResult.Result.passed) {
    TCMessage testFinishedMessage=TC.newTestFinishedMessage(testNode);
    testFinishedMessage.addIntAttribute(TCAttribute.TEST_DURATION,(int)message.duration);
    printTCMessage(testFinishedMessage);
  }
 else {
    final String stackStr;
    if (message.stack.startsWith(message.message)) {
      String s=message.stack.substring(message.message.length());
      stackStr=s.replaceFirst("^[\n\r]*","");
    }
 else {
      stackStr=message.stack;
    }
    TCMessage testFailedMessage=TC.newTestFailedMessage(testNode);
    testFailedMessage.addAttribute(TCAttribute.EXCEPTION_MESSAGE,message.message);
    testFailedMessage.addAttribute(TCAttribute.EXCEPTION_STACKTRACE,stackStr);
    if (result == TestResult.Result.error) {
      testFailedMessage.addAttribute(TCAttribute.IS_TEST_ERROR,"yes");
    }
    testFailedMessage.addIntAttribute(TCAttribute.TEST_DURATION,(int)message.duration);
    printTCMessage(testFailedMessage);
  }
}
