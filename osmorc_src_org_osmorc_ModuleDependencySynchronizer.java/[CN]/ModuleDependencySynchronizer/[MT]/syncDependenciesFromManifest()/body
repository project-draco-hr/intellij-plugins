{
  if (osmorcFacetUtil.hasOsmorcFacet(module) && !osmorcFacetUtil.getOsmorcFacet(module).getConfiguration().isOsmorcControlsManifest()) {
    application.runWriteAction(new Runnable(){
      public void run(){
        ModifiableRootModel model=moduleRootManager.getModifiableModel();
        Collection<Object> newBundles=bundleManager.determineBundleDependencies(module);
        List<OrderEntry> oldOrderEntries=determineOldModuleDependencies(model);
        List<OrderEntry> obsoleteOrderEntries=determineObsoleteModuleDependencies(oldOrderEntries,newBundles);
        boolean commitNeeded=false;
        commitNeeded|=removeObsoleteModuleDependencies(model,obsoleteOrderEntries);
        commitNeeded|=addNewModuleDependencies(model,newBundles);
        commitNeeded|=checkAndSetReexport(model,newBundles);
        if (commitNeeded) {
          model.commit();
        }
 else {
          model.dispose();
        }
      }
    }
);
  }
}
