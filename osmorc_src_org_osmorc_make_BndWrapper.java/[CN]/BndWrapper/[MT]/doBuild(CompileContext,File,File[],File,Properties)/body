{
  ReportingBuilder builder=new ReportingBuilder(compileContext,VfsUtil.pathToUrl(bndFile.getPath()));
  builder.setPedantic(false);
  builder.setProperties(bndFile);
  builder.mergeProperties(additionalProperties,true);
  if (builder.getProperty(Constants.EXPORT_PACKAGE) == null) {
    builder.setProperty(Constants.EXPORT_PACKAGE,"*");
  }
  builder.setClasspath(classpath);
  builder.begin();
  String manifest=builder.getProperty(ReportingBuilder.MANIFEST);
  if (manifest != null) {
    File manifestFile=builder.getFile(manifest);
    if (manifestFile != null && manifestFile.exists() && manifestFile.canRead()) {
      Properties props=new Properties();
      try {
        props.load(new FileInputStream(manifestFile));
        final String value=props.getProperty(Attributes.Name.MANIFEST_VERSION.toString());
        if (value == null || value.length() == 0 || value.trim().length() == 0) {
          compileContext.addMessage(CompilerMessageCategory.WARNING,"Your manifest does not contain a Manifest-Version entry. This will produce an empty manifest in the resulting bundle.",VfsUtil.pathToUrl(manifestFile.getAbsolutePath()),0,0);
        }
      }
 catch (      Exception ex) {
        compileContext.addMessage(CompilerMessageCategory.INFORMATION,"There was a problem reading your manifest.",null,0,0);
      }
    }
  }
  Jar jar=builder.build();
  jar.setName(output.getName());
  jar.write(output);
  builder.close();
  return true;
}
