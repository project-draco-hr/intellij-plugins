{
  final BufferedImage image;
  try {
    image=getImage();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  out.writeShort(image.getWidth());
  out.writeShort(image.getHeight());
  out.write(mimeType == null ? virtualFile.getName().endsWith(".png") : mimeType.equals("image/png"));
  for (  int pixel : image.getRGB(0,0,image.getWidth(),image.getHeight(),null,0,image.getWidth())) {
    out.writeInt(pixel);
  }
}
