{
  final Project project=context.getProject();
  if (!AngularIndexUtil.hasAngularJS(project))   return;
  final PsiElement parent=context.getParent();
  if (context instanceof XmlAttributeValueImpl && parent instanceof XmlAttribute) {
    final int length=context.getTextLength();
    if (AngularAttributesRegistry.isAngularExpressionAttribute((XmlAttribute)parent) && length > 1) {
      registrar.startInjecting(AngularJSLanguage.INSTANCE).addPlace(null,null,(PsiLanguageInjectionHost)context,new TextRange(1,length - 1)).doneInjecting();
      return;
    }
  }
  if (context instanceof XmlTextImpl || context instanceof XmlAttributeValueImpl) {
    final String start=AngularJSBracesUtil.getInjectionStart(project);
    final String end=AngularJSBracesUtil.getInjectionEnd(project);
    if (AngularJSBracesUtil.hasConflicts(start,end,context.getContainingFile()))     return;
    final String text=context.getText();
    int startIndex;
    int endIndex=-1;
    do {
      startIndex=text.indexOf(start,endIndex);
      endIndex=startIndex >= 0 ? text.indexOf(end,startIndex) : -1;
      endIndex=endIndex > 0 ? endIndex : text.length();
      final PsiElement injectionCandidate=startIndex >= 0 ? context.findElementAt(startIndex) : null;
      if (injectionCandidate != null && injectionCandidate.getNode().getElementType() != XmlTokenType.XML_COMMENT_CHARACTERS) {
        registrar.startInjecting(AngularJSLanguage.INSTANCE).addPlace(null,null,(PsiLanguageInjectionHost)context,new TextRange(startIndex + start.length(),endIndex)).doneInjecting();
      }
    }
 while (startIndex >= 0);
  }
}
