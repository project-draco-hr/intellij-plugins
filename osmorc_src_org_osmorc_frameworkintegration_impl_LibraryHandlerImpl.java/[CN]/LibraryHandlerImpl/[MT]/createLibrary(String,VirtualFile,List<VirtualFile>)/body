{
  Library library=_modifiableApplicationLibraryTableModel.createLibrary(getLibraryPrefix(instanceName) + classes.getNameWithoutExtension());
  Library.ModifiableModel modifiableLibraryModel=library.getModifiableModel();
  modifiableLibraryModel.addRoot(classes,OrderRootType.CLASSES);
  for (  VirtualFile source : sources) {
    VirtualFile sourceDir=FileUtil.getFolder(source);
    if (sourceDir != null) {
      modifiableLibraryModel.addRoot(sourceDir,OrderRootType.SOURCES);
    }
 else {
      throw new RuntimeException(source + " is neither a directory nor a JAR.");
    }
  }
  return modifiableLibraryModel;
}
