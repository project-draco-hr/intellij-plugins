{
  DesignerApplicationUtil.AdlRunConfiguration adlRunConfiguration;
  try {
    adlRunConfiguration=DesignerApplicationUtil.findSuitableFlexSdk(CHECK_DESCRIPTOR_PATH);
    if (adlRunConfiguration == null) {
      String message=FlexUIDesignerBundle.message(SystemInfo.isLinux ? "no.sdk.to.launch.designer.linux" : "no.sdk.to.launch.designer");
      showBalloon(debug,message,module.getProject(),new Consumer<String>(){
        @Override public void consume(        String id){
          if ("edit".equals(id)) {
            new ProjectJdksEditor(null,module.getProject(),WindowManager.getInstance().suggestParentWindow(module.getProject())).show();
          }
 else {
            LOG.error("unexpected id: " + id);
          }
        }
      }
);
      documentOpening=false;
      return;
    }
    if (DebugPathManager.IS_DEV) {
      final String fudHome=DebugPathManager.getFudHome();
      final List<String> arguments=new ArrayList<String>();
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        arguments.add("-p");
        arguments.add(fudHome + "/test-app-plugin/target/test-1.0-SNAPSHOT.swf");
      }
      arguments.add("-cdd");
      arguments.add(fudHome + "/flex-injection/target");
      adlRunConfiguration.arguments=arguments;
    }
    server=new Server(new PendingOpenDocumentTask(module,psiFile),this);
  }
 catch (  Throwable e) {
    LOG.error(e);
    documentOpening=false;
    return;
  }
  DesignerApplicationUtil.AdlRunTask task=new DesignerApplicationUtil.AdlRunTask(adlRunConfiguration){
    @Override public void run(){
      try {
        copyAppFiles();
        adlProcessHandler=DesignerApplicationUtil.runAdl(runConfiguration,APP_DIR.getPath() + "/" + DESCRIPTOR_XML,server.listen(),new Consumer<Integer>(){
          @Override public void consume(          Integer exitCode){
            adlProcessHandler=null;
            if (onAdlExit != null) {
              ApplicationManager.getApplication().invokeLater(onAdlExit);
            }
            if (exitCode != 0) {
              LOG.error("ADL exited with error code " + exitCode);
            }
            serverClosed();
          }
        }
);
      }
 catch (      IOException e) {
        LOG.error(e);
        try {
          server.close();
        }
 catch (        IOException ignored) {
        }
      }
 finally {
        documentOpening=false;
      }
    }
  }
;
  if (debug) {
    adlRunConfiguration.debug=true;
    try {
      DesignerApplicationUtil.runDebugger(module,task);
    }
 catch (    ExecutionException e) {
      LOG.error(e);
    }
  }
 else {
    task.run();
  }
}
