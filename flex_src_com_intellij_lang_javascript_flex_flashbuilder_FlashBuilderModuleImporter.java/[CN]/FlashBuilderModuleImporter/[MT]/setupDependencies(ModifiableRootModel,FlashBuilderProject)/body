{
  final LibraryTable libraryTable=rootModel.getModuleLibraryTable();
  for (  final Library library : libraryTable.getLibraries()) {
    if (isImportedFromFlashBuilder(library)) {
      libraryTable.removeLibrary(library);
    }
  }
  OUTER:   for (  final String libraryPathOrig : fbProject.getLibraryPaths()) {
    for (    FlashBuilderProject otherProject : myAllFBProjects) {
      if (otherProject != fbProject && libraryPathOrig.startsWith("/" + otherProject.getName() + "/")) {
        rootModel.addInvalidModuleEntry(otherProject.getName());
        continue OUTER;
      }
    }
    final String libraryPath=getAbsolutePathWithLinksHandled(fbProject,libraryPathOrig);
    final int slashIndex=libraryPath.lastIndexOf('/');
    final int dotIndex=libraryPath.lastIndexOf('.');
    final String libraryName=dotIndex > slashIndex ? libraryPath.substring(slashIndex + 1,dotIndex) : libraryPath.substring(slashIndex + 1);
    final Library library=libraryTable.createLibrary(LIBRARY_NAME_PREFIX + libraryName);
    final Library.ModifiableModel libraryModel=library.getModifiableModel();
    if (libraryPath.toLowerCase().endsWith(".swc")) {
      libraryModel.addRoot(VirtualFileManager.constructUrl(JarFileSystem.PROTOCOL,libraryPath) + JarFileSystem.JAR_SEPARATOR,OrderRootType.CLASSES);
    }
 else {
      libraryModel.addJarDirectory(VfsUtil.pathToUrl(libraryPath),false);
    }
    for (    final String librarySourcePath : fbProject.getLibrarySourcePaths(libraryPathOrig)) {
      libraryModel.addRoot(VfsUtil.pathToUrl(getAbsolutePathWithLinksHandled(fbProject,librarySourcePath)),OrderRootType.SOURCES);
    }
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        libraryModel.commit();
      }
    }
);
  }
}
