{
  List<String> params=new ArrayList<String>();
  params.add("--p=" + getOsgiFrameworkName().toLowerCase());
  for (  SelectedBundle bundle : bundlesToInstall) {
    if (bundle.isStartAfterInstallation() && !CachingBundleInfoProvider.isFragmentBundle(bundle.getBundleUrl())) {
      params.add(bundle.getBundleUrl() + "@" + bundle.getStartLevel());
    }
 else {
      params.add(bundle.getBundleUrl());
    }
  }
  String bootDelegation=runProperties.getBootDelegation();
  if (bootDelegation != null && !(bootDelegation.trim().length() == 0)) {
    params.add("--bd");
    params.add(bootDelegation);
  }
  String systemPackages=runProperties.getSystemPackages();
  if (systemPackages != null && !(systemPackages.trim().length() == 0)) {
    params.add("--sp=" + systemPackages);
  }
  if (runProperties.isDebugMode()) {
    params.add("--log=DEBUG");
  }
  if (runProperties.isStartConsole()) {
    params.add("--console");
  }
 else {
    params.add("--noConsole");
  }
  StringBuilder vmOptionsParam=new StringBuilder();
  vmOptionsParam.append("--vmOptions=");
  if (vmParameters != null && vmParameters.length() > 0) {
    vmOptionsParam.append(" ").append(vmParameters);
  }
  String additionalVmOptions=getAdditionalTargetVMProperties(bundlesToInstall,runProperties);
  if (additionalVmOptions.length() > 0) {
    vmOptionsParam.append(" ").append(additionalVmOptions);
  }
  String debugParams="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=n,suspend=n,address=39999";
  vmOptionsParam.append(" ").append(debugParams);
  params.add(vmOptionsParam.toString());
  params.add("--keepOriginalUrls");
  params.add("--skipInvalidBundles");
  return ArrayUtil.toStringArray(params);
}
