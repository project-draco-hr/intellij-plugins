{
  commandLineParameters.add("--p=" + getOsgiFrameworkName().toLowerCase());
  FrameworkInstanceDefinition definition=getRunConfiguration().getInstanceToUse();
  String version=definition.getVersion();
  if (version != null && version.length() > 0) {
    commandLineParameters.add("--v=" + version);
  }
  for (  SelectedBundle bundle : bundlesToInstall) {
    String prefix=CachingBundleInfoProvider.isExploded(bundle.getBundleUrl()) ? "scan-bundle:" : "";
    if (bundle.isStartAfterInstallation() && !CachingBundleInfoProvider.isFragmentBundle(bundle.getBundleUrl())) {
      int bundleStartLevel=bundle.isDefaultStartLevel() ? getRunConfiguration().getDefaultStartLevel() : bundle.getStartLevel();
      commandLineParameters.add(prefix + bundle.getBundleUrl() + "@"+ bundleStartLevel);
    }
 else {
      if (CachingBundleInfoProvider.isFragmentBundle(bundle.getBundleUrl())) {
        commandLineParameters.add(prefix + bundle.getBundleUrl() + "@nostart");
      }
 else {
        commandLineParameters.add(prefix + bundle.getBundleUrl());
      }
    }
  }
  final P frameworkProperties=getFrameworkProperties();
  String bootDelegation=frameworkProperties.getBootDelegation();
  if (bootDelegation != null && !(bootDelegation.trim().length() == 0)) {
    commandLineParameters.add("--bd=" + bootDelegation);
  }
  String systemPackages=frameworkProperties.getSystemPackages();
  if (systemPackages != null && !(systemPackages.trim().length() == 0)) {
    commandLineParameters.add("--sp=" + systemPackages);
  }
  int startLevel=getFrameworkStartLevel(bundlesToInstall);
  commandLineParameters.add("--sl=" + startLevel);
  int defaultStartLevel=getRunConfiguration().getDefaultStartLevel();
  commandLineParameters.add("--bsl=" + defaultStartLevel);
  if (frameworkProperties.isDebugMode()) {
    commandLineParameters.add("--log=DEBUG");
  }
  if (frameworkProperties.isStartConsole()) {
    commandLineParameters.add("--console");
  }
 else {
    commandLineParameters.add("--noConsole");
  }
  StringBuilder vmOptionsParam=new StringBuilder();
  vmOptionsParam.append("--vmOptions=");
  String vmParameters=getRunConfiguration().getVmParameters();
  if (vmParameters.length() > 0) {
    vmOptionsParam.append(vmParameters);
  }
  String additionalVmOptions=getAdditionalTargetVMProperties(bundlesToInstall);
  if (additionalVmOptions.length() > 0) {
    vmOptionsParam.append(" ").append(additionalVmOptions);
  }
  if (isDebugRun()) {
    String debugParams="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=n,suspend=n,address=" + getDebugPort();
    vmOptionsParam.append(" ").append(debugParams);
  }
  commandLineParameters.add(vmOptionsParam.toString());
  commandLineParameters.add("--keepOriginalUrls");
  commandLineParameters.add("--skipInvalidBundles");
  final String additionalProgramParams=getRunConfiguration().getProgramParameters();
  if (additionalProgramParams != null && !"".equals(additionalProgramParams)) {
    commandLineParameters.addParametersString(additionalProgramParams);
  }
}
