{
  VirtualFile initialBasePath=getConfigDir(document);
  String basePathStr=extractBasePathAsRawString(document);
  if (basePathStr != null) {
    if (initialBasePath != null) {
      VirtualFile vf=initialBasePath.findFileByRelativePath(basePathStr);
      if (vf != null) {
        return vf;
      }
    }
    File file=new File(basePathStr);
    if (file.isAbsolute() && file.exists()) {
      VirtualFile vf=LocalFileSystem.getInstance().findFileByIoFile(file);
      if (vf != null) {
        return vf;
      }
    }
  }
  return initialBasePath;
}
