{
  VirtualFile initialBasePath=getConfigDir(document);
  String basePathStr=extractBasePathAsRawString(document);
  if (basePathStr == null) {
    return initialBasePath;
  }
  File file=new File(basePathStr);
  if (file.isAbsolute() && file.exists()) {
    VirtualFile absoluteBasePath=LocalFileSystem.getInstance().findFileByIoFile(file);
    if (absoluteBasePath != null && absoluteBasePath.isDirectory()) {
      return absoluteBasePath;
    }
  }
  if (initialBasePath != null) {
    VirtualFile relativeBasePath=initialBasePath.findFileByRelativePath(basePathStr);
    if (relativeBasePath != null && relativeBasePath.isDirectory()) {
      return relativeBasePath;
    }
  }
  return null;
}
