{
  final Ref<String> versionRef=new Ref<String>();
  ExternalTask.runWithProgress(new AdtTask(project,sdk){
    protected void appendAdtOptions(    final List<String> command){
      command.add("-version");
    }
    protected boolean checkMessages(){
      if (myMessages.size() == 1) {
        String output=myMessages.get(0);
        final String prefix="adt version \"";
        final String suffix="\"";
        if (output.startsWith(prefix) && output.endsWith(suffix)) {
          output=output.substring(prefix.length(),output.length() - suffix.length());
        }
        if (AIR_VERSION_PATTERN.matcher(output).matches()) {
          versionRef.set(output);
          return true;
        }
      }
      return false;
    }
  }
,FlexBundle.message("checking.air.version"),FlexBundle.message("check.air.version.title"));
  return versionRef.get();
}
