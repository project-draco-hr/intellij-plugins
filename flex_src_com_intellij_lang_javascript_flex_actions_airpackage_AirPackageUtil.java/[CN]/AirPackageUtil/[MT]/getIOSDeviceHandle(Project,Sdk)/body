{
  final Ref<Integer> deviceHandleRef=new Ref<Integer>();
  final boolean ok=ExternalTask.runWithProgress(new AdtTask(project,sdk){
    protected void appendAdtOptions(    final List<String> command){
      command.add("-devices");
      command.add("-platform");
      command.add("ios");
    }
    protected boolean checkMessages(){
      if (myMessages.size() < 3)       return false;
      if (!myMessages.get(0).trim().contains("List of attached devices"))       return false;
      if (!myMessages.get(1).trim().startsWith("Handle"))       return false;
      final String deviceLine=myMessages.get(2).trim();
      int spaceIndex=deviceLine.indexOf(" ");
      int tabIndex=deviceLine.indexOf("\t");
      int index=spaceIndex > 0 && (spaceIndex < tabIndex || tabIndex < 0) ? spaceIndex : tabIndex;
      if (index <= 0)       return false;
      try {
        deviceHandleRef.set(Integer.parseInt(deviceLine.substring(0,index)));
      }
 catch (      NumberFormatException e) {
        return false;
      }
      if (myMessages.size() >= 4) {
        final String secondDeviceLine=myMessages.get(3).trim();
        spaceIndex=secondDeviceLine.indexOf(" ");
        tabIndex=secondDeviceLine.indexOf("\t");
        index=spaceIndex > 0 && (spaceIndex < tabIndex || tabIndex < 0) ? spaceIndex : tabIndex;
        try {
          if (index > 0 && Integer.parseInt(secondDeviceLine.substring(0,index)) >= 0) {
            myMessages.clear();
            myMessages.add(FlexBundle.message("more.than.one.ios.device"));
            return false;
          }
        }
 catch (        NumberFormatException ignore) {
        }
      }
      return true;
    }
  }
,FlexBundle.message("checking.ios.devices"),FlexBundle.message("check.ios.devices.title"));
  return ok ? deviceHandleRef.get() : -1;
}
