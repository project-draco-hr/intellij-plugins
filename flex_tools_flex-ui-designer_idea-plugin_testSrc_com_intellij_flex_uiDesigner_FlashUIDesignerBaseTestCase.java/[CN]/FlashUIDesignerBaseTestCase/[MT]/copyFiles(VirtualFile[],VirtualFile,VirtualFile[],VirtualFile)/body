{
  final boolean rootSpecified=rawProjectRoot != null;
  int toFileIndex=0;
  for (int i=fromFiles.length - 1; i >= 0; i--) {
    final VirtualFile fromFile=fromFiles[i];
    VirtualFile toP=toDir;
    if (rootSpecified) {
      final List<String> fromParents=new ArrayList<String>(4);
      VirtualFile fromP;
      while ((fromP=fromFile.getParent()) != rawProjectRoot) {
        fromParents.add(fromP.getName());
      }
      for (int j=fromParents.size() - 1; j >= 0; j--) {
        toP=toP.createChildDirectory(null,fromParents.get(i));
      }
    }
    final VirtualFile toFile=toP.createChildData(null,fromFile.getName());
    toFile.setBinaryContent(fromFile.contentsToByteArray());
    toFiles[toFileIndex++]=toFile;
  }
}
