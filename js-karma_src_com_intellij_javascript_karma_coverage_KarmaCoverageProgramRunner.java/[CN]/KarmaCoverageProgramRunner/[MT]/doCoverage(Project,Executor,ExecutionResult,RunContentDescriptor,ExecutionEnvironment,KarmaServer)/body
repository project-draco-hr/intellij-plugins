{
  final KarmaRunConfiguration runConfiguration=(KarmaRunConfiguration)env.getRunProfile();
  CoverageEnabledConfiguration coverageEnabledConfiguration=CoverageEnabledConfiguration.getOrCreate(runConfiguration);
  CoverageHelper.resetCoverageSuit(runConfiguration);
  final String coverageFilePath=coverageEnabledConfiguration.getCoverageFilePath();
  RunContentBuilder contentBuilder=new RunContentBuilder(project,this,executor,executionResult,env);
  final RunContentDescriptor descriptor=contentBuilder.showRunContent(contentToReuse);
  if (coverageFilePath != null) {
    karmaServer.startCoverageSession(new KarmaCoverageSession(){
      public void onCoverageSessionFinished(      @NotNull final File lcovFile){
        UIUtil.invokeLaterIfNeeded(new Runnable(){
          @Override public void run(){
            try {
              FileUtil.copy(lcovFile,new File(coverageFilePath));
            }
 catch (            IOException e) {
              LOG.error("Can't copy files from " + lcovFile.getAbsolutePath() + " to "+ coverageFilePath,e);
              return;
            }
            RunnerSettings runnerSettings=env.getRunnerSettings();
            if (runnerSettings != null) {
              KarmaCoverageRunner coverageRunner=CoverageRunner.getInstance(KarmaCoverageRunner.class);
              coverageRunner.setKarmaServer(karmaServer);
              CoverageDataManager.getInstance(project).processGatheredCoverage(runConfiguration,runnerSettings);
            }
          }
        }
);
      }
    }
);
  }
  return descriptor;
}
