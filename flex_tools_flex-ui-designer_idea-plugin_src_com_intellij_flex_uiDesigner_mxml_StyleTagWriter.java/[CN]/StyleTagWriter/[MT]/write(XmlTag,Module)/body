{
  CssFile cssFile=null;
  XmlAttribute source=tag.getAttribute("source");
  if (source != null) {
    XmlAttributeValue valueElement=source.getValueElement();
    if (valueElement != null) {
      final PsiFileSystemItem psiFile=InjectionUtil.getReferencedPsiFile(valueElement,problemsHolder,true);
      if (psiFile != null) {
        if (psiFile instanceof CssFile) {
          cssFile=(CssFile)psiFile;
        }
 else {
          problemsHolder.add(FlexUIDesignerBundle.message("error.embed.source.is.not.css.file",psiFile.getName()));
        }
      }
    }
  }
 else {
    PsiElement host=MxmlUtil.getInjectedHost(tag);
    if (host != null) {
      InjectedPsiVisitor visitor=new InjectedPsiVisitor(host);
      InjectedLanguageUtil.enumerate(host,visitor);
      cssFile=visitor.getCssFile();
    }
  }
  return cssFile == null ? null : cssWriter.write(cssFile,module,problemsHolder);
}
