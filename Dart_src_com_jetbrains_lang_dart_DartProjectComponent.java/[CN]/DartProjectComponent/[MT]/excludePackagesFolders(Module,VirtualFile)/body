{
  final VirtualFile root=pubspecYamlFile.getParent();
  final VirtualFile contentRoot=root == null ? null : ProjectRootManager.getInstance(module.getProject()).getFileIndex().getContentRootForFile(root);
  if (contentRoot == null)   return;
  final Collection<String> oldExcludedPackagesUrls=ContainerUtil.filter(ModuleRootManager.getInstance(module).getExcludeRootUrls(),new Condition<String>(){
    final String rootUrlPrefix=root.getUrl() + '/';
    public boolean value(    final String url){
      if (!url.startsWith(rootUrlPrefix))       return false;
      if (url.endsWith("/packages"))       return true;
      final int lastSlashIndex=url.lastIndexOf('/');
      if (lastSlashIndex > 0 && url.substring(0,lastSlashIndex).endsWith("/packages"))       return true;
      return false;
    }
  }
);
  final THashSet<String> newExcludedPackagesUrls=collectFoldersToExclude(module,pubspecYamlFile);
  if (oldExcludedPackagesUrls.size() != newExcludedPackagesUrls.size() || !newExcludedPackagesUrls.containsAll(oldExcludedPackagesUrls)) {
    updateExcludedFolders(module,contentRoot,oldExcludedPackagesUrls,newExcludedPackagesUrls);
  }
}
