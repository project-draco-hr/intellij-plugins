{
  server.registerStreamEventHandler(new StreamEventHandler(){
    @NotNull @Override public String getEventType(){
      return "coverageFinished";
    }
    @Override public void handle(    @NotNull JsonElement eventBody){
      KarmaCoverageSession coverageSession=myActiveCoverageSession;
      myActiveCoverageSession=null;
      if (coverageSession != null) {
        String path=GsonUtil.asString(eventBody);
        coverageSession.onCoverageSessionFinished(new File(path));
      }
    }
  }
);
  server.registerStreamEventHandler(new StreamEventHandler(){
    @NotNull @Override public String getEventType(){
      return "coverageAvailability";
    }
    @Override public void handle(    @NotNull JsonElement eventBody){
      if (eventBody.isJsonObject()) {
        JsonObject object=eventBody.getAsJsonObject();
        JsonElement installedElement=object.get("plugin-installed");
        if (installedElement != null && installedElement.isJsonPrimitive()) {
          JsonPrimitive installedPrimitive=installedElement.getAsJsonPrimitive();
          if (installedPrimitive.isBoolean()) {
            myKarmaCoveragePluginInstalled=installedPrimitive.getAsBoolean();
          }
        }
        JsonElement reporterElement=object.get("reporter-configured");
        if (reporterElement != null && reporterElement.isJsonPrimitive()) {
          JsonPrimitive installedPrimitive=reporterElement.getAsJsonPrimitive();
          if (installedPrimitive.isBoolean()) {
            myKarmaCoveragePluginInstalled=installedPrimitive.getAsBoolean();
          }
        }
      }
    }
  }
);
}
