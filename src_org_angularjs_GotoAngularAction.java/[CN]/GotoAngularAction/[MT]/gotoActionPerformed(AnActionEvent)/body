{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null)   return;
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final DataContext dataContext=e.getDataContext();
  final FindManager findManager=FindManager.getInstance(project);
  final FindModel findModel=(FindModel)findManager.getFindInFileModel().clone();
  final Map<String,AngularItem> validResults=new HashMap<String,AngularItem>();
  findModel.setRegularExpressions(true);
  findModel.setFileFilter("*.js, *.html");
  findModel.setStringToFind("\\.(controller|filter|service|factory|module|value|constant|directive|provider)\\(\\s*(\"|')([^\\[]*)(\"|'\\s*,)");
  findModel.setStringToReplace("$3");
  final Collection<Usage> moduleMethodUsages=getAngularUsages(project,dataContext,findModel);
  Map<String,AngularItem> moduleMethodResults=getValidResults(project,findModel,moduleMethodUsages,MODULE_METHODS);
  validResults.putAll(moduleMethodResults);
  findModel.setStringToFind("Ctrl\\(\\s*\\$scope");
  findModel.setStringToReplace("$0");
  final Collection<Usage> ctrlByConventionUsages=getAngularUsages(project,dataContext,findModel);
  Map<String,AngularItem> ctrlByConventionResults=getValidResults(project,findModel,ctrlByConventionUsages,CTRL_CONVENTIONS);
  validResults.putAll(ctrlByConventionResults);
  final GotoAngularModel model=new GotoAngularModel(project,validResults);
  showNavigationPopup(e,model,new GotoActionBase.GotoActionCallback<Object>(){
    @Override protected ChooseByNameFilter<Object> createFilter(    @NotNull ChooseByNamePopup popup){
      popup.setSearchInAnyPlace(true);
      popup.setShowListForEmptyPattern(true);
      popup.setSearchInAnyPlace(true);
      return super.createFilter(popup);
    }
    @Override public void elementChosen(    ChooseByNamePopup popup,    final Object element){
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          PsiElement psi=((AngularItem)element).getElement();
          NavigationUtil.activateFileWithPsiElement(psi.getNavigationElement());
        }
      }
);
    }
  }
);
}
