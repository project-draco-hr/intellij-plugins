{
  initResultFile();
  final int assetId=reader.readUnsignedShort();
  final EmbedAssetInfo assetInfo=isSwf ? EmbedSwfManager.getInstance().getInfo(assetId) : EmbedImageManager.getInstance().getInfo(assetId);
  final ByteArrayOutputStreamEx byteOut=new ByteArrayOutputStreamEx(1024);
  final PrimitiveAmfOutputStream out=new PrimitiveAmfOutputStream(byteOut);
  Client.writeVirtualFile(assetInfo.file,out);
  out.writeNullableString(assetInfo instanceof SwfAssetInfo ? ((SwfAssetInfo)assetInfo).symbolName : null);
  final FileOutputStream fileOut=new FileOutputStream(resultFile);
  try {
    byteOut.writeTo(fileOut);
  }
 catch (  IOException e) {
    final String userMessage=FlashUIDesignerBundle.message("problem.opening.0",assetInfo.file.getName());
    LOG.error(LogMessageUtil.createEvent(userMessage,ExceptionUtil.getThrowableText(e),assetInfo.file));
    fileOut.getChannel().truncate(0);
  }
 finally {
    out.close();
    fileOut.close();
  }
}
