{
  Computable<ScriptingLibraryModel> task=new Computable<ScriptingLibraryModel>(){
    @Override @Nullable public ScriptingLibraryModel compute(){
      try {
        ScriptingLibraryModel libraryModel=getScriptingLibraryModel(libraryName);
        if (libraryModel != null) {
          if (scriptingLibraryModelConsistsOf(libraryModel,sourceFiles)) {
            LOG.info("Library '" + libraryModel.getName() + "' will be reused, new library creation isn't needed.");
            return libraryModel;
          }
 else {
            myScriptingLibraryManager.removeLibrary(libraryModel);
            myScriptingLibraryManager.commitChanges();
            LOG.info("Library '" + libraryModel.getName() + "' has been removed (it's impossible to reuse).");
          }
        }
        libraryModel=myScriptingLibraryManager.createLibrary(libraryName,VfsUtilCore.toVirtualFileArray(sourceFiles),VirtualFile.EMPTY_ARRAY,ArrayUtil.EMPTY_STRING_ARRAY,ScriptingLibraryModel.LibraryLevel.GLOBAL);
        LOG.info("Library '" + libraryModel.getName() + "' has been successfully created.");
        return libraryModel;
      }
 catch (      Exception ex) {
        LOG.error("Can not create JavaScript Library '" + libraryName + "'",ex);
        return null;
      }
    }
  }
;
  return ApplicationManager.getApplication().runWriteAction(task);
}
