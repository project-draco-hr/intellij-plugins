{
  final VirtualFile virtualFile=file.getViewProvider().getVirtualFile();
  BufferedImage image=toolWindowForm.getPreviewPanel().getImage();
  if (image != null) {
    try {
      IOUtil.saveImage(toolWindowForm.getPreviewPanel().getImage(),new File(DesignerApplicationManager.APP_DIR,LAST_PREVIEW_IMAGE_FILE_NAME),new Consumer<DataOutputStream>(){
        @Override public void consume(        DataOutputStream out){
          try {
            out.writeLong(virtualFile.getTimeStamp());
            out.writeUTF(virtualFile.getUrl());
          }
 catch (          IOException e) {
            throw new RuntimeException(e);
          }
        }
      }
);
    }
 catch (    Throwable e) {
      LogMessageUtil.LOG.warn("Can't save image for last document",e);
    }
  }
}
