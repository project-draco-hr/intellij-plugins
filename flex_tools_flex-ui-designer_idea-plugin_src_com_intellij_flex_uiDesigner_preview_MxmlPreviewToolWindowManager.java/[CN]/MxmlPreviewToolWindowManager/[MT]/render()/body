{
  if (!toolWindowVisible) {
    return;
  }
  final XmlFile psiFile=toolWindowForm.getFile();
  if (psiFile == null) {
    return;
  }
  final LoadingDecorator loadingDecorator=toolWindowForm.getPreviewPanel().getLoadingDecorator();
  loadingDecorator.startLoading(false);
  AsyncResult<BufferedImage> result=DesignerApplicationManager.getInstance().getDocumentImage(psiFile);
  result.doWhenDone(new AsyncResult.Handler<BufferedImage>(){
    @Override public void run(    final BufferedImage image){
      if (toolWindowForm == null || toolWindowForm.getFile() == null) {
        return;
      }
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          toolWindowForm.getPreviewPanel().setImage(image);
        }
      }
);
    }
  }
);
  result.doWhenProcessed(new Runnable(){
    @Override public void run(){
      loadingDecorator.stopLoading();
    }
  }
);
}
