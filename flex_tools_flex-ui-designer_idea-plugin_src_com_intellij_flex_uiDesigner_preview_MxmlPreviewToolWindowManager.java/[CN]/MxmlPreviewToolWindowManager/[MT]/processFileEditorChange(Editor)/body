{
  toolWindowUpdateQueue.cancelAllUpdates();
  toolWindowUpdateQueue.queue(new Update("update"){
    @SuppressWarnings("PointlessBooleanExpression") public void run(){
      if (!toolWindowReady || toolWindowDisposed) {
        return;
      }
      if (toolWindow == null) {
        if (newEditor == null) {
          return;
        }
        initToolWindow();
      }
      final boolean hideForNonLayoutFiles=true;
      if (newEditor == null) {
        toolWindowForm.setFile(null);
        toolWindow.setAvailable(!hideForNonLayoutFiles,null);
        return;
      }
      final XmlFile psiFile=(XmlFile)PsiDocumentManager.getInstance(project).getPsiFile(newEditor.getDocument());
      if (psiFile == null) {
        toolWindow.setAvailable(!hideForNonLayoutFiles,null);
        return;
      }
      final boolean doRender=toolWindowForm.getFile() != psiFile;
      if (doRender) {
        FileDocumentManager.getInstance().saveAllDocuments();
        toolWindowForm.setFile(psiFile);
      }
      toolWindow.setAvailable(true,null);
      if (PropertiesComponent.getInstance(project).getBoolean("mxml.preview.tool.window.visible",true)) {
        toolWindow.show(null);
      }
      if (doRender) {
        render();
      }
    }
  }
);
}
