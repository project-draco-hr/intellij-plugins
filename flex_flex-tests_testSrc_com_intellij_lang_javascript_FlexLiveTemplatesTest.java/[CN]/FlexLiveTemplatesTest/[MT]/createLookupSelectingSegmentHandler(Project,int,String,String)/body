{
  return new Consumer<Integer>(){
    @Override public void consume(    final Integer currentSegmentIndex){
      if (currentSegmentIndex == segmentIndex) {
        final LookupEx lookup=LookupManager.getInstance(project).getActiveLookup();
        if (lookup != null) {
          LookupElement selected=null;
          final List<LookupElement> items=lookup.getItems();
          final String[] lookupStrings=new String[items.size()];
          for (int i=0; i < items.size(); i++) {
            lookupStrings[i]=items.get(i).getLookupString();
            if (whatToSelectAtThisSegment.equals(lookupStrings[i])) {
              selected=items.get(i);
            }
          }
          if (expectedLookupVariants.length > 0) {
            assertSameElements(lookupStrings,expectedLookupVariants);
          }
          if (selected != null) {
            lookup.setCurrentItem(selected);
            ((LookupImpl)lookup).finishLookup(Lookup.NORMAL_SELECT_CHAR);
          }
        }
      }
    }
  }
;
}
