{
  final File clientAppFile;
  try {
    clientAppFile=server.getClientAppFile();
  }
 catch (  IOException e) {
    throw new ExecutionException("Can't find karma-intellij test runner",e);
  }
  if (server.isReady()) {
    int runnerPort=server.getRunnerPort();
    OSProcessHandler processHandler=createOSProcessHandler(runnerPort,clientAppFile);
    return new ProcessHandlerInfo(processHandler,new AsyncResult.Done<OSProcessHandler>(processHandler));
  }
  final AsyncResult<OSProcessHandler> asyncResult=new AsyncResult<OSProcessHandler>();
  final DelegatingProcessHandler delegatingProcessHandler=new DelegatingProcessHandler();
  server.addListener(new KarmaServerListener(){
    @Override public void onReady(    int webServerPort,    int runnerPort){
      try {
        OSProcessHandler osProcessHandler=createOSProcessHandler(runnerPort,clientAppFile);
        delegatingProcessHandler.setDelegate(osProcessHandler);
        asyncResult.setDone(osProcessHandler);
      }
 catch (      ExecutionException e) {
        LOG.warn(e);
      }
    }
    @Override public void onTerminated(    int exitCode){
      delegatingProcessHandler.onDelegateTerminated(exitCode);
    }
  }
);
  return new ProcessHandlerInfo(delegatingProcessHandler,asyncResult);
}
