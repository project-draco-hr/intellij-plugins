{
  final Map<MavenId,VirtualFile> mavenIdToOutputFile=new THashMap<MavenId,VirtualFile>(mavenProjects.size());
  final Ref<IOException> exception=new Ref<IOException>();
  MavenUtil.invokeAndWaitWriteAction(project,new Runnable(){
    public void run(){
      try {
        for (        MavenProject mavenProject : mavenProjects) {
          final String packaging=mavenProject.getPackaging();
          if ("swf".equalsIgnoreCase(packaging) || "swc".equalsIgnoreCase(packaging)) {
            final String outputFilePath=FlexMojos3FacetImporter.getOutputFilePath(mavenProject);
            final int lastSlashIndex=outputFilePath.lastIndexOf("/");
            final String outputFileName=outputFilePath.substring(lastSlashIndex + 1);
            final String outputFolderPath=outputFilePath.substring(0,Math.max(0,lastSlashIndex));
            VirtualFile outputFile=LocalFileSystem.getInstance().refreshAndFindFileByPath(outputFilePath);
            if (outputFile == null) {
              final VirtualFile outputDir=VfsUtil.createDirectoryIfMissing(outputFolderPath);
              if (outputDir == null)               throw new IOException(IdeBundle.message("error.failed.to.create.directory",outputFolderPath));
              ChangeListManager.getInstance(project).addFilesToIgnore(IgnoredBeanFactory.ignoreFile(outputFilePath,project));
              outputFile=FlexUtils.addFileWithContent(outputFileName,TEMPORARY_FILE_CONTENT,outputDir);
              if (outputFile == null)               throw new IOException(IdeBundle.message("error.message.unable.to.create.file",outputFileName));
            }
            mavenIdToOutputFile.put(mavenProject.getMavenId(),outputFile);
          }
 else {
            mavenIdToOutputFile.put(mavenProject.getMavenId(),mavenProject.getFile());
          }
        }
      }
 catch (      IOException e) {
        exception.set(e);
      }
    }
  }
);
  if (!exception.isNull())   throw exception.get();
  return mavenIdToOutputFile;
}
