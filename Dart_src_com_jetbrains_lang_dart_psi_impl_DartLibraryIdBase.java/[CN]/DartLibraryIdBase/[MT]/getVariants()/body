{
  final VirtualFile vFile=DartResolveUtil.getRealVirtualFile(getContainingFile());
  if (vFile == null)   return PsiElement.EMPTY_ARRAY;
  final ProjectFileIndex index=ProjectRootManager.getInstance(getProject()).getFileIndex();
  VirtualFile scopeFolder=vFile.getParent();
  if (scopeFolder != null && scopeFolder.findChild(PubspecYamlUtil.PUBSPEC_YAML) == null) {
    VirtualFile parentFolder=scopeFolder.getParent();
    while (parentFolder != null && index.isInContent(parentFolder) && parentFolder.findChild(PubspecYamlUtil.PUBSPEC_YAML) == null) {
      scopeFolder=parentFolder;
      parentFolder=scopeFolder.getParent();
    }
  }
  if (scopeFolder == null)   return PsiElement.EMPTY_ARRAY;
  final GlobalSearchScope scope=GlobalSearchScopesCore.directoryScope(getProject(),scopeFolder,true);
  final CommonProcessors.CollectProcessor<String> processor=new CommonProcessors.CollectProcessor<String>();
  FileBasedIndex.getInstance().processAllKeys(DartLibraryIndex.DART_LIBRARY_INDEX,processor,scope,null);
  return processor.toArray(new String[processor.getResults().size()]);
}
