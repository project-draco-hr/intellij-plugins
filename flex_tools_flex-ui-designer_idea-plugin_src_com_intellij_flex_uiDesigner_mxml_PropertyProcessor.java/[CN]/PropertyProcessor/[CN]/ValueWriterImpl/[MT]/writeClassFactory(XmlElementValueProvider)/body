{
  String className=valueProvider.getTrimmed();
  int reference=classFactoryMap.get(className);
  if (reference == -1) {
    reference=writer.getRootScope().referenceCounter++;
    classFactoryMap.put(className,reference);
    writer.getOut().write(Amf3Types.OBJECT);
    writer.writeObjectHeader("mx.core.ClassFactory",reference);
    writer.write("1");
    writeClass(className);
  }
 else {
    writer.getOut().write(AmfExtendedTypes.OBJECT_REFERENCE);
    writer.getOut().writeUInt29(reference);
  }
}
