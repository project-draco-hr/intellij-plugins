{
  ModuleManager moduleManager=ModuleManager.getInstance(fixture.getProject());
  Module t0=moduleManager.findModuleByName("t0");
  OsmorcFrameworkDetector detector=new OsmorcFrameworkDetector();
  ElementPattern<FileContent> filter=detector.createSuitableFilePattern();
  VirtualFile manifestFile=myTempDirFixture.getFile("t0/src/META-INF/MANIFEST.MF");
  assertThat(filter.accepts(new FileContent(manifestFile,manifestFile.contentsToByteArray())),equalTo(true));
  OsmorcFacetConfiguration osmorcFacetConfiguration=detector.createConfiguration(Collections.singletonList(manifestFile));
  assertThat(osmorcFacetConfiguration.getManifestLocation(),equalTo(manifestFile.getPath()));
  assertThat(osmorcFacetConfiguration.isUseProjectDefaultManifestFileLocation(),equalTo(false));
  OsmorcFacet osmorcFacet=OsmorcFacetType.getInstance().createFacet(t0,"OSGi",osmorcFacetConfiguration,null);
  ModifiableRootModel model=ModuleRootManager.getInstance(t0).getModifiableModel();
  try {
    detector.setupFacet(osmorcFacet,model);
    assertThat(osmorcFacetConfiguration.getManifestLocation(),equalTo("src/META-INF/MANIFEST.MF"));
  }
  finally {
    model.dispose();
  }
}
