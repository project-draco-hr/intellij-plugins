{
  ModuleManager moduleManager=ModuleManager.getInstance(fixture.getProject());
  Module t2=moduleManager.findModuleByName("t2");
  final OsmorcFrameworkDetector detector=new OsmorcFrameworkDetector();
  ElementPattern<FileContent> filter=detector.createSuitableFilePattern();
  VirtualFile manifestFile=myTempDirFixture.getFile("t2/src/META-INF/template.mf");
  assertThat(filter.accepts(new FileContentImpl(manifestFile,manifestFile.contentsToByteArray())),equalTo(true));
  OsmorcFacetConfiguration osmorcFacetConfiguration=detector.createConfiguration(Collections.singletonList(manifestFile));
  assertThat(osmorcFacetConfiguration.getManifestLocation(),equalTo(manifestFile.getPath()));
  assertThat(osmorcFacetConfiguration.isUseProjectDefaultManifestFileLocation(),equalTo(false));
  OsmorcFacet osmorcFacet=OsmorcFacetType.getInstance().createFacet(t2,"OSGi",osmorcFacetConfiguration,null);
  ModifiableRootModel model=ModuleRootManager.getInstance(t2).getModifiableModel();
  try {
    detector.setupFacet(osmorcFacet,model);
    assertThat(osmorcFacetConfiguration.getManifestLocation(),equalTo(""));
    assertThat(osmorcFacetConfiguration.getBundlorFileLocation(),equalTo("src/META-INF/template.mf"));
    assertThat(osmorcFacetConfiguration.isUseBundlorFile(),equalTo(true));
  }
  finally {
    model.dispose();
  }
}
