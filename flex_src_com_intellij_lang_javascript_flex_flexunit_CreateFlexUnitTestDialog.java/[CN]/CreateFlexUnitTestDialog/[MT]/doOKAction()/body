{
  final String superClassFqn=mySuperClassField.getText().trim();
  final PsiElement element=JSClassResolver.findClassByQName(superClassFqn,getSuperClassScope(myModule));
  mySuperClass=element instanceof JSClass ? (JSClass)element : null;
  if (myCreateTestSourceFolderCheckBox.isVisible() && myCreateTestSourceFolderCheckBox.isSelected()) {
    myTargetDirectory=createTestSourceFolderAndPackage(myModule,myTestSourceFolderTextField.getText().trim(),getPackageName());
  }
  if (myTargetDirectory == null) {
    myTargetDirectory=JSRefactoringUtil.chooseOrCreateDirectoryForClass(myModule.getProject(),myModule,getTestClassPackageScope(myModule),getPackageName(),getTestClassName(),myExistingTestSourceRoot,ThreeState.YES);
  }
  if (myTargetDirectory != null) {
    if (myCreateTestSourceFolderCheckBox.isVisible()) {
      if (myCreateTestSourceFolderCheckBox.isSelected()) {
        PropertiesComponent.getInstance(myModule.getProject()).unsetValue(CREATE_TEST_SOURCE_FOLDER_KEY);
      }
 else {
        PropertiesComponent.getInstance(myModule.getProject()).setValue(CREATE_TEST_SOURCE_FOLDER_KEY,"false");
      }
    }
    super.doOKAction();
  }
}
