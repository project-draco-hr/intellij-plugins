{
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  final String filePath=myUnitParameters.getFilePath();
  final VirtualFile realFile=filePath == null ? null : VirtualFileManager.getInstance().findFileByUrl(VfsUtilCore.pathToUrl(filePath));
  commandLine.setExePath(DartSdkUtil.getDartExePath(myDartSdk));
  final String workingDirectory=myUnitParameters.getWorkingDirectory();
  if (!StringUtil.isEmptyOrSpaces(workingDirectory)) {
    commandLine.setWorkDirectory(workingDirectory);
  }
 else   if (realFile != null) {
    commandLine.setWorkDirectory(realFile.getParent().getPath());
  }
  commandLine.getEnvironment().putAll(myUnitParameters.getEnvs());
  commandLine.setPassParentEnvironment(myUnitParameters.isIncludeParentEnvs());
  setupUserProperties(commandLine);
  return commandLine;
}
