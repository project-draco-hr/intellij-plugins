{
  final Editor editor=MarkdownActionUtil.findMarkdownTextEditor(e);
  final PsiFile psiFile=e.getData(CommonDataKeys.PSI_FILE);
  if (editor == null || psiFile == null) {
    return false;
  }
  MarkdownActionUtil.SelectionState lastState=null;
  for (  Caret caret : editor.getCaretModel().getAllCarets()) {
    final MarkdownActionUtil.SelectionState state=MarkdownActionUtil.getCommonState(psiFile,caret,MarkdownElementTypes.EMPH);
    if (lastState == null) {
      lastState=state;
    }
 else     if (lastState != state) {
      lastState=MarkdownActionUtil.SelectionState.INCONSISTENT;
      break;
    }
  }
  if (lastState == MarkdownActionUtil.SelectionState.INCONSISTENT) {
    e.getPresentation().setEnabled(false);
    return false;
  }
 else {
    e.getPresentation().setEnabled(true);
    return lastState == MarkdownActionUtil.SelectionState.YES;
  }
}
