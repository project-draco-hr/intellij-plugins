{
  myFixture.copyDirectoryToProject(getTestName(true) + "/before",getTestName(true));
  Collection<PsiElement> files=new ArrayList<>();
  for (  String s : toMove) {
    final VirtualFile child=myFixture.findFileInTempDir(getTestName(true) + "/" + s);
    assertNotNull("Neither class nor file " + s + " not found",child);
    files.add(myFixture.getPsiManager().findFile(child));
  }
  final VirtualFile child1=myFixture.findFileInTempDir(getTestName(true) + "/" + targetDirName);
  assertNotNull("Target dir " + targetDirName + " not found",child1);
  final PsiDirectory targetDirectory=myFixture.getPsiManager().findDirectory(child1);
  assertNotNull(targetDirectory);
  new MoveFilesOrDirectoriesProcessor(myFixture.getProject(),PsiUtilCore.toPsiElementArray(files),targetDirectory,false,true,null,null).run();
  FileDocumentManager.getInstance().saveAllDocuments();
  VirtualFile expected=LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + getTestName(true) + "/after");
  PlatformTestUtil.assertDirectoriesEqual(expected,myFixture.findFileInTempDir(getTestName(true)));
}
