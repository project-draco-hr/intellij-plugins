{
  final AtomicInteger counter=new AtomicInteger(isolate.getLibraries().size());
  for (  final LibraryRef libraryRef : isolate.getLibraries()) {
    addRequest(new Runnable(){
      @Override public void run(){
        myVmService.getLibrary(isolate.getId(),libraryRef.getId(),new GetLibraryConsumer(){
          @Override public void received(          final Library library){
            myIsolatesInfo.addLibrary(isolate,library);
            resumeIsolateIfDone();
          }
          @Override public void onError(          RPCError error){
            resumeIsolateIfDone();
          }
          private void resumeIsolateIfDone(){
            if (counter.decrementAndGet() == 0) {
              resumeIsolate(isolate.getId());
            }
          }
        }
);
      }
    }
);
  }
}
