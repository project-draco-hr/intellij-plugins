{
  assertSyncRequestAllowed();
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  final Ref<RPCError> errorRef=Ref.create();
  myRequestsScheduler.addRequest(new Runnable(){
    @Override public void run(){
      myVmService.streamListen(streamId,new SuccessConsumer(){
        @Override public void received(        Success response){
          semaphore.up();
        }
        @Override public void onError(        RPCError error){
          errorRef.set(error);
          semaphore.up();
        }
      }
);
    }
  }
,0);
  semaphore.waitFor(RESPONSE_WAIT_TIMEOUT);
  if (semaphore.tryUp()) {
    throw new VmServiceException("No response from VmService.streamListen(\"" + streamId + "\") in "+ RESPONSE_WAIT_TIMEOUT+ "ms.");
  }
  if (!errorRef.isNull()) {
    throw new VmServiceException("VmService.streamListen(\"" + streamId + "\")",errorRef.get());
  }
}
