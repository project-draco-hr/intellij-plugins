{
  addRequest(new Runnable(){
    @Override public void run(){
      myVmService.getStack(isolateId,new StackConsumer(){
        @Override public void received(        final Stack vmStack){
          ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
            @Override public void run(){
              InstanceRef exceptionToAddToFrame=exception;
              final List<XStackFrame> result=new ArrayList<XStackFrame>(vmStack.getFrames().size());
              for (              Frame vmFrame : vmStack.getFrames()) {
                final DartVmServiceStackFrame stackFrame=new DartVmServiceStackFrame(myDebugProcess,isolateId,vmFrame,exceptionToAddToFrame);
                result.add(stackFrame);
                if (!stackFrame.isInDartSdkPatchFile()) {
                  exceptionToAddToFrame=null;
                }
              }
              container.addStackFrames(firstFrameIndex == 0 ? result : result.subList(firstFrameIndex,result.size()),true);
            }
          }
);
        }
        @Override public void onError(        final RPCError error){
          container.errorOccurred(error.getMessage());
        }
      }
);
    }
  }
);
}
