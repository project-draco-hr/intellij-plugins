{
  assertSyncRequestAllowed();
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  final Ref<VM> resultRef=Ref.create();
  final Ref<RPCError> errorRef=Ref.create();
  myRequestsScheduler.addRequest(new Runnable(){
    @Override public void run(){
      myVmService.getVM(new VMConsumer(){
        @Override public void received(        VM response){
          resultRef.set(response);
          semaphore.up();
        }
        @Override public void onError(        RPCError error){
          errorRef.set(error);
          semaphore.up();
        }
      }
);
    }
  }
,0);
  semaphore.waitFor(RESPONSE_WAIT_TIMEOUT);
  if (semaphore.tryUp()) {
    throw new VmServiceException("No response from VmService.getVM() in " + RESPONSE_WAIT_TIMEOUT + "ms.");
  }
  if (!errorRef.isNull()) {
    throw new VmServiceException("VmService.getVM()",errorRef.get());
  }
  return resultRef.get();
}
