{
  final Library[] libraries=ModifiableModelsProvider.SERVICE.getInstance().getLibraryTableModifiableModel().getLibraries();
  final DartSdk sdkInitial=DartSdk.findDartSdkAmongGlobalLibs(libraries);
  mySdkPathTextWithBrowse.setText(sdkInitial == null ? "" : FileUtil.toSystemDependentName(sdkInitial.getHomePath()));
  final WebBrowser dartiumInitial=DartiumUtil.getDartiumBrowser();
  myDartiumSettingsCurrent=new ChromeSettings();
  if (dartiumInitial != null) {
    final BrowserSpecificSettings browserSpecificSettings=dartiumInitial.getSpecificSettings();
    if (browserSpecificSettings instanceof ChromeSettings) {
      myDartiumSettingsCurrent=(ChromeSettings)browserSpecificSettings.clone();
    }
  }
  myDartiumPathTextWithBrowse.setText(dartiumInitial == null ? "" : FileUtilRt.toSystemDependentName(StringUtil.notNullize(dartiumInitial.getPath())));
  DartSdkUtil.initDartSdkAndDartiumControls(null,mySdkPathTextWithBrowse,myVersionLabel,myDartiumPathTextWithBrowse,new Computable.PredefinedValueComputable<ChromeSettings>(myDartiumSettingsCurrent),myDartiumSettingsButton,myCheckedModeCheckBox,new Computable.PredefinedValueComputable<Boolean>(false));
  final boolean checkedMode=dartiumInitial == null || DartiumUtil.isCheckedMode(myDartiumSettingsCurrent.getEnvironmentVariables());
  myCheckedModeCheckBox.setSelected(checkedMode);
  myCreateSampleProjectCheckBox.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    final ActionEvent e){
      myTemplatesList.setEnabled(myCreateSampleProjectCheckBox.isSelected());
    }
  }
);
  myErrorLabel.setIcon(AllIcons.Actions.Lightning);
  myErrorLabel.setVisible(false);
  final String message=DartSdkUtil.getErrorMessageIfWrongSdkRootPath(mySdkPathTextWithBrowse.getText().trim());
  if (message == null) {
    startLoadingTemplates();
  }
 else {
    myLoadingTemplatesPanel.setVisible(false);
    myCreateSampleProjectCheckBox.setEnabled(false);
    myTemplatesList.setEnabled(false);
    mySdkPathTextWithBrowse.getTextField().getDocument().addDocumentListener(new DocumentAdapter(){
      @Override protected void textChanged(      final DocumentEvent e){
        final String message=DartSdkUtil.getErrorMessageIfWrongSdkRootPath(mySdkPathTextWithBrowse.getText().trim());
        if (message == null) {
          mySdkPathTextWithBrowse.getTextField().getDocument().removeDocumentListener(this);
          startLoadingTemplates();
        }
      }
    }
);
  }
}
