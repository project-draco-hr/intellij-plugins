{
  JSElement scopeElement=getNearestContainingScopeElement(jsReferenceExpression);
  if (scopeElement == null) {
    return null;
  }
  String refName=jsReferenceExpression.getReferencedName();
  if (refName == null || refName.isEmpty()) {
    return null;
  }
  List<JSStatement> statements=getTopLevelStatementsOf(scopeElement);
  int maxOffset=jsReferenceExpression.getTextRange().getStartOffset();
  JSExpression lastExpr=null;
  for (  JSStatement statement : statements) {
    if (statement.getTextRange().getEndOffset() > maxOffset) {
      break;
    }
{
      JSVarStatement varStmt=CastUtils.tryCast(statement,JSVarStatement.class);
      if (varStmt != null) {
        JSVariable[] vars=ObjectUtils.notNull(varStmt.getVariables(),JSVariable.EMPTY_ARRAY);
        for (        JSVariable var : vars) {
          if (refName.equals(var.getQualifiedName())) {
            lastExpr=var.getInitializer();
          }
        }
      }
    }
{
      JSExpressionStatement exprStmt=CastUtils.tryCast(statement,JSExpressionStatement.class);
      if (exprStmt != null) {
        JSAssignmentExpression assignmentExpr=CastUtils.tryCast(exprStmt.getExpression(),JSAssignmentExpression.class);
        if (assignmentExpr != null) {
          JSDefinitionExpression defExpr=CastUtils.tryCast(assignmentExpr.getLOperand(),JSDefinitionExpression.class);
          if (defExpr != null) {
            JSReferenceExpression refExpr=CastUtils.tryCast(defExpr.getExpression(),JSReferenceExpression.class);
            if (refExpr != null && refExpr.getQualifier() == null) {
              if (refName.equals(refExpr.getReferencedName())) {
                lastExpr=assignmentExpr.getROperand();
              }
            }
          }
        }
      }
    }
  }
  return lastExpr;
}
