{
  final FlexBuildConfiguration overriddenConfig=context.getUserData(OVERRIDE_BUILD_CONFIG);
  if (overriddenConfig != null && module == overriddenConfig.getModule()) {
    final Pair<Boolean,String> validationResultWithMessage=FlexCompiler.validateConfiguration(overriddenConfig,module,FlexBundle.message("module.name",module.getName()),false);
    if (!validationResultWithMessage.first) {
      if (validationResultWithMessage.second != null) {
        context.addMessage(CompilerMessageCategory.ERROR,validationResultWithMessage.second,null,-1,-1);
      }
      return;
    }
    compileModuleOrFacet(module,null,context,overriddenConfig,false);
  }
 else {
    final boolean nothingChangedSincePreviousCompilation=myCompilerDependenciesCache.isNothingChangedSincePreviousCompilation(module);
    if (ModuleType.get(module) instanceof FlexModuleType) {
      final Pair<Boolean,List<VirtualFile>> compilationResult=compileModuleOrFacet(module,null,context,FlexBuildConfiguration.getInstance(module),nothingChangedSincePreviousCompilation);
      if (compilationResult.first && !compilationResult.second.isEmpty()) {
        myCompilerDependenciesCache.cacheModuleWithDependencies(context,module,compilationResult.second);
      }
    }
 else {
      boolean wasFailure=false;
      Collection<List<VirtualFile>> allConfigFiles=new ArrayList<List<VirtualFile>>();
      for (      final FlexFacet facet : FacetManager.getInstance(module).getFacetsByType(FlexFacet.ID)) {
        final Pair<Boolean,List<VirtualFile>> compilationResult=compileModuleOrFacet(module,facet,context,FlexBuildConfiguration.getInstance(facet),nothingChangedSincePreviousCompilation);
        if (!compilationResult.first) {
          wasFailure=true;
        }
        if (!compilationResult.second.isEmpty()) {
          allConfigFiles.add(compilationResult.second);
        }
      }
      if (!wasFailure && !allConfigFiles.isEmpty()) {
        myCompilerDependenciesCache.cacheModuleWithDependencies(context,module,allConfigFiles);
      }
    }
  }
}
