{
  VfsUtilCore.visitChildrenRecursively(startFile,new VirtualFileVisitor(){
    @NotNull @Override public Result visitFileEx(    @NotNull VirtualFile file){
      progressIndicator.checkCanceled();
      progressIndicator.setText2(file.getPresentableUrl());
      String extension;
      if (!file.isDirectory() && ((extension=file.getExtension()) != null)) {
        if (JavaScriptSupportLoader.ECMA_SCRIPT_L4.equals(JavaScriptSupportLoader.getLanguageDialect(extension))) {
          Pair<VirtualFile,String> root=CommonSourceRootDetectionUtil.VIRTUAL_FILE.suggestRootForFileWithPackageStatement(file,topmostRoot,FlexProjectStructureDetector.PACKAGE_NAME_FETCHER,false);
          if (root != null) {
            final VirtualFile detectedRoot=root.first;
            result.add(detectedRoot);
            if (VfsUtilCore.isAncestor(detectedRoot,startFile,false)) {
              return skipTo(detectedRoot);
            }
          }
        }
 else         if (myDetectMxml && JavaScriptSupportLoader.isFlexMxmFile(file.getName())) {
          result.add(file.getParent());
        }
      }
      return CONTINUE;
    }
  }
);
}
