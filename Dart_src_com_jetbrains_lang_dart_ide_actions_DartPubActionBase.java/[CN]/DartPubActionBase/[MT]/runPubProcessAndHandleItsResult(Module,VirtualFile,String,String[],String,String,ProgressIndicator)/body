{
  final String presentableCommandLine="pub " + StringUtil.join(pubParameters," ");
  indicator.setText(DartBundle.message("dart.0.in.progress",presentableCommandLine));
  indicator.setIndeterminate(true);
  final GeneralCommandLine command=new GeneralCommandLine();
  command.setExePath(pubPath);
  command.setWorkDirectory(pubspecYamlFile.getParent().getPath());
  command.addParameters(pubParameters);
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
    }
  }
,ModalityState.defaultModalityState());
  try {
    final ProcessOutput processOutput=new CapturingProcessHandler(command).runProcessWithProgressIndicator(indicator);
    final String err=processOutput.getStderr().trim();
    LOG.debug(presentableCommandLine + ", exit code: " + processOutput.getExitCode()+ ", err:\n"+ err+ "\nout:\n"+ processOutput.getStdout());
    if (!indicator.isCanceled()) {
      if (err.isEmpty()) {
        Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,actionTitle,successMessage,NotificationType.INFORMATION));
      }
 else {
        Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,actionTitle,err,NotificationType.ERROR));
      }
    }
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        DartProjectComponent.excludePackagesFolders(module,pubspecYamlFile);
        pubspecYamlFile.getParent().refresh(true,true);
      }
    }
);
  }
 catch (  ExecutionException ex) {
    LOG.error(ex);
    Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,actionTitle,DartBundle.message("dart.pub.exception",ex.getMessage()),NotificationType.ERROR));
  }
}
