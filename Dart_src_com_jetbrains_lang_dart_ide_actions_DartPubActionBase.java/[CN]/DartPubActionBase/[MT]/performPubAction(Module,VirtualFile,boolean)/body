{
  DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null && allowModalDialogs) {
    final int answer=Messages.showDialog(module.getProject(),DartBundle.message("dart.sdk.is.not.configured"),getTitle(),new String[]{DartBundle.message("setup.dart.sdk"),CommonBundle.getCancelButtonText()},Messages.OK,Messages.getErrorIcon());
    if (answer != Messages.OK)     return;
    ShowSettingsUtilImpl.showSettingsDialog(module.getProject(),DartConfigurable.DART_SETTINGS_PAGE_ID,"");
    sdk=DartSdk.getGlobalDartSdk();
  }
  if (sdk == null)   return;
  File pubFile=new File(DartSdkUtil.getPubPath(sdk));
  if (!pubFile.isFile() && allowModalDialogs) {
    final int answer=Messages.showDialog(module.getProject(),DartBundle.message("dart.sdk.bad.dartpub.path",pubFile.getPath()),getTitle(),new String[]{DartBundle.message("setup.dart.sdk"),CommonBundle.getCancelButtonText()},Messages.OK,Messages.getErrorIcon());
    if (answer != Messages.OK)     return;
    ShowSettingsUtilImpl.showSettingsDialog(module.getProject(),DartConfigurable.DART_SETTINGS_PAGE_ID,"");
    sdk=DartSdk.getGlobalDartSdk();
    if (sdk == null)     return;
    pubFile=new File(DartSdkUtil.getPubPath(sdk));
  }
  if (!pubFile.isFile())   return;
  final String[] pubParameters=calculatePubParameters(module.getProject());
  if (pubParameters != null) {
    final GeneralCommandLine command=new GeneralCommandLine().withWorkDirectory(pubspecYamlFile.getParent().getPath());
    command.setExePath(pubFile.getPath());
    command.addParameters(pubParameters);
    doPerformPubAction(module,pubspecYamlFile,command,getTitle());
  }
}
