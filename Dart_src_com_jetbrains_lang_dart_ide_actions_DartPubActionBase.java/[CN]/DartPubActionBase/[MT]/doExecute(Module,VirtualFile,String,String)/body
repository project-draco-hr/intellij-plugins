{
  final Task.Backgroundable task=new Task.Backgroundable(module.getProject(),getPresentableText(),true){
    public void run(    @NotNull ProgressIndicator indicator){
      indicator.setText(DartBundle.message("dart.pub.0.in.progress",getPubCommand()));
      indicator.setIndeterminate(true);
      final GeneralCommandLine command=new GeneralCommandLine();
      command.setExePath(pubPath);
      command.setWorkDirectory(pubspecYamlFile.getParent().getPath());
      command.addParameter(getPubCommand());
      command.getEnvironment().put("DART_SDK",sdkPath);
      ApplicationManager.getApplication().invokeAndWait(new Runnable(){
        @Override public void run(){
          FileDocumentManager.getInstance().saveAllDocuments();
        }
      }
,ModalityState.defaultModalityState());
      try {
        final ProcessOutput processOutput=new CapturingProcessHandler(command).runProcess();
        final String err=processOutput.getStderr().trim();
        LOG.debug("pub " + getPubCommand() + ", exit code: "+ processOutput.getExitCode()+ ", err:\n"+ err+ "\nout:\n"+ processOutput.getStdout());
        if (err.isEmpty()) {
          Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),getSuccessMessage(),NotificationType.INFORMATION));
        }
 else {
          Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),err,NotificationType.ERROR));
        }
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            DartProjectComponent.excludePackagesFolders(module,pubspecYamlFile);
            pubspecYamlFile.getParent().refresh(true,true);
          }
        }
);
      }
 catch (      ExecutionException ex) {
        LOG.error(ex);
        Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),DartBundle.message("dart.pub.exception",ex.getMessage()),NotificationType.ERROR));
      }
    }
  }
;
  task.queue();
}
