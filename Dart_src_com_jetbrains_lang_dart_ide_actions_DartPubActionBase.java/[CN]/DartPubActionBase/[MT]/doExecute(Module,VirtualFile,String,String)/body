{
  final Task.Backgroundable task=new Task.Backgroundable(module.getProject(),getPresentableText(),true){
    public void run(    @NotNull ProgressIndicator indicator){
      indicator.setText("Running pub manager...");
      indicator.setIndeterminate(true);
      final GeneralCommandLine command=new GeneralCommandLine();
      command.setExePath(pubPath);
      command.setWorkDirectory(pubspecYamlFile.getParent().getPath());
      command.addParameter(getPubCommandArgument());
      command.getEnvironment().put("DART_SDK",sdkPath);
      ApplicationManager.getApplication().invokeAndWait(new Runnable(){
        @Override public void run(){
          FileDocumentManager.getInstance().saveAllDocuments();
        }
      }
,ModalityState.defaultModalityState());
      try {
        final ProcessOutput processOutput=new CapturingProcessHandler(command).runProcess();
        LOG.debug("pub terminated with exit code: " + processOutput.getExitCode());
        LOG.debug(processOutput.getStdout());
        LOG.debug(processOutput.getStderr());
        final String output=processOutput.getStdout().trim();
        if (output.contains(getSuccessOutputMessage())) {
          Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),getSuccessOutputMessage().replace('!','.'),NotificationType.INFORMATION));
          pubspecYamlFile.getParent().refresh(true,true);
        }
 else {
          Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),DartBundle.message("dart.pub.error",output,processOutput.getStderr()),NotificationType.ERROR));
        }
      }
 catch (      ExecutionException ex) {
        LOG.error(ex);
        Notifications.Bus.notify(new Notification(GROUP_DISPLAY_ID,getPresentableText(),DartBundle.message("dart.pub.exception",ex.getMessage()),NotificationType.ERROR));
      }
    }
  }
;
  task.queue();
}
