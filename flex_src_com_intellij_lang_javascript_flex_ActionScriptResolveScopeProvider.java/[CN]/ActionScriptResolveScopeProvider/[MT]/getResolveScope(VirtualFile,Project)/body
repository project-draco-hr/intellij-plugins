{
  if (file instanceof VirtualFileWindow) {
    file=((VirtualFileWindow)file).getDelegate();
  }
  if (!isApplicable(file))   return null;
  final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  final Module module=projectFileIndex.getModuleForFile(file);
  if (module != null) {
    boolean includeTests=projectFileIndex.isInTestSourceContent(file) || !projectFileIndex.isInSourceContent(file);
    return GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(module,includeTests).union(GlobalSearchScope.filesScope(project,JSCorePredefinedLibrariesProvider.getActionScriptPredefinedLibraryFiles()));
  }
  return null;
}
