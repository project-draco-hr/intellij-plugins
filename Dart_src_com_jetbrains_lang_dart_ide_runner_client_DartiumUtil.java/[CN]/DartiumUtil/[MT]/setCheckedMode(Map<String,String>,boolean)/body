{
  final boolean oldCheckedMode=isCheckedMode(envVars);
  if (oldCheckedMode == checkedMode)   return;
  final String dartFlags=envVars.get(DART_FLAGS_ENV_VAR);
  if (checkedMode) {
    if (dartFlags == null) {
      envVars.put(DART_FLAGS_ENV_VAR,CHECKED_MODE_OPTION);
    }
 else {
      envVars.put(DART_FLAGS_ENV_VAR,dartFlags + " " + CHECKED_MODE_OPTION);
    }
  }
 else {
    String newFlags=dartFlags;
    if (newFlags.trim().equals(CHECKED_MODE_OPTION)) {
      newFlags="";
    }
    newFlags=StringUtil.trimStart(newFlags,CHECKED_MODE_OPTION + " ");
    newFlags=StringUtil.trimEnd(newFlags," " + CHECKED_MODE_OPTION);
    final int index=newFlags.indexOf(" " + CHECKED_MODE_OPTION + " ");
    if (index != -1) {
      newFlags=newFlags.substring(0,index) + newFlags.substring(index + CHECKED_MODE_OPTION.length() + 1);
    }
    if (StringUtil.isEmptyOrSpaces(newFlags)) {
      envVars.remove(DART_FLAGS_ENV_VAR);
    }
 else {
      envVars.put(DART_FLAGS_ENV_VAR,newFlags);
    }
  }
}
