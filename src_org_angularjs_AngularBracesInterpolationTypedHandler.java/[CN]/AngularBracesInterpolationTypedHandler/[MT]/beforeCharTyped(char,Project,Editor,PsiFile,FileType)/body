{
  if (file.getFileType() == HtmlFileType.INSTANCE) {
    if (isInteresting(c)) {
      final Document document=editor.getDocument();
      final int offset=editor.getCaretModel().getOffset();
      CharSequence chars=document.getCharsSequence();
      if (offset > 0 && chars.charAt(offset - 1) == '{') {
        if (interpolateCommentBetweenBraces(editor,chars,c,offset)) {
          return Result.STOP;
        }
 else         if (offset < 2 || chars.charAt(offset - 2) != '{') {
          if (alreadyHasEnding(chars,c,offset)) {
            return Result.CONTINUE;
          }
 else {
            String interpolation=null;
            if (c == '{') {
              interpolation="{  }";
            }
 else             if (c == '%') {
              interpolation="%  %";
            }
 else             if (c == '#') {
              interpolation="#  #";
            }
            if (interpolation != null) {
              if (offset == chars.length() || (offset < chars.length() && chars.charAt(offset) != '}')) {
                interpolation+="}";
              }
              typeInStringAndMoveCaret(editor,offset + 2,interpolation);
              return Result.STOP;
            }
          }
        }
      }
    }
  }
  return Result.CONTINUE;
}
