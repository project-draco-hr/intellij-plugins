{
  Channel serverChannel=context.channel();
  Channel clientChannel=serverToClientChannel.get(serverChannel);
  if (clientChannel == null || !clientChannel.isActive()) {
    serverToClientChannel.remove(serverChannel);
    serverChannel.close();
    if (message instanceof ReferenceCounted) {
      ((ReferenceCounted)message).release();
    }
  }
 else {
    if (message instanceof HttpMessage) {
      HttpUtil.setKeepAlive(((HttpMessage)message),true);
    }
    if (message instanceof LastHttpContent) {
      serverToClientChannel.remove(serverChannel);
      ServerInfo serverInfo=getServerInfo(serverChannel);
      if (serverInfo != null) {
        serverChannel.close();
      }
    }
    clientChannel.writeAndFlush(message);
  }
}
