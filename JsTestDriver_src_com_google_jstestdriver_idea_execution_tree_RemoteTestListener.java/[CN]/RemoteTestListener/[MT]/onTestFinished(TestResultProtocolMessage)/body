{
  TestNode testNode=findTestNode(message);
  if (testNode == null) {
    testNode=createTestNode(message);
  }
  testNode.done();
  TestCaseNode testCaseNode=testNode.getTestCaseNode();
  JstdConfigFileNode jstdConfigFileNode=testCaseNode.getJstdConfigFileNode();
  BrowserNode browserNode=jstdConfigFileNode.getBrowserNode();
  SMTestProxy testProxy=testNode.getTestProxy();
  testProxy.addStdOutput(message.log,Key.create("result"));
  testProxy.setDuration(Math.round(message.duration));
  Result result=Result.valueOf(message.result);
  if (result == Result.passed) {
    onTestFinished(testProxy);
  }
 else {
    final String stackStr;
    if (message.stack.startsWith(message.message)) {
      String s=message.stack.substring(message.message.length());
      stackStr=s.replaceFirst("^[\n\r]*","");
    }
 else {
      stackStr=message.stack;
    }
    testProxy.setTestFailed(message.message,stackStr,result == Result.error);
    getSMTestRunnerResultsForm().onTestFailed(testProxy);
    testCaseNode.setTestFailed(result);
    jstdConfigFileNode.setTestFailed(result);
    browserNode.setTestFailed(result);
  }
  if (testCaseNode.isComplete()) {
    onSuiteFinished(testCaseNode.getTestProxy());
  }
  if (jstdConfigFileNode.isComplete()) {
    onSuiteFinished(jstdConfigFileNode.getTestProxy());
  }
  if (browserNode.isComplete()) {
    onSuiteFinished(browserNode.getTestProxy());
  }
}
