{
  final Module module=ModuleUtilCore.findModuleForPsiElement(file);
  if (module == null) {
    return Collections.emptyList();
  }
  if (StrutsFacet.getInstance(module) == null) {
    return Collections.emptyList();
  }
  final List<FtlVariable> result=new ArrayList<FtlVariable>();
  result.add(new MyFtlLightVariable("stack",file,(FtlType)null));
  result.add(new MyFtlLightVariable("response",file,WebCommonClassNames.HTTP_SERVLET_RESPONSE));
  result.add(new MyFtlLightVariable("res",file,WebCommonClassNames.HTTP_SERVLET_RESPONSE));
  result.add(new MyFtlLightVariable("request",file,WebCommonClassNames.HTTP_SERVLET_REQUEST));
  result.add(new MyFtlLightVariable("req",file,WebCommonClassNames.HTTP_SERVLET_REQUEST));
  result.add(new MyFtlLightVariable("session",file,WebCommonClassNames.HTTP_SESSION));
  result.add(new MyFtlLightVariable("application",file,WebCommonClassNames.SERVLET_CONTEXT));
  result.add(new MyFtlLightVariable("base",file,CommonClassNames.JAVA_LANG_STRING));
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_STRUTS_UI_URI,StrutsConstants.TAGLIB_STRUTS_UI_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_RICHTEXT_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_RICHTEXT_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_CHART_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_CHART_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_TREE_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_TREE_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_GRID_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_GRID_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_JQUERY_MOBILE_PLUGIN_URI,StrutsConstants.TAGLIB_JQUERY_MOBILE_PLUGIN_PREFIX);
  installTaglibSupport(result,module,StrutsConstants.TAGLIB_BOOTSTRAP_PLUGIN_URI,StrutsConstants.TAGLIB_BOOTSTRAP_PLUGIN_PREFIX);
  final Processor<Action> processor=new Processor<Action>(){
    @Override public boolean process(    final Action action){
      final PsiClass actionClass=action.searchActionClass();
      if (actionClass != null) {
        for (        final Result result1 : action.getResults()) {
          final ResultType resultType=result1.getEffectiveResultType();
          if (resultType != null && FreeMarkerStrutsResultContributor.FREEMARKER.equals(resultType.getName().getStringValue())) {
            final PathReference reference=result1.getValue();
            final PsiElement target=reference == null ? null : reference.resolve();
            if (target != null && (file.getManager().areElementsEquivalent(file,target) || file.getManager().areElementsEquivalent(file.getOriginalFile(),target))) {
              final PsiClassType actionType=PsiTypesUtil.getClassType(actionClass);
              final FtlPsiType ftlPsiType=FtlPsiType.wrap(actionType);
              result.add(new MyFtlLightVariable("",action.getXmlTag(),ftlPsiType));
              result.add(new MyFtlLightVariable("action",action.getXmlTag(),ftlPsiType));
              return false;
            }
          }
        }
      }
      return true;
    }
  }
;
  for (  final StrutsModel model : StrutsManager.getInstance(file.getProject()).getAllModels(module)) {
    model.processActions(processor);
  }
  return result;
}
