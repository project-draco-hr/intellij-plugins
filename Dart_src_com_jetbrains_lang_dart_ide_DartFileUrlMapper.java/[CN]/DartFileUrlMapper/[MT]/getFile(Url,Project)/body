{
  if (SCHEME.equals(url.getScheme())) {
    String path=url.getPath();
    int i=path.indexOf('/');
    String libraryName;
    String libraryFilePath;
    if (i > 0) {
      libraryName=path.substring(0,i);
      libraryFilePath=path.substring(i + 1);
    }
 else {
      libraryName=path;
      libraryFilePath=null;
    }
    VirtualFile file=DartLibraryIndex.getStandardLibraryFromSdk(project,libraryName);
    if (file == null) {
      return null;
    }
    return libraryFilePath == null ? file : file.getParent().findFileByRelativePath(libraryFilePath);
  }
 else   if (DartResolveUtil.PACKAGE_SCHEME.equals(url.getScheme())) {
    return DumbService.getInstance(project).tryRunReadActionInSmartMode(new Computable<VirtualFile>(){
      @Override public VirtualFile compute(){
        Collection<VirtualFile> files=FilenameIndex.getVirtualFilesByName(project,PUBSPEC_YAML,ProjectScope.getContentScope(project));
        for (        VirtualFile file : files) {
          final VirtualFile packagesDir=file.getParent().findChild("packages");
          if (packagesDir != null && packagesDir.isDirectory()) {
            VirtualFile result=packagesDir.findFileByRelativePath(url.getPath());
            if (result != null) {
              return result;
            }
          }
        }
        return null;
      }
    }
,"Smart remote file mapping is not possible during index update");
  }
  return null;
}
