{
  if (SCHEME.equals(url.getScheme())) {
    String path=url.getPath();
    int i=path.indexOf('/');
    String libraryName;
    String libraryFilePath;
    if (i > 0) {
      libraryName=path.substring(0,i);
      libraryFilePath=path.substring(i + 1);
    }
 else {
      libraryName=path;
      libraryFilePath=null;
    }
    VirtualFile file=DartLibraryIndex.getStandardLibraryFromSdk(project,libraryName);
    if (file == null) {
      return null;
    }
    return libraryFilePath == null ? file : file.getParent().findFileByRelativePath(libraryFilePath);
  }
 else   if (PACKAGE_SCHEME.equals(url.getScheme())) {
    final String packageUrl=PACKAGE_PREFIX + url.getPath();
    if (ApplicationManager.getApplication().isDispatchThread()) {
      return DumbService.getInstance(project).isDumb() ? null : findFileInPackagesFolder(project,packageUrl);
    }
    return DumbService.getInstance(project).runReadActionInSmartMode(new Computable<VirtualFile>(){
      @Override public VirtualFile compute(){
        return findFileInPackagesFolder(project,packageUrl);
      }
    }
);
  }
  return null;
}
