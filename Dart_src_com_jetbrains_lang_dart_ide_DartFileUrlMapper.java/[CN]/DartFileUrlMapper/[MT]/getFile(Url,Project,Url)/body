{
  if (DART_SCHEME.equals(url.getScheme())) {
    return DartUrlResolver.findFileInDartSdkLibFolder(project,DartSdk.getGlobalDartSdk(),DART_PREFIX + url.getPath());
  }
  if (PACKAGE_SCHEME.equals(url.getScheme())) {
    final String packageUrl=PACKAGE_PREFIX + url.getPath();
    final VirtualFile contextFile=findContextFile(project,requestor);
    if (contextFile != null) {
      return ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile>(){
        public VirtualFile compute(){
          return DartUrlResolver.getInstance(project,contextFile).findFileByDartUrl(packageUrl);
        }
      }
);
    }
 else {
      if (ApplicationManager.getApplication().isDispatchThread()) {
        return DumbService.getInstance(project).isDumb() ? null : findFileInAnyPackagesFolder(project,packageUrl);
      }
      return DumbService.getInstance(project).runReadActionInSmartMode(new Computable<VirtualFile>(){
        @Override public VirtualFile compute(){
          return findFileInAnyPackagesFolder(project,packageUrl);
        }
      }
);
    }
  }
  return null;
}
