{
  final String key=createKey(libraryCollector.sdkLibraries,true);
  FlexLibrarySet flexLibrarySet=(FlexLibrarySet)librarySets.get(key);
  if (flexLibrarySet == null) {
    final Set<CharSequence> globalDefinitions=getGlobalDefinitions(libraryCollector.getGlobalLibrary());
    final Condition<String> globalContains=new Condition<String>(){
      @Override public boolean value(      String name){
        return globalDefinitions.contains(name);
      }
    }
;
    final SortResult sortResult=sortLibraries(new LibrarySorter(new FlexDefinitionProcessor(libraryCollector.getFlexSdkVersion()),new FlexDefinitionMapProcessor(libraryCollector.getFlexSdkVersion(),globalContains)),libraryCollector,globalContains,key,true);
    flexLibrarySet=new FlexLibrarySet(sortResult,null,new ContainsCondition(globalDefinitions,sortResult.definitionMap),assetCounter,libraryCollector.getFlexSdkVersion());
    registerLibrarySet(key,flexLibrarySet);
  }
  return flexLibrarySet;
}
