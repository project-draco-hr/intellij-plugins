{
  indicator.setText(FlexUIDesignerBundle.message("open.document"));
  Client client=Client.getInstance();
  if (!client.flush()) {
    cancel();
  }
  final ProblemsHolder problemsHolder=new ProblemsHolder();
  if (unregisteredDocumentReferences != null && !client.registerDocumentReferences(unregisteredDocumentReferences,module,problemsHolder)) {
    return;
  }
  final MessageBusConnection connection=ApplicationManager.getApplication().getMessageBus().connect(appParentDisposable);
  connection.subscribe(SocketInputHandler.MESSAGE_TOPIC,new SocketInputHandler.DocumentOpenedListener(){
    @Override public void documentOpened(){
      semaphoreUp();
    }
    @Override public void errorOccured(){
      semaphoreUp();
    }
    private void semaphoreUp(){
      connection.disconnect();
      semaphore.up();
    }
  }
);
  semaphore.down();
  if (client.openDocument(module,psiFile,true,problemsHolder)) {
    if (!client.flush()) {
      cancel();
    }
    indicator.setText(FlexUIDesignerBundle.message("loading.libraries"));
    semaphore.waitFor();
  }
 else {
    semaphore.up();
    connection.disconnect();
  }
}
