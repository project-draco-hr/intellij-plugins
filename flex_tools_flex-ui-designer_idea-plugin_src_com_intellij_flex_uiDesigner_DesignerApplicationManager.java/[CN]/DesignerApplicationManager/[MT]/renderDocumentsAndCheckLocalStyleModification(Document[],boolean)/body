{
synchronized (initialRenderQueue) {
    final AtomicBoolean result=new AtomicBoolean();
    if (!initialRenderQueue.isEmpty()) {
      initialRenderQueue.processActions(new Processor<RenderAction>(){
        @Override public boolean process(        RenderAction renderAction){
          if (renderAction.file == null) {
            ComplexRenderAction action=(ComplexRenderAction)renderAction;
            if (onlyStyle == action.onlyStyle) {
              THashSet<Document> merged=new THashSet<Document>(action.documents.length + documents.length);
              Collections.addAll(merged,documents);
              action.documents=merged.toArray(new Document[merged.size()]);
              result.set(true);
              return false;
            }
          }
          return true;
        }
      }
);
    }
    if (!result.get()) {
      initialRenderQueue.add(new ComplexRenderAction(documents,onlyStyle));
    }
  }
}
