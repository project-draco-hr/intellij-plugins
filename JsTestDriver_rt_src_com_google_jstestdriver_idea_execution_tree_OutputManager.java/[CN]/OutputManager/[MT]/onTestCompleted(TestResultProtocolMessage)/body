{
  TestNode testNode=getOrCreateTestNode(message);
  if (message.log != null && !message.log.isEmpty()) {
    TCMessage stdOutMessage=TC.testStdOut(testNode.getName());
    stdOutMessage.addAttribute(TCAttribute.STDOUT,message.log + "\n");
    stdOutMessage.print(myOutStream);
  }
  TestResult.Result result=TestResult.Result.valueOf(message.result);
  if (result == TestResult.Result.passed) {
    TCMessage testFinishedMessage=TC.testFinished(testNode.getName());
    testFinishedMessage.addAttribute(TCAttribute.TEST_DURATION,Integer.toString((int)message.duration));
    testFinishedMessage.print(myOutStream);
  }
 else {
    final String stackStr;
    if (message.stack.startsWith(message.message)) {
      String s=message.stack.substring(message.message.length());
      stackStr=s.replaceFirst("^[\n\r]*","");
    }
 else {
      stackStr=message.stack;
    }
    TCMessage testFailedMessage=TC.testFailed(testNode.getName());
    testFailedMessage.addAttribute(TCAttribute.EXCEPTION_MESSAGE,message.message);
    testFailedMessage.addAttribute(TCAttribute.EXCEPTION_STACKTRACE,stackStr);
    if (result == TestResult.Result.error) {
      testFailedMessage.addAttribute(TCAttribute.IS_TEST_ERROR,"yes");
    }
    testFailedMessage.addAttribute(TCAttribute.TEST_DURATION,Integer.toString((int)message.duration));
    testFailedMessage.print(myOutStream);
  }
}
