{
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      ContainerUtil.process(installedPackages,new Processor<InstalledPackage>(){
        @Override public boolean process(        final InstalledPackage aPackage){
          listener.operationStarted(aPackage.getName());
          final Ref<String> errorMessage=new Ref<String>();
          try {
            myCommands.pluginRemove(aPackage.getName());
          }
 catch (          Exception e) {
            errorMessage.set(e.getMessage() == null ? e.toString() : e.getMessage());
          }
 finally {
            ApplicationManager.getApplication().invokeLater(new Runnable(){
              @Override public void run(){
                listener.operationFinished(aPackage.getName(),ErrorDescription.fromMessage(errorMessage.get()));
                scheduleFileSystemRefresh();
              }
            }
,ModalityState.any());
          }
          return true;
        }
      }
);
    }
  }
);
}
