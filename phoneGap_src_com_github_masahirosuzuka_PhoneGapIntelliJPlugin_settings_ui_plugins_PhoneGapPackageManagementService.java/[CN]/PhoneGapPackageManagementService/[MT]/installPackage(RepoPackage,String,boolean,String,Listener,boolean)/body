{
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      listener.operationStarted(repoPackage.getName());
      final Ref<String> errorMessage=new Ref<String>();
      try {
        String appendVersion=version == null ? "" : "@" + version;
        myCommands.pluginAdd(repoPackage.getName() + appendVersion);
      }
 catch (      Exception e) {
        String message=e.getMessage();
        errorMessage.set(message == null ? e.toString() : message);
      }
 finally {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            listener.operationFinished(repoPackage.getName(),errorMessage.get());
            scheduleFileSystemRefresh();
          }
        }
,ModalityState.any());
      }
    }
  }
);
}
