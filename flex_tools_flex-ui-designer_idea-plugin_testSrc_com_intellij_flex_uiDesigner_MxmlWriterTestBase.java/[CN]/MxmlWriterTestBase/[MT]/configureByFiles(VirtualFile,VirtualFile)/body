{
  myFile=null;
  myEditor=null;
  final File toDirIO=createTempDirectory();
  final VirtualFile toDir=getVirtualFile(toDirIO);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        final ModuleRootManager rootManager=ModuleRootManager.getInstance(myModule);
        final ModifiableRootModel rootModel=rootManager.getModifiableModel();
        boolean rootSpecified=rawProjectRoot != null;
        int rawRootPathLength=rootSpecified ? rawProjectRoot.getPath().length() : -1;
        for (int i=vFiles.length - 1; i >= 0; i--) {
          VirtualFile vFile=vFiles[i];
          if (rootSpecified) {
            copyFilesFillingEditorInfos(rawProjectRoot,toDir,vFile.getPath().substring(rawRootPathLength));
          }
 else {
            copyFilesFillingEditorInfos(vFile.getParent(),toDir,vFile.getName());
          }
        }
        rootModel.addContentEntry(toDir).addSourceFolder(toDir,false);
        modifyModule(rootModel);
        doCommitModel(rootModel);
        sourceRootAdded(toDir);
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
);
  runAdl();
  return toDir;
}
