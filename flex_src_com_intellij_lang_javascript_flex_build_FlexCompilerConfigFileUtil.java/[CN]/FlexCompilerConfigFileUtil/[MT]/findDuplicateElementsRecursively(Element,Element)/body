{
  final Collection<Element> result=new THashSet<Element>();
  for (  Element potentialChild : (Iterable<Element>)otherElement.getChildren()) {
    final List existingChildren=existingElement.getChildren(potentialChild.getName(),existingElement.getNamespace());
    for (    Element existingChild : (Iterable<Element>)existingChildren) {
      final String potentialChildContent=potentialChild.getTextTrim();
      if (potentialChildContent.isEmpty()) {
        result.addAll(findDuplicateElementsRecursively(existingChild,potentialChild));
      }
 else {
        final String existingElementContent=existingChild.getTextTrim();
        if (areOptionValuesEqual(existingChild.getName(),potentialChildContent,existingElementContent)) {
          if (existingElement.getChildren().size() == existingChildren.size()) {
            result.add(potentialChild);
          }
        }
      }
    }
  }
  return result;
}
