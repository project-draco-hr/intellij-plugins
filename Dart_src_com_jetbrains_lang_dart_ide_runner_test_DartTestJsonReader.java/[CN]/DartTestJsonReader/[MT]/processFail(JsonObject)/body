{
  long duration=testMillis(obj) - startMillis;
  String message=failMessage(obj);
  String expectedText=null, actualText=null, failureMessage=message;
  int firstExpectedIndex=message.indexOf(EXPECTED);
  if (firstExpectedIndex >= 0) {
    Matcher matcher=EXPECTED_ACTUAL_RESULT.matcher(message);
    if (matcher.find(firstExpectedIndex + EXPECTED.length())) {
      int matchEnd=matcher.end();
      expectedText=matcher.group(1);
      actualText=matcher.group(2);
      failureMessage=message.substring(0,firstExpectedIndex);
    }
  }
  myProcessor.signalTestFailure(testName(obj),myTestId,failureMessage,stackTrace(obj),false,actualText,expectedText,null,duration);
}
