{
  return ApplicationManager.getApplication().runReadAction(new Computable<ProcessingItem[]>(){
    public ProcessingItem[] compute(){
      CompileScope compilescope=compileContext.getCompileScope();
      Module[] affectedModules=compilescope.getAffectedModules();
      if (affectedModules.length == 0) {
        return ProcessingItem.EMPTY_ARRAY;
      }
      Project project=affectedModules[0].getProject();
      Module[] modules=ModuleManager.getInstance(project).getModules();
      THashSet<Module> thashset=new THashSet<Module>();
      for (      Module module : modules) {
        if (!OsmorcFacet.hasOsmorcFacet(module)) {
          continue;
        }
        thashset.add(module);
      }
      ProcessingItem[] result=new ProcessingItem[thashset.size()];
      int i=0;
      for (      Object aThashset : thashset) {
        Module module=(Module)aThashset;
        if (module.getModuleFile() != null) {
          result[i++]=new BundleProcessingItem(module);
        }
      }
      return result;
    }
  }
);
}
