{
  return ApplicationManager.getApplication().runReadAction(new Computable<ProcessingItem[]>(){
    public ProcessingItem[] compute(){
      Module[] affectedModules=compileContext.getCompileScope().getAffectedModules();
      if (affectedModules.length == 0) {
        return ProcessingItem.EMPTY_ARRAY;
      }
      List<ProcessingItem> result=ContainerUtil.newArrayList();
      for (      Module module : affectedModules) {
        OsmorcFacet facet=OsmorcFacet.getInstance(module);
        if (facet != null) {
          result.add(new BundleProcessingItem(module,facet));
        }
      }
      return result.toArray(new ProcessingItem[result.size()]);
    }
  }
);
}
