{
  if (myWorkingSdk != null) {
    Sdk existingSdk=findExistingSdk(getSdkPath(),FlexIdeUtils.getSdkType());
    if (existingSdk != null) {
      copy(myWorkingSdk,(ProjectJdkImpl)existingSdk);
      myRootModel.setSdk(existingSdk);
      mySdksModel.apply();
    }
 else {
      JdkListConfigurable.getInstance(myProject).addJdkNode(myWorkingSdk,false);
      mySdksModel.doAdd(myWorkingSdk,null);
      myRootModel.setSdk(myWorkingSdk);
    }
    myWorkingSdk=null;
  }
 else   if (!pathsEqual(myInitialSdkHome,getSdkPath())) {
    String newSdkHome=getSdkPath();
    final SdkType sdkType=FlexIdeUtils.getSdkType();
    if (StringUtil.isEmpty(newSdkHome) || !sdkType.isValidSdkHome(newSdkHome)) {
      myRootModel.setSdk(null);
    }
 else {
      Sdk sdk=findExistingSdk(newSdkHome,sdkType);
      if (sdk == null) {
        sdk=createSdk(newSdkHome);
        JdkListConfigurable.getInstance(myProject).addJdkNode(sdk,false);
        mySdksModel.doAdd((ProjectJdkImpl)sdk,null);
      }
      myRootModel.setSdk(sdk);
    }
  }
  mySdkPathCombo.saveHistory();
}
