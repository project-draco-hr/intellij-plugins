{
  final GeneralCommandLine command=new GeneralCommandLine();
  command.setExePath(analyzerExecutable.getPath());
  final Map<String,String> envParams=new THashMap<String,String>();
  envParams.put("com.google.dart.sdk",sdkPath);
  command.setEnvParams(envParams);
  try {
    command.addParameter("--ignore-unrecognized-flags");
    command.addParameter("--type-checks-for-inferred-types");
    command.addParameter("--error_format");
    command.addParameter("machine");
    command.addParameter("--resolve-on-parse-error");
    if (incremental) {
      command.addParameter("--incremental");
    }
    if (workPath != null) {
      command.addParameter("--work");
      command.addParameter(workPath);
    }
    final VirtualFile packages=DartResolveUtil.findPackagesFolder(libraryRoot,myProject);
    if (packages != null && packages.isDirectory()) {
      command.addParameter("--package-root");
      command.addParameter(packages.getPath() + "/");
    }
    command.addParameter(libraryRoot.getPath());
    LOG.debug("executing:\n" + command.getCommandLineString());
    final ProcessOutput output=new CapturingProcessHandler(command.createProcess(),Charset.defaultCharset(),command.getCommandLineString()).runProcess();
    LOG.debug("analyzer exited with exit code: " + output.getExitCode());
    LOG.debug(output.getStdout());
    LOG.debug(output.getStderr());
    final List<AnalyzerMessage> messages=AnalyzerMessage.parseMessages(output.getStderrLines(),libraryRoot.getPath());
    LOG.debug("messages");
    for (    AnalyzerMessage message : messages) {
      LOG.debug(message.toString());
    }
    return messages;
  }
 catch (  ExecutionException e) {
    LOG.debug("Exception while executing the analyzer process:",e);
    return null;
  }
}
