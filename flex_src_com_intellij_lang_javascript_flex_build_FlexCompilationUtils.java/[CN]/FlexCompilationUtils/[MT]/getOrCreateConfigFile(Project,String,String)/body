{
  final VirtualFile existingConfigFile=VfsUtil.findRelativeFile(name,FlexUtils.getFlexCompilerWorkDir(project,null));
  if (existingConfigFile != null && Arrays.equals(text.getBytes(),existingConfigFile.contentsToByteArray())) {
    return existingConfigFile;
  }
  final Ref<VirtualFile> fileRef=new Ref<VirtualFile>();
  final Ref<IOException> error=new Ref<IOException>();
  final Runnable runnable=new Runnable(){
    public void run(){
      fileRef.set(ApplicationManager.getApplication().runWriteAction(new NullableComputable<VirtualFile>(){
        public VirtualFile compute(){
          try {
            final String baseDirPath=FlexUtils.getTempFlexConfigsDirPath();
            final VirtualFile baseDir=VfsUtil.createDirectories(baseDirPath);
            VirtualFile configFile=baseDir.findChild(name);
            if (configFile == null) {
              configFile=baseDir.createChildData(this,name);
            }
            VfsUtil.saveText(configFile,text);
            return configFile;
          }
 catch (          IOException ex) {
            error.set(ex);
          }
          return null;
        }
      }
));
    }
  }
;
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    runnable.run();
  }
 else {
    ApplicationManager.getApplication().invokeAndWait(runnable,ProgressManager.getInstance().getProgressIndicator().getModalityState());
  }
  if (!error.isNull()) {
    throw error.get();
  }
  return fileRef.get();
}
