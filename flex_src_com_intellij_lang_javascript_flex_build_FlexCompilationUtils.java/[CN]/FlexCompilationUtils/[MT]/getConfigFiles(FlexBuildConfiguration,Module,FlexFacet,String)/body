{
  final List<VirtualFile> result=new ArrayList<VirtualFile>();
  if (config.USE_CUSTOM_CONFIG_FILE && !FlexCompilerHandler.needToMergeAutogeneratedAndCustomConfigFile(config,cssFilePath != null)) {
    final String customConfigFilePath=config.getType() == FlexBuildConfiguration.Type.FlexUnit && config.USE_CUSTOM_CONFIG_FILE_FOR_TESTS ? config.CUSTOM_CONFIG_FILE_FOR_TESTS : config.CUSTOM_CONFIG_FILE;
    final VirtualFile customConfigFile=VfsUtil.findRelativeFile(customConfigFilePath,FlexUtils.getFlexCompilerWorkDir(module.getProject(),null));
    if (customConfigFile != null) {
      result.add(customConfigFile);
    }
  }
  if (!config.USE_CUSTOM_CONFIG_FILE || config.getType() == FlexBuildConfiguration.Type.FlexUnit || config.getType() == FlexBuildConfiguration.Type.OverriddenMainClass || cssFilePath != null) {
    final String cssFileName=cssFilePath == null ? null : cssFilePath.substring(cssFilePath.lastIndexOf('/') + 1);
    final String postfix=cssFileName == null ? null : FileUtil.getNameWithoutExtension(cssFileName);
    final String name=FlexCompilerHandler.generateConfigFileName(module,flexFacet,config.getType().getConfigFilePrefix(),postfix);
    final String configText=FlexCompilerHandler.generateConfigFileText(module,config,cssFilePath);
    final VirtualFile existingConfigFile=VfsUtil.findRelativeFile(name,FlexUtils.getFlexCompilerWorkDir(module.getProject(),null));
    if (existingConfigFile == null || !Arrays.equals(configText.getBytes(),existingConfigFile.contentsToByteArray())) {
      final Ref<VirtualFile> fileRef=new Ref<VirtualFile>();
      final Ref<IOException> error=new Ref<IOException>();
      final Runnable runnable=new Runnable(){
        public void run(){
          fileRef.set(ApplicationManager.getApplication().runWriteAction(new NullableComputable<VirtualFile>(){
            public VirtualFile compute(){
              try {
                final String baseDirPath=FlexUtils.getTempFlexConfigsDirPath();
                final VirtualFile baseDir=VfsUtil.createDirectories(baseDirPath);
                VirtualFile configFile=baseDir.findChild(name);
                if (configFile == null) {
                  configFile=baseDir.createChildData(this,name);
                }
                VfsUtil.saveText(configFile,configText);
                return configFile;
              }
 catch (              IOException ex) {
                error.set(ex);
              }
              return null;
            }
          }
));
        }
      }
;
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        runnable.run();
      }
 else {
        ApplicationManager.getApplication().invokeAndWait(runnable,ProgressManager.getInstance().getProgressIndicator().getModalityState());
      }
      if (!error.isNull()) {
        throw error.get();
      }
      result.add(fileRef.get());
    }
 else {
      result.add(existingConfigFile);
    }
  }
  return result;
}
