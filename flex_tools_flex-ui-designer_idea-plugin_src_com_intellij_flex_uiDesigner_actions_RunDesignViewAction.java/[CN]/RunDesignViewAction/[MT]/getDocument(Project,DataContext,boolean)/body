{
  if (popupPlace) {
    final VirtualFile virtualFile=LangDataKeys.VIRTUAL_FILE.getData(dataContext);
    if (virtualFile != null) {
      return FileDocumentManager.getInstance().getDocument(virtualFile);
    }
  }
 else {
    Editor editor=LangDataKeys.EDITOR.getData(dataContext);
    if (editor == null) {
      editor=FileEditorManager.getInstance(project).getSelectedTextEditor();
    }
    return editor == null ? null : editor.getDocument();
  }
  return null;
}
