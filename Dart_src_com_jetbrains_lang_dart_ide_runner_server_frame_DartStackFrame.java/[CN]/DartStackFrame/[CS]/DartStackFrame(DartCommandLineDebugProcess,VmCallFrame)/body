{
  myDebugProcess=debugProcess;
  myVmCallFrame=vmCallFrame;
  final Project project=debugProcess.getSession().getProject();
  final VmLocation location=vmCallFrame.getLocation();
  final String locationUrl=location == null ? null : location.getUrl();
  if (locationUrl != null) {
    final VirtualFile file;
    if (locationUrl.startsWith("file:")) {
      file=VirtualFileManager.getInstance().findFileByUrl(threeSlashizeFileUrl(locationUrl));
    }
 else     if (locationUrl.startsWith("dart:")) {
      final String sdkLibNameOrRelPath=locationUrl.substring("dart:".length());
      final VirtualFile sdkLibByName=DartLibraryIndex.getStandardLibraryFromSdk(project,sdkLibNameOrRelPath);
      if (sdkLibByName != null) {
        file=sdkLibByName;
      }
 else {
        final DartSdk sdk=DartSdk.getGlobalDartSdk();
        final String path=sdk == null ? null : sdk.getHomePath() + "/lib/" + sdkLibNameOrRelPath;
        file=path == null ? null : LocalFileSystem.getInstance().findFileByPath(path);
      }
    }
 else     if (locationUrl.startsWith("package:")) {
      final String packageRelPath=locationUrl.substring("package:".length());
      final VirtualFile pubspecYamlFile=myDebugProcess.getPubspecYamlFile();
      final String pubspecName=pubspecYamlFile == null ? null : PubspecYamlUtil.getPubspecName(pubspecYamlFile);
      if (pubspecName != null && packageRelPath.startsWith(pubspecName + "/")) {
        file=pubspecYamlFile.findFileByRelativePath("../lib" + packageRelPath.substring(pubspecName.length()));
      }
 else {
        final VirtualFile packagesFolder=myDebugProcess.getPackagesFolder();
        final String path=packagesFolder == null ? null : packagesFolder.getPath() + "/" + packageRelPath;
        file=path == null ? null : LocalFileSystem.getInstance().findFileByPath(path);
      }
    }
 else {
      LOG.warn("Unexpected URL:" + locationUrl);
      file=null;
    }
    final int line=location.getLineNumber(debugProcess.getVmConnection()) - 1;
    mySourcePosition=file == null || line < 0 ? null : XDebuggerUtil.getInstance().createPosition(file,line);
  }
 else {
    mySourcePosition=null;
  }
}
