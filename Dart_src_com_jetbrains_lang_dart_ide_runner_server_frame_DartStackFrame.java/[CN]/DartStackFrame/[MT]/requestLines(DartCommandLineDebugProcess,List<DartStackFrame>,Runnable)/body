{
  if (stackFrames.isEmpty() && after != null) {
    after.run();
    return;
  }
  for (int i=0; i < stackFrames.size(); i++) {
    final DartStackFrame stackFrame=stackFrames.get(i);
    JsonObject commandObject=DartCommandLineDebugProcess.getCommandObject("getLineNumberTable");
    JsonObject params=new JsonObject();
    params.addProperty("url",DartCommandLineDebugProcess.fixFileUrl(stackFrame.getFileUrl()));
    params.addProperty("libraryId",stackFrame.getLibraryId());
    commandObject.add("params",params);
    final boolean isLast=i == stackFrames.size() - 1;
    debugProcess.sendCommand(commandObject,new AbstractResponseToRequestHandler<JsonResponse>(){
      @Override public boolean processResponse(      JsonResponse response){
        if (response.getJsonObject().get("error") == null) {
          JsonObject result=response.getJsonObject().get("result").getAsJsonObject();
          JsonArray lines=result.get("lines").getAsJsonArray();
          stackFrame.setLine(findLineByOffset(lines,stackFrame.getOffset()) - 1);
        }
        if (isLast && after != null) {
          after.run();
        }
        return true;
      }
    }
);
  }
}
