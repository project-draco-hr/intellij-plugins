{
  StringBuilder stringBuilder=null;
  int exitCode=-1;
  @SuppressWarnings("IOResourceOpenedButNotSafelyClosed") final InputStreamReader reader=new InputStreamReader(process.getInputStream());
  final List<String> filesForRefresh=new ArrayList<String>(projects.size());
  final THashMap<MavenProject,List<String>> sourceRoots=new THashMap<MavenProject,List<String>>(projects.size());
  try {
    stringBuilder=StringBuilderSpinAllocator.alloc();
    char[] buf=new char[128];
    int read;
    final Matcher matcher=RESULT_PATTERN.matcher(stringBuilder);
    int startForResultParse=0;
    while ((read=reader.read(buf,0,buf.length)) >= 0) {
      stringBuilder.append(buf,0,read);
      if (indicator.isCanceled()) {
        process.destroy();
      }
      if (matcher.find(startForResultParse)) {
        MavenProject mavenProject=projects.get(Integer.parseInt(matcher.group(1)));
        indicator.setText2(mavenProject.getDisplayName());
        filesForRefresh.add(matcher.group(2));
        StringTokenizer tokenizer=new StringTokenizer(matcher.group(3),"|");
        List<String> moduleSourcesRoots=new ArrayList<String>();
        while (tokenizer.hasMoreTokens()) {
          moduleSourcesRoots.add(tokenizer.nextToken());
        }
        sourceRoots.put(mavenProject,moduleSourcesRoots);
        startForResultParse=stringBuilder.length();
      }
    }
    try {
      process.waitFor();
    }
 catch (    InterruptedException ignored) {
    }
    exitCode=process.exitValue();
  }
 catch (  IOException e) {
    if (stringBuilder != null) {
      LOG.warn(stringBuilder.toString(),e);
    }
  }
 finally {
    process.destroy();
    process=null;
    if (stringBuilder != null) {
      final String result=stringBuilder.toString();
      StringBuilderSpinAllocator.dispose(stringBuilder);
      if (exitCode != 0) {
        LOG.warn("Generating flex configs exited with exit code " + exitCode);
        showWarning(project);
      }
      LOG.info("Generating flex configs out:\n" + result);
    }
    final Matcher matcher=MAVEN_ERROR_PATTERN.matcher(stringBuilder);
    if (matcher.find()) {
      stringBuilder=StringBuilderSpinAllocator.alloc();
      try {
        do {
          stringBuilder.append("<br>").append(matcher.group(1));
        }
 while (matcher.find());
        showWarning(stringBuilder.toString(),project);
      }
  finally {
        StringBuilderSpinAllocator.dispose(stringBuilder);
      }
    }
    if (!filesForRefresh.isEmpty()) {
      postTask=new RefreshConfigFiles(filesForRefresh,sourceRoots,project);
    }
  }
}
