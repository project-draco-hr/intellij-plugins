{
  if (myProject.isDisposed()) {
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      LanguageLevel projectLevel=LanguageLevelProjectExtension.getInstance(myProject).getLanguageLevel();
      Map<Project,ModifiableRootModel> rootModels=ContainerUtil.newHashMap();
      ModifiableModuleModel moduleModel=ModuleManager.getInstance(myProject).getModifiableModel();
      LibraryTable.ModifiableModel libraryModel=ProjectLibraryTable.getInstance(myProject).getModifiableModel();
      try {
        for (        Project project : myProjects) {
          try {
            rootModels.put(project,createModule(moduleModel,project,projectLevel));
          }
 catch (          Exception e) {
            LOG.error(e);
          }
        }
        for (        Project project : myProjects) {
          try {
            setDependencies(moduleModel,libraryModel,rootModels.get(project),project);
          }
 catch (          Exception e) {
            LOG.error(e);
          }
        }
      }
  finally {
        libraryModel.commit();
        ModifiableModelCommitter.multiCommit(rootModels.values(),moduleModel);
      }
    }
  }
);
}
