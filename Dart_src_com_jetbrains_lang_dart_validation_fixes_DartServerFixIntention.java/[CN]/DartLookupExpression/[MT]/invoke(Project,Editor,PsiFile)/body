{
  final SourceFileEdit fileEdit=myChange.getEdits().get(0);
  final String filePath=fileEdit.getFile();
  final SourceEdit sourceEdit=fileEdit.getEdits().get(0);
  if (fileEdit.getFileStamp() == -1) {
    try {
      final String directoryPath=VfsUtil.getParentDir(filePath);
      final VirtualFile directory=VfsUtil.createDirectoryIfMissing(directoryPath);
      if (directory != null) {
        final String fileName=VfsUtil.extractFileName(filePath);
        directory.createChildData(this,fileName);
      }
    }
 catch (    IOException e) {
    }
  }
  final VirtualFile virtualFile=LocalFileSystem.getInstance().findFileByPath(FileUtil.toSystemIndependentName(filePath));
  if (virtualFile == null)   return;
  if (!FileModificationService.getInstance().prepareVirtualFilesForWrite(project,Collections.singletonList(virtualFile)))   return;
  final Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  if (document == null)   return;
  if (sourceEdit.getLength() > 0) {
    final Runnable runnable=new Runnable(){
      public void run(){
        document.deleteString(sourceEdit.getOffset(),sourceEdit.getOffset() + sourceEdit.getLength());
      }
    }
;
    if (CommandProcessor.getInstance().getCurrentCommand() == null) {
      CommandProcessor.getInstance().runUndoTransparentAction(runnable);
    }
 else {
      runnable.run();
    }
  }
  final TemplateManager templateManager=TemplateManager.getInstance(project);
  final Template template=templateManager.createTemplate("","");
  template.setToReformat(true);
  addContents(template,sourceEdit);
  final Editor targetEditor=BaseCreateFix.navigate(project,sourceEdit.getOffset(),virtualFile);
  if (targetEditor != null) {
    templateManager.startTemplate(targetEditor,template);
  }
}
