{
  allAvailableBundles.clear();
  final Set<SelectedBundle> bundles=new HashSet<SelectedBundle>();
  Module[] modules=ModuleManager.getInstance(project).getModules();
  for (  Module module : modules) {
    if (OsmorcFacet.hasOsmorcFacet(module)) {
      SelectedBundle selectedBundle=new SelectedBundle(module.getName(),null,SelectedBundle.BundleType.Module);
      bundles.add(selectedBundle);
    }
  }
  if (usedFramework != null) {
    FrameworkIntegrator integrator=FrameworkIntegratorRegistry.getInstance().findIntegratorByInstanceDefinition(usedFramework);
    if (integrator != null) {
      FrameworkInstanceManager manager=integrator.getFrameworkInstanceManager();
      if (manager instanceof AbstractFrameworkInstanceManager) {
        Collection<SelectedBundle> frameworkBundles=((AbstractFrameworkInstanceManager)manager).getFrameworkBundles(usedFramework,FrameworkBundleType.OTHER);
        bundles.addAll(frameworkBundles);
      }
    }
    String[] urls=OrderEnumerator.orderEntries(project).withoutSdk().withoutModuleSourceEntries().withoutDepModules().productionOnly().runtimeOnly().satisfying(BundleCompiler.NOT_FRAMEWORK_LIBRARY_CONDITION).classes().getUrls();
    for (    String url : urls) {
      url=BundleCompiler.convertJarUrlToFileUrl(url);
      url=BundleCompiler.fixFileURL(url);
      String displayName=CachingBundleInfoProvider.getBundleSymbolicName(url);
      if (displayName != null) {
        SelectedBundle selectedBundle=new SelectedBundle(displayName,url,SelectedBundle.BundleType.StartLibrary);
        bundles.add(selectedBundle);
      }
    }
  }
  bundles.removeAll(hideBundles);
  allAvailableBundles.addAll(bundles);
  Collections.sort(allAvailableBundles,new TypeComparator());
}
