{
  File nodeInterpreter=new File(myNodeInterpreterPath);
  File karmaPackageDir=new File(myKarmaPackageDirPath);
  File configurationFile=new File(myRunSettings.getConfigPath());
  KarmaServer server=KarmaServerRegistry.getServer(nodeInterpreter,karmaPackageDir,configurationFile);
  if (server != null && server.getRestarter().isRestartRequired()) {
    server.shutdownAsync();
    server=null;
  }
  if (server == null) {
    KarmaServerRegistry.startServer(nodeInterpreter,karmaPackageDir,configurationFile,new CatchingConsumer<KarmaServer,Exception>(){
      @Override public void consume(      final Exception e){
        showServerStartupError(e);
      }
      @Override public void consume(      KarmaServer server){
        UIUtil.invokeLaterIfNeeded(new Runnable(){
          @Override public void run(){
            RunnerAndConfigurationSettings configuration=myExecutionEnvironment.getRunnerAndConfigurationSettings();
            if (configuration != null) {
              ProgramRunnerUtil.executeConfiguration(myProject,configuration,executor);
            }
          }
        }
);
      }
    }
);
  }
  return server;
}
