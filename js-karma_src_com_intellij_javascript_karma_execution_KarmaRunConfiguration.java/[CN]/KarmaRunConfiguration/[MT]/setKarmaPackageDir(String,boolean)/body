{
  Project project=getProject();
  boolean local=FileUtil.toSystemIndependentName(karmaPackageDir).equals(FileUtil.toSystemIndependentName(myRunSettings.getKarmaPackageDir()));
  if (!local) {
    local=KarmaUtil.isPathUnderContentRoots(project,karmaPackageDir);
  }
  if (local) {
    if (StringUtil.isEmpty(myRunSettings.getKarmaPackageDir()) || !initializeOnly) {
      setRunSettings(new KarmaRunSettings.Builder(myRunSettings).setKarmaPackageDir(karmaPackageDir).build());
    }
  }
 else {
    String projectKarmaPackageDir=KarmaProjectSettings.getKarmaPackageDir(project);
    if (StringUtil.isEmpty(projectKarmaPackageDir) || !initializeOnly) {
      KarmaProjectSettings.setKarmaPackageDir(project,karmaPackageDir);
    }
  }
}
