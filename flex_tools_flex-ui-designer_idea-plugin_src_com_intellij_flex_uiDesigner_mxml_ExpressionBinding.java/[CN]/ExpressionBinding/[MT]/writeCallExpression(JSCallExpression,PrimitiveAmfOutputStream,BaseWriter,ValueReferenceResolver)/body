{
  final JSReferenceExpression methodExpression=(JSReferenceExpression)expression.getMethodExpression();
  final JSFunction function=(JSFunction)resolveReferenceExpression(methodExpression);
  final JSExpression[] arguments;
  final int rollbackPosition;
  final int start;
  if (function.isConstructor()) {
    arguments=expression.getArguments();
    final JSClass jsClass=(JSClass)function.getParent();
    writer.writeNew(jsClass.getQualifiedName(),arguments.length);
    rollbackPosition=out.allocateShort();
    start=out.size();
  }
 else {
    out.write(ExpressionMessageTypes.CALL);
    rollbackPosition=out.allocateShort();
    start=out.size();
    JSReferenceExpression qualifier=(JSReferenceExpression)methodExpression.getQualifier();
    while (qualifier != null) {
      writer.write(qualifier.getReferencedName());
      qualifier=(JSReferenceExpression)qualifier.getQualifier();
    }
    out.write(0);
    writer.write(function.getName());
    if (function.isGetProperty()) {
      out.write(-1);
      return;
    }
 else {
      arguments=expression.getArguments();
      out.write(arguments.length);
    }
  }
  for (  JSExpression argument : arguments) {
    writeExpression(argument,out,writer,valueReferenceResolver);
  }
  out.putShort(out.size() - start,rollbackPosition);
}
