{
  final Project project=module.getProject();
  final String title=RBundle.message("rails.facet.builder.run.configuration.server.creating");
  final Task task=new Task.Backgroundable(project,title,true){
    public void run(    @NotNull ProgressIndicator indicator){
      indicator.setText(RBundle.message("progress.backgnd.indicator.title.please.wait",getTitle()));
      final RunManagerEx runManagerEx=RunManagerEx.getInstanceEx(project);
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          final String taskName=RubyMotionUtil.getInstance().getMainRakeTask(module);
          final RunnerAndConfigurationSettings simulator=createAndAddRakeConfiguration(taskName,module,runManagerEx);
          createAndAddRakeConfiguration(RakeUtilBase.TASKS_SPEC_FULLCMD,module,runManagerEx);
          runManagerEx.setSelectedConfiguration(simulator);
        }
      }
);
    }
  }
;
  final Runnable taskRunner=new Runnable(){
    public void run(){
      ProgressManager.getInstance().run(task);
    }
  }
;
  if (!project.isInitialized()) {
    StartupManager.getInstance(project).registerPostStartupActivity(taskRunner);
  }
 else {
    taskRunner.run();
  }
}
