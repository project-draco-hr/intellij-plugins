{
  final FlexIdeBuildConfiguration defaultConfiguration=new FlexIdeBuildConfigurationImpl();
  final BuildConfigurationNature nature=configuration.getNature();
  if (configuration.getOutputType() != OutputType.RuntimeLoadedModule) {
    configuration.setOptimizeFor(defaultConfiguration.getOptimizeFor());
  }
  if (nature.isLib()) {
    configuration.setMainClass(defaultConfiguration.getMainClass());
  }
  if (!nature.isWebPlatform() || !nature.isApp()) {
    configuration.setUseHtmlWrapper(defaultConfiguration.isUseHtmlWrapper());
    configuration.setWrapperTemplatePath(defaultConfiguration.getWrapperTemplatePath());
  }
  if (nature.isMobilePlatform() || !nature.isApp()) {
    configuration.setCssFilesToCompile(defaultConfiguration.getCssFilesToCompile());
  }
  if (!ArrayUtil.contains(configuration.getDependencies().getFrameworkLinkage(),BCUtils.getSuitableFrameworkLinkages(nature))) {
    configuration.getDependencies().setFrameworkLinkage(defaultConfiguration.getDependencies().getFrameworkLinkage());
  }
  if (!nature.isWebPlatform()) {
    configuration.getDependencies().setTargetPlayer(defaultConfiguration.getDependencies().getTargetPlayer());
  }
  if (nature.isMobilePlatform() || configuration.isPureAs()) {
    configuration.getDependencies().setComponentSet(defaultConfiguration.getDependencies().getComponentSet());
  }
  for (Iterator<ModifiableDependencyEntry> i=configuration.getDependencies().getModifiableEntries().iterator(); i.hasNext(); ) {
    final ModifiableDependencyEntry entry=i.next();
    if (entry instanceof BuildConfigurationEntry) {
      final FlexIdeBuildConfiguration dependencyBC=((BuildConfigurationEntry)entry).findBuildConfiguration();
      if (dependencyBC == null || !BCUtils.isApplicable(nature,dependencyBC.getNature(),entry.getDependencyType().getLinkageType())) {
        i.remove();
      }
    }
  }
  if (configuration.getTargetPlatform() != TargetPlatform.Desktop || configuration.getOutputType() != OutputType.Application) {
    ((AirDesktopPackagingOptionsImpl)defaultConfiguration.getAirDesktopPackagingOptions()).applyTo(((AirDesktopPackagingOptionsImpl)configuration.getAirDesktopPackagingOptions()));
  }
  if (configuration.getTargetPlatform() != TargetPlatform.Mobile || configuration.getOutputType() != OutputType.Application) {
    ((AndroidPackagingOptionsImpl)defaultConfiguration.getAndroidPackagingOptions()).applyTo(((AndroidPackagingOptionsImpl)configuration.getAndroidPackagingOptions()));
    ((IosPackagingOptionsImpl)defaultConfiguration.getIosPackagingOptions()).applyTo(((IosPackagingOptionsImpl)configuration.getIosPackagingOptions()));
  }
  if (!nature.isLib()) {
    configuration.getCompilerOptions().setFilesToIncludeInSWC(Collections.<String>emptyList());
  }
}
