{
  final Application application;
  final List fileSpecs=((CommandLineConfiguration)configuration).getFileSpecs();
  if (fileSpecs.size() > 0) {
    final String inputFilePath=(String)fileSpecs.get(fileSpecs.size() - 1);
    application=new Application(new File(inputFilePath));
  }
 else {
    application=new Application();
  }
  setupConfiguration(application,configuration);
  final String outputFilePath=((CommandLineConfiguration)configuration).getOutput();
  if (outputFilePath == null) {
    throw new ConfigurationException("Output file not set");
  }
  final File outputFile=new File(outputFilePath);
  FlexCompilerUtil.ensureFileCanBeCreated(outputFile);
  application.setOutput(outputFile);
  final List includedResourceBundles=((CommandLineConfiguration)configuration).getIncludeResourceBundles();
  if (includedResourceBundles != null) {
    ((OEMConfiguration)application.getConfiguration()).setIncludeResourceBundles(toStrings(includedResourceBundles));
  }
  return application;
}
