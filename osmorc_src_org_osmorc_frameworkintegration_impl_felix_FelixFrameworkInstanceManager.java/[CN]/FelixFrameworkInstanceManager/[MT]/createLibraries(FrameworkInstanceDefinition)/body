{
  final VirtualFile installFolder=_fileSystem.findFileByPath(frameworkInstanceDefinition.getBaseFolder());
  if (installFolder == null) {
    throw new RuntimeException("The folder " + frameworkInstanceDefinition.getBaseFolder() + " does not exist.");
  }
  if (!installFolder.isDirectory()) {
    throw new RuntimeException(frameworkInstanceDefinition.getBaseFolder() + " is not a folder");
  }
  _application.runWriteAction(new Runnable(){
    public void run(){
      installFolder.refresh(false,true);
      _libraryHandler.startLibraryChanges();
      VirtualFile binFolder=installFolder.findChild("bin");
      if (binFolder != null) {
        _libraryHandler.createLibrariesFromBundles(binFolder,frameworkInstanceDefinition.getName(),_felixSourceFinder);
      }
      VirtualFile bundleFolder=installFolder.findChild("bundle");
      if (bundleFolder != null) {
        _libraryHandler.createLibrariesFromBundles(bundleFolder,frameworkInstanceDefinition.getName(),_felixSourceFinder);
      }
      _libraryHandler.commitLibraryChanges();
      _libraryHandler.endLibraryChanges();
    }
  }
);
}
