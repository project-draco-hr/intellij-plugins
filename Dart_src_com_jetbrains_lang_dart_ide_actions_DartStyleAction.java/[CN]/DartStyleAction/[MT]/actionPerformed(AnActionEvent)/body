{
  final Project project=event.getProject();
  if (project == null) {
    return;
  }
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final Editor editor=event.getData(CommonDataKeys.EDITOR);
  if (editor != null) {
    runDartStyleOverEditor(project,editor);
  }
 else {
    final DartSdk sdk=DartSdk.getDartSdk(project);
    final VirtualFile[] filesAndDirs=CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(event.getDataContext());
    if (sdk == null || !DartAnalysisServerAnnotator.isDartSDKVersionSufficient(sdk) || filesAndDirs == null)     return;
    final List<VirtualFile> vFiles=getApplicableVirtualFiles(project,sdk,filesAndDirs);
    runDartStyleOverVirtualFiles(project,vFiles);
  }
}
