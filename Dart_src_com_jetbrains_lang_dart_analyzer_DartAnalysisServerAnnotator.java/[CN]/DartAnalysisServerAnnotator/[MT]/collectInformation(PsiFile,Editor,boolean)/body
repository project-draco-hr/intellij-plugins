{
  if (hasErrors)   return null;
  if (psiFile instanceof DartExpressionCodeFragment)   return null;
  final VirtualFile annotatedFile=DartResolveUtil.getRealVirtualFile(psiFile);
  if (annotatedFile == null)   return null;
  final Module module=ModuleUtilCore.findModuleForPsiElement(psiFile);
  if (module == null)   return null;
  final DartSdk sdk=DartSdk.getGlobalDartSdk();
  if (sdk == null || StringUtil.compareVersionNumbers(sdk.getVersion(),DartAnalysisServerService.MIN_SDK_VERSION) < 0)   return null;
  if (psiFile instanceof XmlFile && !DartInProcessAnnotator.containsDartEmbeddedContent((XmlFile)psiFile))   return null;
  if (FileUtil.isAncestor(sdk.getHomePath(),annotatedFile.getPath(),true))   return null;
  return new AnnotatorInfo(psiFile.getProject(),annotatedFile.getPath(),DartAnalysisServerService.getSdkHome());
}
