{
  final Location location=error.getLocation();
  int highlightingStart=location.getOffset();
  int highlightingEnd=location.getOffset() + location.getLength();
  if (highlightingEnd > fileTextLength)   highlightingEnd=fileTextLength;
  if (highlightingStart > 0 && highlightingStart >= highlightingEnd)   highlightingStart=highlightingEnd - 1;
  final TextRange textRange=new TextRange(highlightingStart,highlightingEnd);
  final String severity=error.getSeverity();
  final String message=StringUtil.notNullize(error.getMessage());
  final Annotation annotation=AnalysisErrorSeverity.INFO.equals(severity) ? holder.createWeakWarningAnnotation(textRange,message) : AnalysisErrorSeverity.WARNING.equals(severity) ? holder.createWarningAnnotation(textRange,message) : AnalysisErrorSeverity.ERROR.equals(severity) ? holder.createErrorAnnotation(textRange,message) : null;
  if (annotation != null) {
    setupHighlightType(annotation,message);
  }
  return annotation;
}
