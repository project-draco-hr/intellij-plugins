{
  final File clientAppFile;
  try {
    clientAppFile=server.getKarmaJsSourcesLocator().getClientAppFile();
  }
 catch (  IOException e) {
    throw new ExecutionException("Can't find karma-intellij test runner",e);
  }
  if (server.isReady()) {
    int runnerPort=server.getRunnerPort();
    return createOSProcessHandler(runnerPort,clientAppFile);
  }
  final NopProcessHandler nopProcessHandler=new NopProcessHandler();
  server.addListener(new KarmaServerListener(){
    @Override public void onReady(    int webServerPort,    int runnerPort){
      try {
        OSProcessHandler osProcessHandler=createOSProcessHandler(runnerPort,clientAppFile);
        if (myRunContentDescriptor != null) {
          myRunContentDescriptor.setProcessHandler(osProcessHandler);
        }
        osProcessHandler.startNotify();
      }
 catch (      ExecutionException e) {
        LOG.warn(e);
      }
    }
    @Override public void onTerminated(    int exitCode){
      nopProcessHandler.destroyProcess();
    }
  }
);
  return nopProcessHandler;
}
