{
  final File clientAppFile;
  try {
    clientAppFile=server.getKarmaJsSourcesLocator().getClientAppFile();
  }
 catch (  IOException e) {
    throw new ExecutionException("Can't find karma-intellij test runner",e);
  }
  if (server.isReady() && server.hasCapturedBrowsers()) {
    return createOSProcessHandler(server.getRunnerPort(),clientAppFile);
  }
  final NopProcessHandler nopProcessHandler=new NopProcessHandler();
  server.addListener(new KarmaServerAdapter(){
    @Override public void onTerminated(    int exitCode){
      nopProcessHandler.destroyProcess();
    }
  }
);
  return nopProcessHandler;
}
