{
  final File clientAppFile;
  try {
    clientAppFile=server.getKarmaJsSourcesLocator().getClientAppFile();
  }
 catch (  IOException e) {
    throw new ExecutionException("Can't find karma-intellij test runner",e);
  }
  if (server.isReady() && server.hasCapturedBrowsers()) {
    return createOSProcessHandler(server.getRunnerPort(),clientAppFile);
  }
  final NopProcessHandler nopProcessHandler=new NopProcessHandler();
  if (myExecutionType == KarmaExecutionType.RUN) {
    server.doWhenReadyWithCapturedBrowser(new Runnable(){
      @Override public void run(){
        if (nopProcessHandler.isProcessTerminated()) {
          return;
        }
        try {
          OSProcessHandler osProcessHandler=createOSProcessHandler(server.getRunnerPort(),clientAppFile);
          if (myRunContentDescriptor != null) {
            myRunContentDescriptor.setProcessHandler(osProcessHandler);
          }
          osProcessHandler.startNotify();
        }
 catch (        ExecutionException e) {
          LOG.warn(e);
        }
      }
    }
);
  }
  server.addListener(new KarmaServerAdapter(){
    @Override public void onTerminated(    int exitCode){
      nopProcessHandler.destroyProcess();
    }
  }
);
  return nopProcessHandler;
}
