{
  final Ref<CharSequence> contentsRef=Ref.create();
  final Ref<Long> timestampRef=Ref.create();
  final Exception exception=ApplicationManager.getApplication().runReadAction(new NullableComputable<Exception>(){
    @Nullable public Exception compute(){
      final Document cachedDocument=FileDocumentManager.getInstance().getCachedDocument(file);
      if (cachedDocument != null) {
        contentsRef.set(cachedDocument.getCharsSequence());
        timestampRef.set(cachedDocument.getModificationStamp());
      }
 else {
        try {
          contentsRef.set(VfsUtilCore.loadText(file));
          timestampRef.set(file.getModificationStamp());
        }
 catch (        IOException e) {
          return e;
        }
      }
      return null;
    }
  }
);
  if (exception != null)   throw exception;
  return Pair.create(contentsRef.get(),timestampRef.get());
}
