{
  final ChangeSet changeSet=new ChangeSet();
  final Collection<VirtualFile> dartFiles=FileTypeIndex.getFiles(DartFileType.INSTANCE,GlobalSearchScope.projectScope(project));
  final Collection<Source> sources=new ArrayList<Source>(dartFiles.size());
  final Map<String,String> packageRootToPackageNameMap=invertPackageMap(packageMap);
  for (  VirtualFile virtualFile : dartFiles) {
    final URI uri=getUriForFile(virtualFile.getPath(),packageRootToPackageNameMap);
    Source source=new FileBasedSource(uri,new File(virtualFile.getPath()));
    changeSet.addedSource(source);
    sources.add(source);
  }
  analysisContext.applyChanges(changeSet);
  return sources;
}
