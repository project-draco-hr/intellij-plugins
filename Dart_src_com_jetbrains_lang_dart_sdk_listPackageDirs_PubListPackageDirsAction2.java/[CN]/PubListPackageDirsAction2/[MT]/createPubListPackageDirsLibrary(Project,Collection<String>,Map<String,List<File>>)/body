{
  Library library=ProjectLibraryTable.getInstance(project).getLibraryByName(PUB_LIST_PACKAGE_DIRS_LIB_NAME);
  if (library == null) {
    final LibraryTableBase.ModifiableModel libTableModel=ProjectLibraryTable.getInstance(project).getModifiableModel();
    library=libTableModel.createLibrary(PUB_LIST_PACKAGE_DIRS_LIB_NAME,DartListPackageDirsLibraryType.LIBRARY_KIND);
    libTableModel.commit();
  }
  final LibraryEx.ModifiableModelEx libModel=(LibraryEx.ModifiableModelEx)library.getModifiableModel();
  try {
    for (    String url : libModel.getUrls(OrderRootType.CLASSES)) {
      libModel.removeRoot(url,OrderRootType.CLASSES);
    }
    for (    String packageDir : rootsToAddToLib) {
      libModel.addRoot(VfsUtilCore.pathToUrl(packageDir),OrderRootType.CLASSES);
    }
    final DartListPackageDirsLibraryProperties libraryProperties=new DartListPackageDirsLibraryProperties();
    libraryProperties.setPackageNameToFileDirsMap(packageMap);
    libModel.setProperties(libraryProperties);
    libModel.commit();
  }
  finally {
    if (!Disposer.isDisposed(libModel)) {
      Disposer.dispose(libModel);
    }
  }
  return library;
}
