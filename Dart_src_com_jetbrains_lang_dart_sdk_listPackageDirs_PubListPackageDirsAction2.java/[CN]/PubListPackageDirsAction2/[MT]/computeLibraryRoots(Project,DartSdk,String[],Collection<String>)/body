{
  @NotNull final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  for (  final String path : libraries) {
    if (path == null)     continue;
    final String libRoot=PathUtil.getParentPath(FileUtil.toSystemIndependentName(path));
    final VirtualFile vFile=LocalFileSystem.getInstance().findFileByPath(libRoot);
    if (!libRoot.startsWith(dartSdk.getHomePath() + "/") && (vFile == null || !fileIndex.isInContent(vFile))) {
      rootsToAddToLib.add(libRoot);
    }
  }
}
