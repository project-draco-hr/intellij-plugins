{
  try {
    final VirtualFile inSdk1=DartLibraryIndex.getStandardLibraryFromSdk(getProject(),"collection");
    final VirtualFile inSdk2=DartLibraryIndex.getStandardLibraryFromSdk(getProject(),"math");
    final VirtualFile inIdeLib1=myFixture.addFileToProject("library/inLibrary1.dart","").getVirtualFile();
    final VirtualFile inIdeLib2=myFixture.addFileToProject("library/inLibrary2.dart","").getVirtualFile();
    configureLibrary(inIdeLib1.getParent());
    final VirtualFile inContent=myFixture.addFileToProject("inContentOutsideDartRoot.dart","").getVirtualFile();
    myFixture.addFileToProject("DartProject2/pubspec.yaml","name: ProjectName2\n");
    final VirtualFile inProject2Web=myFixture.addFileToProject("DartProject2/web/inProject2Web.dart","").getVirtualFile();
    final VirtualFile inProject2Lib=myFixture.addFileToProject("DartProject2/lib/inProject2Lib.dart","").getVirtualFile();
    final VirtualFile pubspec=myFixture.addFileToProject("DartProject1/pubspec.yaml","name: ProjectName1\n" + "dependencies:\n" + "  PathPackage:\n"+ "    path: ../DartProject2\n").getVirtualFile();
    final VirtualFile inProject1Root=myFixture.addFileToProject("DartProject1/inProject1Root.dart","").getVirtualFile();
    final VirtualFile inLib=myFixture.addFileToProject("DartProject1/lib/inLib.dart","").getVirtualFile();
    final VirtualFile inPackages=myFixture.addFileToProject("DartProject1/packages/inPackages.dart","").getVirtualFile();
    final VirtualFile inWeb=myFixture.addFileToProject("DartProject1/web/inWeb.dart","").getVirtualFile();
    final VirtualFile inWebSub=myFixture.addFileToProject("DartProject1/web/sub/inWebSub.dart","").getVirtualFile();
    final VirtualFile inExcluded=myFixture.addFileToProject("DartProject1/web/packages/inExcluded.dart","").getVirtualFile();
    final VirtualFile inTest=myFixture.addFileToProject("DartProject1/test/inTest.dart","").getVirtualFile();
    final VirtualFile inExample=myFixture.addFileToProject("DartProject1/example/inExample.dart","").getVirtualFile();
    DartProjectComponent.excludeBuildAndPackagesFolders(myModule,pubspec);
    doTestResolveScope(inExcluded,null,null);
    doTestResolveScope(inSdk1,new VirtualFile[]{inSdk1,inSdk2},new VirtualFile[]{inIdeLib1,inIdeLib2,inContent,inProject2Web,inProject2Lib,inProject1Root,inLib,inPackages,inWeb,inWebSub,inExcluded,inTest,inExample});
    doTestResolveScope(inIdeLib1,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2},new VirtualFile[]{inContent,inProject2Web,inProject2Lib,inProject1Root,inLib,inPackages,inWeb,inWebSub,inExcluded,inTest,inExample});
    doTestResolveScope(inContent,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inContent,inProject2Web,inProject2Lib,inProject1Root,inLib,inPackages,inWeb,inWebSub,inTest,inExample},new VirtualFile[]{inExcluded});
    doTestResolveScope(inProject1Root,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inProject1Root,inLib,inPackages,inWeb,inWebSub,inTest,inExample},new VirtualFile[]{inContent,inProject2Web,inExcluded});
    doTestResolveScope(inTest,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inProject1Root,inLib,inPackages,inWeb,inWebSub,inTest,inExample},new VirtualFile[]{inContent,inProject2Web,inExcluded});
    doTestResolveScope(inLib,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inLib,inPackages},new VirtualFile[]{inContent,inProject2Web,inExcluded,inProject1Root,inWeb,inWebSub,inTest,inExample});
    doTestResolveScope(inPackages,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inLib,inPackages},new VirtualFile[]{inContent,inProject2Web,inExcluded,inProject1Root,inWeb,inWebSub,inTest,inExample});
    doTestResolveScope(inWeb,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inLib,inPackages,inWeb,inWebSub},new VirtualFile[]{inContent,inProject2Web,inExcluded,inProject1Root,inTest,inExample});
    doTestResolveScope(inWebSub,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inLib,inPackages,inWeb,inWebSub},new VirtualFile[]{inContent,inProject2Web,inExcluded,inProject1Root,inTest,inExample});
    doTestResolveScope(inExample,new VirtualFile[]{inSdk1,inSdk2,inIdeLib1,inIdeLib2,inProject2Lib,inLib,inPackages,inExample},new VirtualFile[]{inContent,inProject2Web,inExcluded,inProject1Root,inTest,inWeb,inWebSub});
  }
  finally {
    DartTestUtils.resetModuleRoots(myModule);
  }
}
