{
  final MarkdownHtmlPanelProvider.ProviderInfo providerInfo=settings.getMarkdownPreviewSettings().getHtmlPanelProviderInfo();
  if (providerInfo.equals(myLastPanelProviderInfo)) {
    return getPanelGuaranteed();
  }
  MarkdownHtmlPanelProvider provider=MarkdownHtmlPanelProvider.createFromInfo(providerInfo);
  if (!provider.isAvailable()) {
    Messages.showMessageDialog("Tried to use preview panel provider (" + providerInfo.getName() + "), but it is unavailable. Reverting to default.",CommonBundle.getErrorTitle(),Messages.getErrorIcon());
    settings.setMarkdownPreviewSettings(new MarkdownPreviewSettings(settings.getMarkdownPreviewSettings().getSplitEditorLayout(),MarkdownPreviewSettings.DEFAULT.getHtmlPanelProviderInfo()));
    provider=MarkdownHtmlPanelProvider.getProviders()[0];
  }
  myLastPanelProviderInfo=settings.getMarkdownPreviewSettings().getHtmlPanelProviderInfo();
  return provider.createHtmlPanel();
}
