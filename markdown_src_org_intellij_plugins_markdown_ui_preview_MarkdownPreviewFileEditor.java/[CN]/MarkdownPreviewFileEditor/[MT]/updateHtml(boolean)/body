{
  if (!myFile.isValid() || myDocument == null || Disposer.isDisposed(this)) {
    return;
  }
  final String html=generateMarkdownHtml(myFile,myDocument.getText());
  if (!myFile.isValid() || Disposer.isDisposed(this)) {
    return;
  }
synchronized (REQUESTS_LOCK) {
    if (myLastHtmlOrRefreshRequest != null) {
      mySwingAlarm.cancelRequest(myLastHtmlOrRefreshRequest);
    }
    myLastHtmlOrRefreshRequest=new Runnable(){
      @Override public void run(){
        final String currentHtml="<html><head></head>" + html + "</html>";
        if (!currentHtml.equals(myLastRenderedHtml)) {
          myLastRenderedHtml=currentHtml;
          myPanel.setHtml(myLastRenderedHtml);
          if (preserveScrollOffset) {
            myPanel.scrollToMarkdownSrcOffset(myLastScrollOffset);
          }
        }
        myPanel.render();
synchronized (REQUESTS_LOCK) {
          myLastHtmlOrRefreshRequest=null;
        }
      }
    }
;
    mySwingAlarm.addRequest(myLastHtmlOrRefreshRequest,RENDERING_DELAY_MS,ModalityState.stateForComponent(getComponent()));
  }
}
