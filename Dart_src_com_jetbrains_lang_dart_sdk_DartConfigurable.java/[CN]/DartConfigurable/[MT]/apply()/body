{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      if (myEnableDartSupportCheckBox.isSelected()) {
        final String sdkHomePath=FileUtilRt.toSystemIndependentName(mySdkPathTextWithBrowse.getText().trim());
        final String initialSdkHomePath=mySdkInitial == null ? "" : mySdkInitial.getHomePath();
        if (DartSdkUtil.isDartSdkHome(sdkHomePath)) {
          final String dartSdkGlobalLibName;
          if (mySdkInitial == null) {
            dartSdkGlobalLibName=DartSdkGlobalLibUtil.createDartSdkGlobalLib(sdkHomePath);
          }
 else {
            dartSdkGlobalLibName=mySdkInitial.getGlobalLibName();
            if (!sdkHomePath.equals(initialSdkHomePath)) {
              DartSdkGlobalLibUtil.updateDartSdkGlobalLib(dartSdkGlobalLibName,sdkHomePath);
            }
          }
          final Module[] modules=DartSdkGlobalLibUtil.isIdeWithMultipleModuleSupport() ? myModulesCheckboxTree.getCheckedNodes(Module.class,null) : ModuleManager.getInstance(myProject).getModules();
          DartSdkGlobalLibUtil.updateDependencyOnDartSdkGlobalLib(myProject,modules,dartSdkGlobalLibName);
        }
        final String dartiumPath=FileUtilRt.toSystemIndependentName(myDartiumPathTextWithBrowse.getText().trim());
        final String dartiumPathInitial=myDartiumInitial == null ? null : myDartiumInitial.getPath();
        if (!dartiumPath.isEmpty() && new File(dartiumPath).exists() && !dartiumPath.equals(dartiumPathInitial)) {
          final WebBrowser browser=DartiumUtil.ensureDartiumBrowserConfigured(dartiumPath);
          if (!myDartiumSettingsCurrent.equals(browser.getSpecificSettings())) {
            WebBrowserManager.getInstance().setBrowserSpecificSettings(browser,myDartiumSettingsCurrent);
          }
        }
        if (myDartiumInitial != null && !myDartiumSettingsCurrent.equals(myDartiumInitial.getSpecificSettings())) {
          WebBrowserManager.getInstance().setBrowserSpecificSettings(myDartiumInitial,myDartiumSettingsCurrent);
        }
      }
 else {
        if (myModulesWithDartSdkLibAttachedInitial.size() > 0 && mySdkInitial != null) {
          DartSdkGlobalLibUtil.detachDartSdkGlobalLib(myModulesWithDartSdkLibAttachedInitial,mySdkInitial.getGlobalLibName());
        }
      }
    }
  }
);
  reset();
}
