{
  if (Comparing.haveEqualElements(paths,getCustomPackageRootPaths(module)))   return;
  final ModifiableRootModel modifiableModel=ModuleRootManager.getInstance(module).getModifiableModel();
  try {
    for (    final OrderEntry entry : modifiableModel.getOrderEntries()) {
      if (entry instanceof LibraryOrderEntry && CUSTOM_PACKAGE_ROOTS_LIB_NAME.equals(((LibraryOrderEntry)entry).getLibraryName())) {
        modifiableModel.removeOrderEntry(entry);
      }
    }
    if (paths.size() > 0) {
      final Library library=modifiableModel.getModuleLibraryTable().createLibrary(CUSTOM_PACKAGE_ROOTS_LIB_NAME);
      final Library.ModifiableModel libModel=library.getModifiableModel();
      for (      String path : paths) {
        libModel.addRoot(VfsUtilCore.pathToUrl(path),OrderRootType.CLASSES);
      }
      libModel.commit();
    }
    modifiableModel.commit();
  }
 catch (  Exception e) {
    if (!modifiableModel.isDisposed())     modifiableModel.dispose();
  }
}
