{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      final PsiElement element=parameters.getElement();
      if (element.getLanguage() != DartLanguage.INSTANCE)       return;
      final DartComponentType componentType=DartComponentType.typeOf(element);
      if (componentType != DartComponentType.CLASS && componentType != DartComponentType.METHOD && componentType != DartComponentType.OPERATOR) {
        return;
      }
      final DartComponentName componentName=element instanceof DartComponentName ? (DartComponentName)element : element instanceof DartComponent ? ((DartComponent)element).getComponentName() : null;
      final VirtualFile file=componentName == null ? null : DartResolveUtil.getRealVirtualFile(componentName.getContainingFile());
      if (file != null) {
        fileRef.set(file);
        offsetRef.set(componentName.getTextRange().getStartOffset());
        componentTypeRef.set(componentType);
      }
    }
  }
);
}
