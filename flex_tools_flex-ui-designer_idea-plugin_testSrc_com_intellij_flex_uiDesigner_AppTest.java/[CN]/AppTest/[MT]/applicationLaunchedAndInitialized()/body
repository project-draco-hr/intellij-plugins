{
  ((MySocketInputHandler)SocketInputHandler.getInstance()).fail=fail;
  ((MySocketInputHandler)SocketInputHandler.getInstance()).semaphore=semaphore;
  MessageBusConnection connection=ApplicationManager.getApplication().getMessageBus().connect(myModule);
  connection.subscribe(SocketInputHandler.MESSAGE_TOPIC,new SocketInputHandler.DocumentRenderedListener(){
    @Override public void documentRendered(    DocumentFactoryManager.DocumentInfo info,    final BufferedImage image){
      if (assertOnDocumentRendered != null) {
        try {
          assertOnDocumentRendered.call();
        }
 catch (        Exception e) {
          fail.set(true);
          throw new AssertionError(e);
        }
      }
      semaphore.up();
    }
    @Override public void errorOccured(){
      fail.set(true);
      semaphore.up();
    }
  }
);
}
