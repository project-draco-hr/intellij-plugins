{
  final Document document=FileDocumentManager.getInstance().getDocument(file);
  assertNotNull(document);
  AccessToken token=WriteAction.start();
  try {
    document.insertString(offset,s);
  }
  finally {
    token.finish();
  }
  semaphore.down();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  FileDocumentManager.getInstance().saveAllDocuments();
  await();
}
