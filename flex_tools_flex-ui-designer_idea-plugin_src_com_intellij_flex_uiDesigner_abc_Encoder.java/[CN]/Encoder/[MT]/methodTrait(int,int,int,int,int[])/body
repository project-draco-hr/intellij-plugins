{
  currentBuffer.writeU32(history.getIndex(poolIndex,IndexHistory.MULTINAME,name));
  TIntArrayList new_metadata=trimMetadata(metadata);
  if (((trait_kind >> 4) & TRAIT_FLAG_metadata) != 0 && new_metadata.size() == 0) {
    trait_kind=trait_kind & ~(TRAIT_FLAG_metadata << 4);
  }
  currentBuffer.writeU8(trait_kind);
  currentBuffer.writeU32(dispId);
  currentBuffer.writeU32(this.methodInfo.getIndex(poolIndex,methodInfo));
  encodeMetaData(trait_kind,new_metadata);
}
