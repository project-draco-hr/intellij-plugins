{
  currentBuffer.writeU32(history.getIndex(poolIndex,IndexHistory.cp_mn,name));
  TIntArrayList new_metadata=trimMetadata(metadata);
  if (((kind >> 4) & TRAIT_FLAG_metadata) != 0 && new_metadata.size() == 0) {
    kind=kind & ~(TRAIT_FLAG_metadata << 4);
  }
  currentBuffer.writeU8(kind);
  currentBuffer.writeU32(slotId);
  currentBuffer.writeU32(this.methodInfo.getIndex(poolIndex,methodInfo));
  encodeMetaData(kind,new_metadata);
}
