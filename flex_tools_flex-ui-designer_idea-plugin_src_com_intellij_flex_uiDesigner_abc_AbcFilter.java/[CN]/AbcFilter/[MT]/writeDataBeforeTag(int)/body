{
  int tagHeaderLength=tagLength < 63 ? 2 : 6;
  buffer.limit(buffer.position() - tagHeaderLength);
  buffer.position(lastWrittenPosition);
  channel.write(buffer);
  lastWrittenPosition=buffer.limit() + tagLength + tagHeaderLength;
  buffer.limit(buffer.capacity());
}
