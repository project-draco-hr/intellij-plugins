{
  int tagHeaderLength=tagLength < 63 ? 2 : 6;
  int newLimit=buffer.position() - tagHeaderLength;
  if (newLimit == lastWrittenPosition) {
    lastWrittenPosition+=tagLength + tagHeaderLength;
    return false;
  }
  buffer.limit(newLimit);
  buffer.position(lastWrittenPosition);
  channel.write(buffer);
  lastWrittenPosition=buffer.limit() + tagLength + tagHeaderLength;
  buffer.limit(buffer.capacity());
  return true;
}
