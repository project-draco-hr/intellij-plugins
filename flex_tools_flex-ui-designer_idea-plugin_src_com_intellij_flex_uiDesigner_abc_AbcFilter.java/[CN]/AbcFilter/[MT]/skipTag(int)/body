{
  int tagHeaderLength=length < 63 ? 2 : 6;
  buffer.limit(buffer.position() - tagHeaderLength);
  buffer.position(lastWrittenPosition);
  channel.write(buffer);
  lastWrittenPosition=buffer.limit() + length + tagHeaderLength;
  buffer.limit(buffer.capacity());
  buffer.position(lastWrittenPosition);
}
