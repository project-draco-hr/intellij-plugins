{
  final AdlUtil.AdlRunConfiguration adlRunConfiguration=AdlUtil.createTestAdlRunConfiguration();
  adlRunConfiguration.arguments=new ArrayList<String>();
  final ServerSocket serverSocket=new ServerSocket(0,1);
  adlRunConfiguration.arguments.add(String.valueOf(serverSocket.getLocalPort()));
  adlRunConfiguration.arguments.add(String.valueOf(0));
  AdlUtil.addTestPlugin(adlRunConfiguration.arguments);
  ShutDownTracker.getInstance().registerShutdownTask(new Runnable(){
    @Override public void run(){
      if (socket != null) {
        try {
          socket.close();
        }
 catch (        IOException e) {
          e.printStackTrace();
        }
      }
      adlProcessHandler.destroyProcess();
    }
  }
);
  final Callable<Void> action=new Callable<Void>(){
    @Override public Void call() throws IOException {
      socket=serverSocket.accept();
      return null;
    }
  }
;
  if (Boolean.valueOf(System.getProperty("fud.test.debug"))) {
    action.call();
  }
 else {
    ApplicationManager.getApplication().executeOnPooledThread(action).get(30,TimeUnit.SECONDS);
  }
  changeServiceImplementation();
  Client.getInstance().setOut(socket.getOutputStream());
  socketInputHandler=(TestSocketInputHandler)SocketInputHandler.getInstance();
}
