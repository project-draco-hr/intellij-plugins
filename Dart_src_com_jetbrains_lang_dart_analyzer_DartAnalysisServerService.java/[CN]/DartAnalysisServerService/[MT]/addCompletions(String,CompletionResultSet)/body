{
  while (true) {
    ProgressManager.checkCanceled();
synchronized (myCompletionInfos) {
      CompletionInfo completionInfo;
      while ((completionInfo=myCompletionInfos.poll()) != null) {
        if (!completionInfo.myCompletionId.equals(completionId))         continue;
        for (        CompletionSuggestion completion : completionInfo.myCompletions) {
          final LookupElement lookup=LookupElementBuilder.create(completion.getCompletion());
          resultSet.consume(lookup);
        }
        if (completionInfo.isLast)         return;
      }
      try {
        myCompletionInfos.wait(CHECK_CANCELLED_PERIOD);
      }
 catch (      InterruptedException e) {
        return;
      }
    }
  }
}
