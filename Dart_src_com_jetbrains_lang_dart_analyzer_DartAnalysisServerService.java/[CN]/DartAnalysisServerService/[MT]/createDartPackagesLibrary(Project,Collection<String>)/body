{
  Library library=ProjectLibraryTable.getInstance(project).getLibraryByName(DartPackagesLibraryType.DART_PACKAGES_LIBRARY_NAME);
  if (library == null) {
    final LibraryTableBase.ModifiableModel libTableModel=ProjectLibraryTable.getInstance(project).getModifiableModel();
    library=libTableModel.createLibrary(DartPackagesLibraryType.DART_PACKAGES_LIBRARY_NAME,DartPackagesLibraryType.LIBRARY_KIND);
    libTableModel.commit();
  }
  final LibraryEx.ModifiableModelEx libModel=(LibraryEx.ModifiableModelEx)library.getModifiableModel();
  try {
    for (    String url : libModel.getUrls(OrderRootType.CLASSES)) {
      libModel.removeRoot(url,OrderRootType.CLASSES);
    }
    for (    String packageDir : rootsToAddToLib) {
      libModel.addRoot(VfsUtilCore.pathToUrl(packageDir),OrderRootType.CLASSES);
    }
    libModel.commit();
  }
  finally {
    if (!Disposer.isDisposed(libModel)) {
      Disposer.dispose(libModel);
    }
  }
  return library;
}
