{
  while (true) {
    ProgressManager.checkCanceled();
synchronized (myCompletionInfos) {
      CompletionInfo completionInfo;
      while ((completionInfo=myCompletionInfos.poll()) != null) {
        if (!completionInfo.myCompletionId.equals(completionId))         continue;
        for (        final CompletionSuggestion completion : completionInfo.myCompletions) {
          final Element element=completion.getElement();
          final Location location=element == null ? null : element.getLocation();
          final DartLookupObject lookupObject=new DartLookupObject(project,location,completion.getRelevance());
          final LookupElement lookup=LookupElementBuilder.create(lookupObject,completion.getCompletion());
          resultSet.consume(lookup);
        }
        if (completionInfo.isLast)         return;
      }
      try {
        myCompletionInfos.wait(CHECK_CANCELLED_PERIOD);
      }
 catch (      InterruptedException e) {
        return;
      }
    }
  }
}
