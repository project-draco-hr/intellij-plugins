{
  final VirtualFile vFile=DartResolveUtil.getRealVirtualFile(psiFile);
  if (vFile == null)   return null;
  final Ref<AnalysisError[]> resultError=new Ref<AnalysisError[]>();
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  try {
    myServer.analysis_getErrors(FileUtil.toSystemDependentName(vFile.getPath()),new GetErrorsConsumer(){
      @Override public void computedErrors(      final AnalysisError[] errors){
        if (semaphore.tryUp()) {
          resultError.set(errors);
        }
 else {
          ApplicationManager.getApplication().runReadAction(new Runnable(){
            @Override public void run(){
              final Project project=psiFile.isValid() ? psiFile.getProject() : null;
              if (project != null && !project.isDisposed()) {
                DaemonCodeAnalyzer.getInstance(project).restart(psiFile);
              }
            }
          }
);
        }
      }
      @Override public void onError(      final RequestError requestError){
        semaphore.up();
        LOG.error(requestError.getMessage(),requestError.getStackTrace());
      }
    }
);
    semaphore.waitFor(GET_ERRORS_TIMEOUT);
  }
  finally {
    semaphore.up();
  }
  return resultError.get();
}
