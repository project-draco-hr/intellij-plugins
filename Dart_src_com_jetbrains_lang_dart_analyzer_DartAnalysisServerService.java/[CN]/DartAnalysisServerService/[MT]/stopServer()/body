{
synchronized (myLock) {
    if (myServer != null) {
      LOG.debug("stopping server");
      myServer.removeAnalysisServerListener(myAnalysisServerListener);
      final AnalysisServer server=myServer;
      final boolean ok=runInPooledThreadAndWait(new Runnable(){
        @Override public void run(){
          server.server_shutdown();
        }
      }
,"server_shutdown()",SEND_REQUEST_TIMEOUT);
      if (!ok) {
        if (myServerSocket != null) {
          myServerSocket.stop();
        }
      }
    }
    onServerStopped();
  }
}
