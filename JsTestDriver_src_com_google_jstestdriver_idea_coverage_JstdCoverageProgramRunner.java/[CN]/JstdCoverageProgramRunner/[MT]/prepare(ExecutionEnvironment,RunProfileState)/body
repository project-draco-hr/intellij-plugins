{
  JstdRunProfileState jstdState=JstdRunProfileState.cast(state);
  if (jstdState.getRunSettings().isExternalServerType()) {
    return AsyncResult.<RunProfileStarter>done(new MyStarter(null));
  }
  JstdToolWindowManager jstdToolWindowManager=JstdToolWindowManager.getInstance(environment.getProject());
  jstdToolWindowManager.setAvailable(true);
  JstdServer server=JstdServerRegistry.getInstance().getServer();
  if (server != null && !server.isStopped()) {
    return AsyncResult.<RunProfileStarter>done(new MyStarter(server));
  }
  final AsyncResult<RunProfileStarter> result=new AsyncResult<RunProfileStarter>();
  jstdToolWindowManager.restartServer(new NullableConsumer<JstdServer>(){
    @Override public void consume(    @Nullable JstdServer server){
      result.setDone(server != null ? new MyStarter(server) : null);
    }
  }
);
  return result;
}
