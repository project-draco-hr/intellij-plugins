{
  int stringTableSize=stringWriter.size();
  blockOut.beginWritePrepended(stringTableSize + (rootScope.referenceCounter < 0x80 ? 1 : 2),startPosition);
  blockOut.writePrepended(stringWriter.getCounter(),stringWriter.getByteArrayOut());
  blockOut.writePrepended(rootScope.referenceCounter);
  blockOut.endWritePrepended(startPosition);
  rootScope.referenceCounter=0;
  resetAfterMessage();
}
