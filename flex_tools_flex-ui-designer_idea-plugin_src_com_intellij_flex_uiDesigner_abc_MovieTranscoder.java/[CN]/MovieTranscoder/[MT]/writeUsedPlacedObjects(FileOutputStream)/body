{
  final byte[] data=buffer.array();
  for (  PlacedObject object : usedPlacedObjects) {
    final TIntArrayList positions=object.positions;
    if (positions == null) {
      out.write(data,object.start - 2 - (object.length < 63 ? 2 : 6),object.length);
    }
 else {
      buffer.position(0);
      encodeTagHeader(object.tagType,object.actualLength);
      out.write(data,0,buffer.position());
      out.write(data,object.start - 2,positions.getQuick(0));
      final int maxI=positions.size() - 1;
      for (int i=1; ; ) {
        if (i == maxI) {
          final int offset=positions.getQuick(i);
          out.write(data,offset,offset - object.length);
          break;
        }
        out.write(data,positions.getQuick(i++),positions.getQuick(i++));
      }
    }
  }
}
