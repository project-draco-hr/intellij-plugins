{
  List<List<File>> allParents=new ArrayList<List<File>>();
  for (  File file : files) {
    File dir=file.isDirectory() ? file : file.getParentFile();
    List<File> parents=buildParents(dir);
    allParents.add(parents);
  }
  List<File> common=null;
  for (  List<File> next : allParents) {
    if (common == null) {
      common=next;
    }
 else {
      List<File> newCommon=new ArrayList<File>();
      for (int i=0; i < Math.min(common.size(),next.size()); i++) {
        if (common.get(i).equals(next.get(i))) {
          newCommon.add(common.get(i));
        }
 else {
          break;
        }
      }
      common=newCommon;
    }
  }
  if (common == null) {
    throw new RuntimeException();
  }
  return common.get(common.size() - 1);
}
