{
  generatorOutputDirectory=new File(args[4]);
  generatorOutputDirectory.mkdirs();
  in=new DataInputStream(new BufferedInputStream(System.in));
  LoggerManager loggerManager=new ConsoleLoggerManager();
  logger=loggerManager.getLoggerForComponent(null);
  plexusContainer=createPlexusContainer(loggerManager);
  mavenPluginManager=plexusContainer.lookup(MavenPluginManager.class);
  session=createSession(createExecutionRequest(args));
  maven=new Maven(plexusContainer,session);
  final List<String> generators=new ArrayList<String>(2);
  final URL generatorJarPath=new URL("file://" + in.readUTF());
  generators.add(in.readUTF());
  final int projectsCount=in.readUnsignedShort();
  final ExecutorService executorService=plexusContainer.lookup(ThreadConfigurationService.class).getExecutorService("1",true,projectsCount);
  try {
    for (int i=0; i < projectsCount; i++) {
      final String pathname=in.readUTF();
      executorService.submit(new Runnable(){
        @Override public void run(){
          try {
            final String configFilePath=generate(pathname,generators,generatorJarPath);
synchronized (System.out) {
              System.out.append("\n[fcg] generated: ").append(pathname).append(':').append(configFilePath).append("[/fcg]").flush();
            }
          }
 catch (          Throwable e) {
            getLogger().error("Cannnot generate flex config for " + pathname,e);
          }
        }
      }
);
    }
  }
  finally {
    executorService.shutdown();
    executorService.awaitTermination(10,TimeUnit.MINUTES);
  }
}
